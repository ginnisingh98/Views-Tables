--------------------------------------------------------
--  DDL for Package Body WSH_DELIVERIES_PKG1
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."WSH_DELIVERIES_PKG1" as
/* $Header: WSHDELXB.pls 115.3 99/08/11 19:22:58 porting s $ */

  -- The procedure insert_row can possibly return 2 kinds of exceptions
  -- 1. WSH_DEL_DUP_NAME : This the for the case that default delivery name
  --                       generated by wsh_external_custom.delivery_name
  --                       is duplicate in table wsh_deliveries
  -- 2. WSH_DEL_NULL_NAME : This is for the case that default delivery name
  --                        generated by wsh_external_custom.delivery_name
  -- 			    is NULL.

  PROCEDURE Insert_Row(X_Rowid                   IN OUT VARCHAR2,
                       X_Organization_Id                NUMBER,
                       X_Delivery_Id             IN OUT NUMBER,
                       X_Name                    IN OUT VARCHAR2,
                       X_Source_Code                    VARCHAR2,
                       X_Planned_Departure_Id           NUMBER,
                       X_Actual_Departure_Id            NUMBER,
                       X_Status_Code                    VARCHAR2,
                       X_Loading_Order_Flag             VARCHAR2,
                       X_Date_Closed                    DATE,
                       X_Report_Set_Id                  NUMBER,
                       X_Sequence_Number                NUMBER,
                       X_Customer_Id                    NUMBER,
                       X_Ultimate_Ship_To_Id            NUMBER,
                       X_Intermediate_Ship_To_Id        NUMBER,
                       X_Pooled_Ship_To_Id              NUMBER,
                       X_Waybill                        VARCHAR2,
                       X_Gross_Weight                   NUMBER,
                       X_Weight_Uom_Code                VARCHAR2,
                       X_Volume                         NUMBER,
                       X_Volume_Uom_Code                VARCHAR2,
                       X_Picked_By_Id                   NUMBER,
                       X_Packed_By_Id                   NUMBER,
                       X_Expected_Arrival_Date          DATE,
                       X_Asn_Date_Sent                  DATE,
                       X_Asn_Seq_Number                 NUMBER,
                       X_Freight_Carrier_Code           VARCHAR2,
                       X_Freight_Terms_Code             VARCHAR2,
                       X_Currency_Code                  VARCHAR2,
                       X_Fob_Code                       VARCHAR2,
                       X_Attribute_Category             VARCHAR2,
                       X_Attribute1                     VARCHAR2,
                       X_Attribute2                     VARCHAR2,
                       X_Attribute3                     VARCHAR2,
                       X_Attribute4                     VARCHAR2,
                       X_Attribute5                     VARCHAR2,
                       X_Attribute6                     VARCHAR2,
                       X_Attribute7                     VARCHAR2,
                       X_Attribute8                     VARCHAR2,
                       X_Attribute9                     VARCHAR2,
                       X_Attribute10                    VARCHAR2,
                       X_Attribute11                    VARCHAR2,
                       X_Attribute12                    VARCHAR2,
                       X_Attribute13                    VARCHAR2,
                       X_Attribute14                    VARCHAR2,
                       X_Attribute15                    VARCHAR2,
                       X_Global_Attribute_Category      VARCHAR2 default null,
                       X_Global_Attribute1              VARCHAR2 default null,
                       X_Global_Attribute2              VARCHAR2 default null,
                       X_Global_Attribute3              VARCHAR2 default null,
                       X_Global_Attribute4              VARCHAR2 default null,
                       X_Global_Attribute5              VARCHAR2 default null,
                       X_Global_Attribute6              VARCHAR2 default null,
                       X_Global_Attribute7              VARCHAR2 default null,
                       X_Global_Attribute8              VARCHAR2 default null,
                       X_Global_Attribute9              VARCHAR2 default null,
                       X_Global_Attribute10             VARCHAR2 default null,
                       X_Global_Attribute11             VARCHAR2 default null,
                       X_Global_Attribute12             VARCHAR2 default null,
                       X_Global_Attribute13             VARCHAR2 default null,
                       X_Global_Attribute14             VARCHAR2 default null,
                       X_Global_Attribute15             VARCHAR2 default null,
                       X_Global_Attribute16             VARCHAR2 default null,
                       X_Global_Attribute17             VARCHAR2 default null,
                       X_Global_Attribute18             VARCHAR2 default null,
                       X_Global_Attribute19             VARCHAR2 default null,
                       X_Global_Attribute20             VARCHAR2 default null,
                       X_Creation_Date                  DATE,
                       X_Created_By                     NUMBER,
                       X_Last_Update_Date               DATE,
                       X_Last_Updated_By                NUMBER,
                       X_Last_Update_Login              NUMBER
) IS
    CURSOR C IS SELECT rowid FROM wsh_deliveries
                 WHERE delivery_id = X_Delivery_Id;
      CURSOR C2 IS SELECT wsh_deliveries_s.nextval FROM sys.dual;
      dname 		wsh_deliveries.name%TYPE;
      CURSOR C3 (del_name   VARCHAR2) IS
        SELECT COUNT(*) FROM wsh_deliveries
        WHERE name = del_name;
      temp 		NUMBER;
      temp_id		NUMBER;
      duplicate_name	EXCEPTION;
      null_name		EXCEPTION;
   BEGIN
      if (X_Delivery_Id is NULL) then
        OPEN C2;
        FETCH C2 INTO X_Delivery_Id;
        CLOSE C2;
      end if;

      IF (X_Name IS NULL) THEN
        dname := wsh_external_custom.delivery_name(X_Delivery_Id);

    	IF ( dname IS NULL ) THEN
          RAISE null_name;
        -- shipping default make sure the delivery name is not duplicate
        ELSIF ( dname = TO_CHAR(X_Delivery_Id) ) THEN
          temp_id := X_Delivery_Id;
          OPEN C2;

          LOOP
            dname := TO_CHAR(temp_id);
            OPEN C3( dname);
            FETCH C3 INTO temp;
            CLOSE C3;
            IF ( temp = 0 ) THEN
              EXIT;
            END IF;

            FETCH C2 INTO temp_id;
          END LOOP;
          IF C2%ISOPEN THEN
            CLOSE C2;
 	  END IF;

          X_Delivery_Id := temp_id;
        ELSE  -- name is generated from wsh_external_custom.delivery_name
          OPEN C3( dname);
          FETCH C3 INTO temp;
          CLOSE C3;
          IF ( temp > 0 ) THEN
            RAISE duplicate_name;
          END IF;

        END IF;
        X_Name := dname;
      END IF;

       INSERT INTO wsh_deliveries(
              organization_id,
              delivery_id,
              name,
              source_code,
              planned_departure_id,
              actual_departure_id,
              status_code,
              loading_order_flag,
              date_closed,
              report_set_id,
              sequence_number,
              customer_id,
              ultimate_ship_to_id,
              intermediate_ship_to_id,
              pooled_ship_to_id,
              waybill,
              gross_weight,
              weight_uom_code,
              volume,
              volume_uom_code,
              picked_by_id,
              packed_by_id,
              expected_arrival_date,
              asn_date_sent,
              asn_seq_number,
              freight_carrier_code,
              freight_terms_code,
              currency_code,
              fob_code,
              attribute_category,
              attribute1,
              attribute2,
              attribute3,
              attribute4,
              attribute5,
              attribute6,
              attribute7,
              attribute8,
              attribute9,
              attribute10,
              attribute11,
              attribute12,
              attribute13,
              attribute14,
              attribute15,
              global_attribute_category,
              global_attribute1,
              global_attribute2,
              global_attribute3,
              global_attribute4,
              global_attribute5,
              global_attribute6,
              global_attribute7,
              global_attribute8,
              global_attribute9,
              global_attribute10,
              global_attribute11,
              global_attribute12,
              global_attribute13,
              global_attribute14,
              global_attribute15,
              global_attribute16,
              global_attribute17,
              global_attribute18,
              global_attribute19,
              global_attribute20,
              creation_date,
              created_by,
              last_update_date,
              last_updated_by,
              last_update_login
             ) VALUES (
              X_Organization_Id,
              X_Delivery_Id,
              X_Name,
              X_Source_Code,
              X_Planned_Departure_Id,
              X_Actual_Departure_Id,
              X_Status_Code,
              X_Loading_Order_Flag,
              X_Date_Closed,
              X_Report_Set_Id,
              X_Sequence_Number,
              X_Customer_Id,
              X_Ultimate_Ship_To_Id,
              X_Intermediate_Ship_To_Id,
              X_Pooled_Ship_To_Id,
              X_Waybill,
              X_Gross_Weight,
              X_Weight_Uom_Code,
              X_Volume,
              X_Volume_Uom_Code,
              X_Picked_By_Id,
              X_Packed_By_Id,
              X_Expected_Arrival_Date,
              X_Asn_Date_Sent,
              X_Asn_Seq_Number,
              X_Freight_Carrier_Code,
              X_Freight_Terms_Code,
              X_Currency_Code,
              X_Fob_Code,
              X_Attribute_Category,
              X_Attribute1,
              X_Attribute2,
              X_Attribute3,
              X_Attribute4,
              X_Attribute5,
              X_Attribute6,
              X_Attribute7,
              X_Attribute8,
              X_Attribute9,
              X_Attribute10,
              X_Attribute11,
              X_Attribute12,
              X_Attribute13,
              X_Attribute14,
              X_Attribute15,
 	      X_Global_Attribute_Category,
              X_Global_Attribute1,
              X_Global_Attribute2,
              X_Global_Attribute3,
              X_Global_Attribute4,
              X_Global_Attribute5,
              X_Global_Attribute6,
              X_Global_Attribute7,
              X_Global_Attribute8,
              X_Global_Attribute9,
              X_Global_Attribute10,
              X_Global_Attribute11,
              X_Global_Attribute12,
              X_Global_Attribute13,
              X_Global_Attribute14,
              X_Global_Attribute15,
              X_Global_Attribute16,
              X_Global_Attribute17,
              X_Global_Attribute18,
              X_Global_Attribute19,
              X_Global_Attribute20,
              X_Creation_Date,
              X_Created_By,
              X_Last_Update_Date,
              X_Last_Updated_By,
              X_Last_Update_Login
             );

    OPEN C;
    FETCH C INTO X_Rowid;
    if (C%NOTFOUND) then
      CLOSE C;
      Raise NO_DATA_FOUND;
    end if;
    CLOSE C;
  EXCEPTION
    WHEN duplicate_name THEN
      FND_MESSAGE.Set_Name('OE', 'WSH_DEL_DUP_NAME');
      APP_EXCEPTION.Raise_Exception;
    WHEN null_name THEN
      FND_MESSAGE.Set_Name('OE', 'WSH_DEL_NULL_NAME');
      APP_EXCEPTION.Raise_Exception;
  END Insert_Row;


  PROCEDURE Insert_Row_new(X_Rowid                   IN OUT VARCHAR2,
                       X_Organization_Id                NUMBER,
                       X_Delivery_Id             IN OUT NUMBER,
                       X_Name                    IN OUT VARCHAR2,
                       X_Source_Code                    VARCHAR2,
                       X_Planned_Departure_Id           NUMBER,
                       X_Actual_Departure_Id            NUMBER,
                       X_Status_Code                    VARCHAR2,
                       X_Loading_Order_Flag             VARCHAR2,
                       X_Date_Closed                    DATE,
                       X_Report_Set_Id                  NUMBER,
                       X_Sequence_Number                NUMBER,
                       X_Customer_Id                    NUMBER,
                       X_Ultimate_Ship_To_Id            NUMBER,
                       X_Intermediate_Ship_To_Id        NUMBER,
                       X_Pooled_Ship_To_Id              NUMBER,
                       X_Waybill                        VARCHAR2,
                       X_Gross_Weight                   NUMBER,
				   X_Net_Weight                     NUMBER,
                       X_Weight_Uom_Code                VARCHAR2,
                       X_Volume                         NUMBER,
                       X_Volume_Uom_Code                VARCHAR2,
                       X_Picked_By_Id                   NUMBER,
                       X_Packed_By_Id                   NUMBER,
                       X_Expected_Arrival_Date          DATE,
                       X_Asn_Date_Sent                  DATE,
                       X_Asn_Seq_Number                 NUMBER,
                       X_Freight_Carrier_Code           VARCHAR2,
                       X_Freight_Terms_Code             VARCHAR2,
                       X_Currency_Code                  VARCHAR2,
                       X_Fob_Code                       VARCHAR2,
                       X_Attribute_Category             VARCHAR2,
                       X_Attribute1                     VARCHAR2,
                       X_Attribute2                     VARCHAR2,
                       X_Attribute3                     VARCHAR2,
                       X_Attribute4                     VARCHAR2,
                       X_Attribute5                     VARCHAR2,
                       X_Attribute6                     VARCHAR2,
                       X_Attribute7                     VARCHAR2,
                       X_Attribute8                     VARCHAR2,
                       X_Attribute9                     VARCHAR2,
                       X_Attribute10                    VARCHAR2,
                       X_Attribute11                    VARCHAR2,
                       X_Attribute12                    VARCHAR2,
                       X_Attribute13                    VARCHAR2,
                       X_Attribute14                    VARCHAR2,
                       X_Attribute15                    VARCHAR2,
                       X_Global_Attribute_Category      VARCHAR2 default null,
                       X_Global_Attribute1              VARCHAR2 default null,
                       X_Global_Attribute2              VARCHAR2 default null,
                       X_Global_Attribute3              VARCHAR2 default null,
                       X_Global_Attribute4              VARCHAR2 default null,
                       X_Global_Attribute5              VARCHAR2 default null,
                       X_Global_Attribute6              VARCHAR2 default null,
                       X_Global_Attribute7              VARCHAR2 default null,
                       X_Global_Attribute8              VARCHAR2 default null,
                       X_Global_Attribute9              VARCHAR2 default null,
                       X_Global_Attribute10             VARCHAR2 default null,
                       X_Global_Attribute11             VARCHAR2 default null,
                       X_Global_Attribute12             VARCHAR2 default null,
                       X_Global_Attribute13             VARCHAR2 default null,
                       X_Global_Attribute14             VARCHAR2 default null,
                       X_Global_Attribute15             VARCHAR2 default null,
                       X_Global_Attribute16             VARCHAR2 default null,
                       X_Global_Attribute17             VARCHAR2 default null,
                       X_Global_Attribute18             VARCHAR2 default null,
                       X_Global_Attribute19             VARCHAR2 default null,
                       X_Global_Attribute20             VARCHAR2 default null,
                       X_Creation_Date                  DATE,
                       X_Created_By                     NUMBER,
                       X_Last_Update_Date               DATE,
                       X_Last_Updated_By                NUMBER,
                       X_Last_Update_Login              NUMBER
) IS
    CURSOR C IS SELECT rowid FROM wsh_deliveries
                 WHERE delivery_id = X_Delivery_Id;
      CURSOR C2 IS SELECT wsh_deliveries_s.nextval FROM sys.dual;
      dname 		wsh_deliveries.name%TYPE;
      CURSOR C3 (del_name   VARCHAR2) IS
        SELECT COUNT(*) FROM wsh_deliveries
        WHERE name = del_name;
      temp 		NUMBER;
      temp_id		NUMBER;
      duplicate_name	EXCEPTION;
      null_name		EXCEPTION;
   BEGIN
      if (X_Delivery_Id is NULL) then
        OPEN C2;
        FETCH C2 INTO X_Delivery_Id;
        CLOSE C2;
      end if;

      IF (X_Name IS NULL) THEN
        dname := wsh_external_custom.delivery_name(X_Delivery_Id);

    	IF ( dname IS NULL ) THEN
          RAISE null_name;
        -- shipping default make sure the delivery name is not duplicate
        ELSIF ( dname = TO_CHAR(X_Delivery_Id) ) THEN
          temp_id := X_Delivery_Id;
          OPEN C2;

          LOOP
            dname := TO_CHAR(temp_id);
            OPEN C3( dname);
            FETCH C3 INTO temp;
            CLOSE C3;
            IF ( temp = 0 ) THEN
              EXIT;
            END IF;

            FETCH C2 INTO temp_id;
          END LOOP;
          IF C2%ISOPEN THEN
            CLOSE C2;
 	  END IF;

          X_Delivery_Id := temp_id;
        ELSE  -- name is generated from wsh_external_custom.delivery_name
          OPEN C3( dname);
          FETCH C3 INTO temp;
          CLOSE C3;
          IF ( temp > 0 ) THEN
            RAISE duplicate_name;
          END IF;

        END IF;
        X_Name := dname;
      END IF;

       INSERT INTO wsh_deliveries(
              organization_id,
              delivery_id,
              name,
              source_code,
              planned_departure_id,
              actual_departure_id,
              status_code,
              loading_order_flag,
              date_closed,
              report_set_id,
              sequence_number,
              customer_id,
              ultimate_ship_to_id,
              intermediate_ship_to_id,
              pooled_ship_to_id,
              waybill,
              gross_weight,
		    net_weight,
              weight_uom_code,
              volume,
              volume_uom_code,
              picked_by_id,
              packed_by_id,
              expected_arrival_date,
              asn_date_sent,
              asn_seq_number,
              freight_carrier_code,
              freight_terms_code,
              currency_code,
              fob_code,
              attribute_category,
              attribute1,
              attribute2,
              attribute3,
              attribute4,
              attribute5,
              attribute6,
              attribute7,
              attribute8,
              attribute9,
              attribute10,
              attribute11,
              attribute12,
              attribute13,
              attribute14,
              attribute15,
              global_attribute_category,
              global_attribute1,
              global_attribute2,
              global_attribute3,
              global_attribute4,
              global_attribute5,
              global_attribute6,
              global_attribute7,
              global_attribute8,
              global_attribute9,
              global_attribute10,
              global_attribute11,
              global_attribute12,
              global_attribute13,
              global_attribute14,
              global_attribute15,
              global_attribute16,
              global_attribute17,
              global_attribute18,
              global_attribute19,
              global_attribute20,
              creation_date,
              created_by,
              last_update_date,
              last_updated_by,
              last_update_login
             ) VALUES (
              X_Organization_Id,
              X_Delivery_Id,
              X_Name,
              X_Source_Code,
              X_Planned_Departure_Id,
              X_Actual_Departure_Id,
              X_Status_Code,
              X_Loading_Order_Flag,
              X_Date_Closed,
              X_Report_Set_Id,
              X_Sequence_Number,
              X_Customer_Id,
              X_Ultimate_Ship_To_Id,
              X_Intermediate_Ship_To_Id,
              X_Pooled_Ship_To_Id,
              X_Waybill,
              X_Gross_Weight,
		    X_Net_Weight,
              X_Weight_Uom_Code,
              X_Volume,
              X_Volume_Uom_Code,
              X_Picked_By_Id,
              X_Packed_By_Id,
              X_Expected_Arrival_Date,
              X_Asn_Date_Sent,
              X_Asn_Seq_Number,
              X_Freight_Carrier_Code,
              X_Freight_Terms_Code,
              X_Currency_Code,
              X_Fob_Code,
              X_Attribute_Category,
              X_Attribute1,
              X_Attribute2,
              X_Attribute3,
              X_Attribute4,
              X_Attribute5,
              X_Attribute6,
              X_Attribute7,
              X_Attribute8,
              X_Attribute9,
              X_Attribute10,
              X_Attribute11,
              X_Attribute12,
              X_Attribute13,
              X_Attribute14,
              X_Attribute15,
 	      X_Global_Attribute_Category,
              X_Global_Attribute1,
              X_Global_Attribute2,
              X_Global_Attribute3,
              X_Global_Attribute4,
              X_Global_Attribute5,
              X_Global_Attribute6,
              X_Global_Attribute7,
              X_Global_Attribute8,
              X_Global_Attribute9,
              X_Global_Attribute10,
              X_Global_Attribute11,
              X_Global_Attribute12,
              X_Global_Attribute13,
              X_Global_Attribute14,
              X_Global_Attribute15,
              X_Global_Attribute16,
              X_Global_Attribute17,
              X_Global_Attribute18,
              X_Global_Attribute19,
              X_Global_Attribute20,
              X_Creation_Date,
              X_Created_By,
              X_Last_Update_Date,
              X_Last_Updated_By,
              X_Last_Update_Login
             );

    OPEN C;
    FETCH C INTO X_Rowid;
    if (C%NOTFOUND) then
      CLOSE C;
      Raise NO_DATA_FOUND;
    end if;
    CLOSE C;
  EXCEPTION
    WHEN duplicate_name THEN
      FND_MESSAGE.Set_Name('OE', 'WSH_DEL_DUP_NAME');
      APP_EXCEPTION.Raise_Exception;
    WHEN null_name THEN
      FND_MESSAGE.Set_Name('OE', 'WSH_DEL_NULL_NAME');
      APP_EXCEPTION.Raise_Exception;
  END Insert_Row_new;



  PROCEDURE Delete_Row(X_Rowid VARCHAR2) IS
  BEGIN
    DELETE FROM wsh_deliveries
    WHERE rowid = X_Rowid;

    if (SQL%NOTFOUND) then
      Raise NO_DATA_FOUND;
    end if;
  END Delete_Row;


END WSH_DELIVERIES_PKG1;

/
