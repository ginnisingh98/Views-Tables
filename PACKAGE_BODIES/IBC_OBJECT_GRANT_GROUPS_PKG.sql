--------------------------------------------------------
--  DDL for Package Body IBC_OBJECT_GRANT_GROUPS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."IBC_OBJECT_GRANT_GROUPS_PKG" AS
/* $Header: ibctoggb.pls 115.3 2003/12/09 22:44:10 enunez ship $ */

-- MODIFICATION HISTORY
-- Person            Date        Comments
-- ---------         ------      ------------------------------------------
-- vicho	     11/05/2002     Remove G_MISS defaulting on UPDATE_ROW
-- enunez     02/12/2003     Updated to use new column INHERITANCE_TYPE
-- enunez     12/09/2003         default inheritance type when inserting


PROCEDURE INSERT_ROW (
  PX_ROWID IN OUT NOCOPY VARCHAR2,
  P_OBJECT_GRANT_GROUP_ID IN NUMBER,
  P_OBJECT_VERSION_NUMBER IN NUMBER,
  P_GRANT_GROUP_ID IN NUMBER,
  P_OBJECT_ID IN NUMBER,
  P_INHERITED_FLAG IN VARCHAR2,
  P_INHERITED_FROM IN NUMBER,
  P_INSTANCE_PK1_VALUE IN VARCHAR2,
  P_INSTANCE_PK2_VALUE IN VARCHAR2,
  P_INSTANCE_PK3_VALUE IN VARCHAR2,
  P_INSTANCE_PK4_VALUE IN VARCHAR2,
  P_INSTANCE_PK5_VALUE IN VARCHAR2,
  P_INHERITANCE_TYPE   IN VARCHAR2,
  p_CREATION_DATE IN DATE,
  p_CREATED_BY IN NUMBER,
  p_LAST_UPDATE_DATE IN DATE,
  p_LAST_UPDATED_BY IN NUMBER,
  p_LAST_UPDATE_LOGIN IN NUMBER
) IS
  CURSOR C IS SELECT ROWID FROM IBC_OBJECT_GRANT_GROUPS
    WHERE OBJECT_GRANT_GROUP_ID = P_OBJECT_GRANT_GROUP_ID
    ;
BEGIN
  INSERT INTO IBC_OBJECT_GRANT_GROUPS (
    OBJECT_VERSION_NUMBER,
    OBJECT_GRANT_GROUP_ID,
    GRANT_GROUP_ID,
    OBJECT_ID,
    INHERITED_FLAG,
    INHERITED_FROM,
    INSTANCE_PK1_VALUE,
    INSTANCE_PK2_VALUE,
    INSTANCE_PK3_VALUE,
    INSTANCE_PK4_VALUE,
    INSTANCE_PK5_VALUE,
    INHERITANCE_TYPE,
    CREATION_DATE,
    CREATED_BY,
    LAST_UPDATE_DATE,
    LAST_UPDATED_BY,
    LAST_UPDATE_LOGIN
  ) VALUES (
    P_OBJECT_VERSION_NUMBER,
    P_OBJECT_GRANT_GROUP_ID,
    P_GRANT_GROUP_ID,
    P_OBJECT_ID,
    P_INHERITED_FLAG,
    P_INHERITED_FROM,
    P_INSTANCE_PK1_VALUE,
    P_INSTANCE_PK2_VALUE,
    P_INSTANCE_PK3_VALUE,
    P_INSTANCE_PK4_VALUE,
    P_INSTANCE_PK5_VALUE,
    NVL(P_INHERITANCE_TYPE, 'FOLDER'),
    DECODE(p_creation_date, FND_API.G_MISS_DATE, SYSDATE, NULL, SYSDATE,p_creation_date),
    DECODE(p_created_by, FND_API.G_MISS_NUM, FND_GLOBAL.user_id,NULL, FND_GLOBAL.user_id, p_created_by),
    DECODE(p_last_update_date, FND_API.G_MISS_DATE, SYSDATE, NULL, SYSDATE,p_last_update_date),
    DECODE(p_last_updated_by, FND_API.G_MISS_NUM, FND_GLOBAL.user_id,NULL, FND_GLOBAL.user_id, p_last_updated_by),
    DECODE(p_last_update_login, FND_API.G_MISS_NUM, FND_GLOBAL.login_id,NULL, FND_GLOBAL.login_id, p_last_update_login)
 );

  OPEN c;
  FETCH c INTO PX_ROWID;
  IF (c%NOTFOUND) THEN
    CLOSE c;
    RAISE NO_DATA_FOUND;
  END IF;
  CLOSE c;

END INSERT_ROW;

PROCEDURE LOCK_ROW (
  P_OBJECT_GRANT_GROUP_ID IN NUMBER,
  P_OBJECT_VERSION_NUMBER IN NUMBER,
  P_GRANT_GROUP_ID IN NUMBER,
  P_OBJECT_ID IN NUMBER,
  P_INHERITED_FLAG IN VARCHAR2,
  P_INHERITED_FROM IN NUMBER,
  P_INSTANCE_PK1_VALUE IN VARCHAR2,
  P_INSTANCE_PK2_VALUE IN VARCHAR2,
  P_INSTANCE_PK3_VALUE IN VARCHAR2,
  P_INSTANCE_PK4_VALUE IN VARCHAR2,
  P_INSTANCE_PK5_VALUE IN VARCHAR2,
  P_INHERITANCE_TYPE   IN VARCHAR2
) IS
  CURSOR c IS SELECT
      OBJECT_VERSION_NUMBER,
      GRANT_GROUP_ID,
      OBJECT_ID,
      INHERITED_FLAG,
      INHERITED_FROM,
      INSTANCE_PK1_VALUE,
      INSTANCE_PK2_VALUE,
      INSTANCE_PK3_VALUE,
      INSTANCE_PK4_VALUE,
      INSTANCE_PK5_VALUE,
      INHERITANCE_TYPE
    FROM IBC_OBJECT_GRANT_GROUPS
    WHERE OBJECT_GRANT_GROUP_ID = P_OBJECT_GRANT_GROUP_ID
    FOR UPDATE OF OBJECT_GRANT_GROUP_ID NOWAIT;
  recinfo c%ROWTYPE;

BEGIN
  OPEN c;
  FETCH c INTO recinfo;
  IF (c%NOTFOUND) THEN
    CLOSE c;
    fnd_message.set_name('FND', 'FORM_RECORD_DELETED');
    app_exception.raise_exception;
  END IF;
  CLOSE c;
  IF (    (recinfo.OBJECT_VERSION_NUMBER = P_OBJECT_VERSION_NUMBER)
      AND (recinfo.GRANT_GROUP_ID = P_GRANT_GROUP_ID)
      AND (recinfo.OBJECT_ID = P_OBJECT_ID)
      AND (recinfo.INHERITED_FLAG = P_INHERITED_FLAG)
      AND ((recinfo.INHERITED_FROM = P_INHERITED_FROM)
           OR ((recinfo.INHERITED_FROM IS NULL) AND (P_INHERITED_FROM IS NULL)))
      AND (recinfo.INSTANCE_PK1_VALUE = P_INSTANCE_PK1_VALUE)
      AND ((recinfo.INSTANCE_PK2_VALUE = P_INSTANCE_PK2_VALUE)
           OR ((recinfo.INSTANCE_PK2_VALUE IS NULL) AND (P_INSTANCE_PK2_VALUE IS NULL)))
      AND ((recinfo.INSTANCE_PK3_VALUE = P_INSTANCE_PK3_VALUE)
           OR ((recinfo.INSTANCE_PK3_VALUE IS NULL) AND (P_INSTANCE_PK3_VALUE IS NULL)))
      AND ((recinfo.INSTANCE_PK4_VALUE = P_INSTANCE_PK4_VALUE)
           OR ((recinfo.INSTANCE_PK4_VALUE IS NULL) AND (P_INSTANCE_PK4_VALUE IS NULL)))
      AND ((recinfo.INSTANCE_PK5_VALUE = P_INSTANCE_PK5_VALUE)
           OR ((recinfo.INSTANCE_PK5_VALUE IS NULL) AND (P_INSTANCE_PK5_VALUE IS NULL)))
      AND ((recinfo.INHERITANCE_TYPE = P_INHERITANCE_TYPE)
           OR ((recinfo.INHERITANCE_TYPE IS NULL) AND (P_INHERITANCE_TYPE IS NULL)))
  ) THEN
    NULL;
  ELSE
    fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
    app_exception.raise_exception;
  END IF;

END LOCK_ROW;

PROCEDURE UPDATE_ROW (
  P_OBJECT_GRANT_GROUP_ID IN NUMBER,
  p_OBJECT_VERSION_NUMBER    IN  NUMBER,
  P_GRANT_GROUP_ID IN NUMBER,
  P_OBJECT_ID IN NUMBER,
  P_INHERITED_FLAG IN VARCHAR2,
  P_INHERITED_FROM IN NUMBER,
  P_INSTANCE_PK1_VALUE IN VARCHAR2,
  P_INSTANCE_PK2_VALUE IN VARCHAR2,
  P_INSTANCE_PK3_VALUE IN VARCHAR2,
  P_INSTANCE_PK4_VALUE IN VARCHAR2,
  P_INSTANCE_PK5_VALUE IN VARCHAR2,
  P_INHERITANCE_TYPE   IN VARCHAR2,
   p_LAST_UPDATED_BY   IN  NUMBER,
   p_LAST_UPDATE_DATE  IN  DATE,
   p_LAST_UPDATE_LOGIN IN  NUMBER
) IS
BEGIN
  UPDATE IBC_OBJECT_GRANT_GROUPS SET
    OBJECT_VERSION_NUMBER = OBJECT_VERSION_NUMBER + 1,
    GRANT_GROUP_ID = P_GRANT_GROUP_ID,
    OBJECT_ID = P_OBJECT_ID,
    INHERITED_FLAG = P_INHERITED_FLAG,
    INHERITED_FROM = P_INHERITED_FROM,
    INSTANCE_PK1_VALUE = P_INSTANCE_PK1_VALUE,
    INSTANCE_PK2_VALUE = P_INSTANCE_PK2_VALUE,
    INSTANCE_PK3_VALUE = P_INSTANCE_PK3_VALUE,
    INSTANCE_PK4_VALUE = P_INSTANCE_PK4_VALUE,
    INSTANCE_PK5_VALUE = P_INSTANCE_PK5_VALUE,
    INHERITANCE_TYPE   = NVL(P_INHERITANCE_TYPE, 'FOLDER'),
    last_update_date = DECODE(p_last_update_date, FND_API.G_MISS_DATE, SYSDATE,
                              NULL, SYSDATE, p_last_update_date),
    last_updated_by = DECODE(p_last_updated_by, FND_API.G_MISS_NUM,
                             FND_GLOBAL.user_id, NULL, FND_GLOBAL.user_id,
                             p_last_updated_by),
    last_update_login = DECODE(p_last_update_login, FND_API.G_MISS_NUM,
                             FND_GLOBAL.login_id, NULL, FND_GLOBAL.login_id,
                             p_last_update_login)
  WHERE OBJECT_GRANT_GROUP_ID = P_OBJECT_GRANT_GROUP_ID
  AND object_version_number = DECODE(p_object_version_number,
                                       FND_API.G_MISS_NUM,object_version_number,
                                       NULL,object_version_number,
                                       p_object_version_number);

  IF (SQL%NOTFOUND) THEN
    RAISE NO_DATA_FOUND;
  END IF;

END UPDATE_ROW;

PROCEDURE DELETE_ROW (
  P_OBJECT_GRANT_GROUP_ID IN NUMBER
) IS
BEGIN

  DELETE FROM IBC_OBJECT_GRANT_GROUPS
  WHERE OBJECT_GRANT_GROUP_ID = P_OBJECT_GRANT_GROUP_ID;

  IF (SQL%NOTFOUND) THEN
    RAISE NO_DATA_FOUND;
  END IF;
END DELETE_ROW;


END Ibc_Object_Grant_Groups_Pkg;

/
