--------------------------------------------------------
--  DDL for Package Body CE_CASHFLOW_HIST_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."CE_CASHFLOW_HIST_PKG" as
/* $Header: cebtathb.pls 120.3 2005/08/03 05:21:40 jikumar noship $ */



FUNCTION body_revision RETURN VARCHAR2 IS
 BEGIN

    RETURN '$Revision: 120.3 $';

 END body_revision;

FUNCTION spec_revision RETURN VARCHAR2 IS
 BEGIN

    RETURN G_spec_revision;

 END spec_revision;


PROCEDURE update_current_record_flag(p_cashflow	number) IS
 BEGIN
	UPDATE CE_CASHFLOW_ACCT_H
	SET CURRENT_RECORD_FLAG = 'N'
	WHERE cashflow_id = p_cashflow;

 EXCEPTION
	WHEN NO_DATA_FOUND THEN
	NULL;
	WHEN OTHERS THEN
	RAISE;

 END update_current_record_flag;


PROCEDURE INSERT_ROW (
			X_ROWID				 	IN OUT NOCOPY VARCHAR2,
			X_EVENT_ID				NUMBER,
			X_CASHFLOW_ID			NUMBER,
			X_EVENT_TYPE			VARCHAR2,
			X_ACCOUNTING_DATE		DATE,
			X_STATUS_CODE			VARCHAR2,
			X_CURR_RECORD_FLAG		VARCHAR2,
			X_CLEARED_DATE			DATE,
			X_CLEARED_AMOUNT		NUMBER,
			X_CLEARED_EXCH_RATE		NUMBER,
			X_CLEARED_EXCH_DATE		DATE,
			X_CLEARED_EXCH_TYPE		VARCHAR2,
			X_CLEARING_CHRG_AMT		NUMBER,
			X_CLEARING_ERR_AMT		NUMBER,
			X_REV_IND_FLAG			VARCHAR2,
			X_REV_FIRST_DIST_ID		NUMBER,
			X_REV_SECOND_DIST_NUM	VARCHAR2,
			X_CREATED_BY			NUMBER,
			X_CREATION_DATE			DATE,
			X_LAST_UPDATED_BY		NUMBER,
			X_LAST_UPDATE_DATE		DATE,
			X_LAST_UPDATE_LOGIN		NUMBER
			 ) IS


	CURSOR C IS SELECT ROWID FROM CE_CASHFLOW_ACCT_H
			WHERE EVENT_ID = X_EVENT_ID;

  BEGIN
	-- update the current record flag to N for all the respective cashflows
	update_current_record_flag(X_CASHFLOW_ID);

	INSERT INTO CE_CASHFLOW_ACCT_H
		( 	CASHFLOW_ID,
			EVENT_ID,
			EVENT_TYPE,
			ACCOUNTING_DATE,
			STATUS_CODE,
			CURRENT_RECORD_FLAG,
			CLEARED_DATE,
			CLEARED_AMOUNT,
			CLEARED_EXCHANGE_RATE,
			CLEARED_EXCHANGE_DATE,
			CLEARED_EXCHANGE_RATE_TYPE,
			CLEARING_CHARGES_AMOUNT,
			CLEARING_ERROR_AMOUNT,
			REVERSAL_INDICATOR_FLAG,
			REVERSAL_FIRST_DIST_ID,
			REVERSAL_SECOND_DIST_NUM,
			CREATED_BY,
			CREATION_DATE,
			LAST_UPDATED_BY,
			LAST_UPDATE_DATE,
			LAST_UPDATE_LOGIN,
			OBJECT_VERSION_NUMBER
		) VALUES
		( 	X_CASHFLOW_ID,
			X_EVENT_ID,
			X_EVENT_TYPE,
			X_ACCOUNTING_DATE,
			X_STATUS_CODE,
			X_CURR_RECORD_FLAG,
			X_CLEARED_DATE,
			X_CLEARED_AMOUNT,
			X_CLEARED_EXCH_RATE,
			X_CLEARED_EXCH_DATE,
			X_CLEARED_EXCH_TYPE,
			X_CLEARING_CHRG_AMT,
			X_CLEARING_ERR_AMT,
			X_REV_IND_FLAG,
			X_REV_FIRST_DIST_ID,
			X_REV_SECOND_DIST_NUM,
			X_CREATED_BY,
			X_CREATION_DATE,
			X_LAST_UPDATED_BY,
			X_LAST_UPDATE_DATE,
			X_LAST_UPDATE_LOGIN,
			'1'
		 );
	OPEN C;
    	FETCH C INTO X_rowid;
    		IF (C%NOTFOUND) THEN
      			CLOSE C;
      			Raise NO_DATA_FOUND;
    		END IF;
    	CLOSE C;

  END insert_row;


PROCEDURE UPDATE_ROW (
			X_ROWID				VARCHAR2,
			X_CASHFLOW_ID			NUMBER,
			X_EVENT_ID			NUMBER,
			X_EVENT_TYPE			VARCHAR2,
			X_ACCOUNTING_DATE		DATE,
			X_STATUS_CODE			VARCHAR2,
			X_CURR_RECORD_FLAG		VARCHAR2,
			X_CLEARED_DATE			DATE,
			X_CLEARED_AMOUNT		NUMBER,
			X_CLEARED_EXCH_RATE		NUMBER,
			X_CLEARED_EXCH_DATE		DATE,
			X_CLEARED_EXCH_TYPE		VARCHAR2,
			X_CLEARING_CHRG_AMT		NUMBER,
			X_CLEARING_ERR_AMT		NUMBER,
			X_REV_IND_FLAG			VARCHAR2,
			X_REV_FIRST_DIST_ID		NUMBER,
			X_REV_SECOND_DIST_NUM	VARCHAR2,
			X_LAST_UPDATED_BY		NUMBER,
			X_LAST_UPDATE_DATE		DATE,
			X_LAST_UPDATE_LOGIN		NUMBER,
			X_OBJECT_VERSION_NUMBER		NUMBER ) IS
  BEGIN

	UPDATE CE_CASHFLOW_ACCT_H
	SET
			CASHFLOW_ID 			= 	X_CASHFLOW_ID,
			EVENT_ID				=	X_EVENT_ID,
			EVENT_TYPE				=	X_EVENT_TYPE,
			ACCOUNTING_DATE			= 	X_ACCOUNTING_DATE,
			STATUS_CODE				=	X_STATUS_CODE,
			CURRENT_RECORD_FLAG		= 	X_CURR_RECORD_FLAG,
			CLEARED_DATE			= 	X_CLEARED_DATE,
			CLEARED_AMOUNT			=		X_CLEARED_AMOUNT,
			CLEARED_EXCHANGE_RATE	= X_CLEARED_EXCH_RATE,
			CLEARED_EXCHANGE_DATE	= X_CLEARED_EXCH_DATE,
			CLEARED_EXCHANGE_RATE_TYPE = X_CLEARED_EXCH_TYPE,
			CLEARING_CHARGES_AMOUNT = 	X_CLEARING_CHRG_AMT,
			CLEARING_ERROR_AMOUNT	= 	X_CLEARING_ERR_AMT,
			REVERSAL_INDICATOR_FLAG =	X_REV_IND_FLAG,
			REVERSAL_FIRST_DIST_ID	= 	X_REV_FIRST_DIST_ID,
			REVERSAL_SECOND_DIST_NUM	= X_REV_SECOND_DIST_NUM,
			LAST_UPDATED_BY			= 	X_LAST_UPDATED_BY,
			LAST_UPDATE_DATE		= 	X_LAST_UPDATE_DATE,
			LAST_UPDATE_LOGIN		= 	X_LAST_UPDATE_LOGIN,
			OBJECT_VERSION_NUMBER   = OBJECT_VERSION_NUMBER + 1
	WHERE
		OBJECT_VERSION_NUMBER = X_OBJECT_VERSION_NUMBER AND
		ROWID = X_ROWID;

	IF (SQL%NOTFOUND) THEN
		Raise NO_DATA_FOUND;
	END IF;


  END UPDATE_ROW;

PROCEDURE Delete_Row( X_Row_id VARCHAR2 ) IS
  BEGIN
    DELETE FROM CE_CASHFLOW_ACCT_H
    WHERE rowid = X_Row_Id;
    IF (SQL%NOTFOUND) THEN
      Raise NO_DATA_FOUND;
    END IF;
  END Delete_Row;


END CE_CASHFLOW_HIST_PKG;

/
