--------------------------------------------------------
--  DDL for Package Body PSB_PSBOTGLR_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PSB_PSBOTGLR_XMLP_PKG" AS
/* $Header: PSBOTGLRB.pls 120.0 2008/01/07 10:28:58 vijranga noship $ */
  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  BEGIN
    P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
    /*SRW.USER_EXIT('FND SRWINIT')*/NULL;
    IF (GET_NLS_STRINGS <> TRUE) THEN
      NULL;
    END IF;
    DECLARE
      L_SKIP VARCHAR2(1);
      COAID NUMBER;
      SOBNAME VARCHAR2(30);
      SUMMDET VARCHAR2(1);
      FUNCTCURR VARCHAR2(15);
      ERRBUF VARCHAR2(132);
      ERRBUF2 VARCHAR2(132);
      CURSOR B IS
        SELECT
          GL_BUDGET_SET_NAME
        FROM
          PSB_GL_BUDGET_SETS
        WHERE GL_BUDGET_SET_ID = P_GL_BUDGET_SET_ID;
      CURSOR REV1 IS
        SELECT
          DECODE(BG.ROOT_CHART_OF_ACCOUNTS_ID
                ,NULL
                ,BG.CHART_OF_ACCOUNTS_ID
                ,BG.ROOT_CHART_OF_ACCOUNTS_ID) R_COA,
          DECODE(BG.ROOT_CURRENCY_CODE
                ,NULL
                ,BG.CURRENCY_CODE
                ,BG.ROOT_CURRENCY_CODE) R_CURR,
          DECODE(BG.ROOT_SOB_NAME
                ,NULL
                ,BG.SOB_NAME
                ,BG.ROOT_SOB_NAME) R_SOB,
          REV.BUDGET_REVISION_TYPE,
          REV.PERMANENT_REVISION
        FROM
          PSB_BUDGET_REVISIONS REV,
          PSB_BUDGET_GROUPS_V BG
        WHERE REV.BUDGET_GROUP_ID = NVL(BG.BUDGET_GROUP_ID
           ,BG.ROOT_SET_OF_BOOKS_ID)
          AND REV.BUDGET_REVISION_ID = P_WORKSHEET_ID;
    BEGIN
      IF P_CURRENCY_CODE = 'C' THEN
        P_BUDGET_SOURCE_TYPE := 'BP';
      ELSIF P_CURRENCY_CODE = 'STAT' THEN
        P_BUDGET_SOURCE_TYPE := 'SW';
      END IF;
      IF P_BUDGET_SOURCE_TYPE = 'BP' OR P_BUDGET_SOURCE_TYPE = 'SW' THEN
        SELECT
          DECODE(BG.ROOT_CHART_OF_ACCOUNTS_ID
                ,NULL
                ,BG.CHART_OF_ACCOUNTS_ID
                ,BG.ROOT_CHART_OF_ACCOUNTS_ID),
          DECODE(BG.ROOT_CURRENCY_CODE
                ,NULL
                ,BG.CURRENCY_CODE
                ,BG.ROOT_CURRENCY_CODE),
          DECODE(BG.ROOT_SOB_NAME
                ,NULL
                ,BG.SOB_NAME
                ,BG.ROOT_SOB_NAME)
        INTO COAID,CP_CURRENCY_CODE,CP_SOB_NAME
        FROM
          PSB_BUDGET_GROUPS_V BG,
          PSB_WORKSHEETS WS
        WHERE WS.BUDGET_GROUP_ID = NVL(BG.BUDGET_GROUP_ID
           ,BG.ROOT_BUDGET_GROUP_ID)
          AND WS.WORKSHEET_ID = P_WORKSHEET_ID;
      ELSE
        FOR rev1_rec IN REV1 LOOP
          CP_CURRENCY_CODE := REV1_REC.R_CURR;
          CP_SOB_NAME := REV1_REC.R_SOB;
          CP_REVISION_TYPE := REV1_REC.BUDGET_REVISION_TYPE;
          CP_PERMANENT_REVISION := REV1_REC.PERMANENT_REVISION;
        END LOOP;
      END IF;
      IF P_ORDER_BY1 IS NOT NULL THEN
        CP_SORT := ' , ' || P_ORDER_BY1;
        IF P_ORDER_BY2 IS NOT NULL THEN
          CP_SORT := CP_SORT || ' , ' || P_ORDER_BY2;
          IF P_ORDER_BY3 IS NOT NULL THEN
            CP_SORT := CP_SORT || ' , ' || P_ORDER_BY3;
          END IF;
        END IF;
        CP_SORT := CP_SORT || '  ORDER BY  ' || SUBSTR(CP_SORT
                         ,INSTR(CP_SORT
                              ,','
                              ,1
                              ,1) + 1);
      END IF;
      IF CP_SORT IS NULL THEN
      CP_SORT := ' ';
      END IF;
      RETURN (TRUE);
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        RETURN NULL;
      WHEN OTHERS THEN
        RETURN NULL;
    END;
  END BEFOREREPORT;
  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
    /*SRW.USER_EXIT('FND SRWINIT')*/NULL;
    /*SRW.USER_EXIT('FND SRWEXIT')*/NULL;
    RETURN (TRUE);
  END AFTERREPORT;
  FUNCTION GET_NLS_STRINGS RETURN BOOLEAN IS
  BEGIN
    FND_MESSAGE.SET_NAME('PSB'
                        ,'PSB_NO_DATA_FOUND');
    C_NLS_NO_DATA_EXISTS := FND_MESSAGE.GET;
    FND_MESSAGE.SET_NAME('PSB'
                        ,'PSB_END_OF_REPORT');
    C_NLS_END_OF_REPORT := FND_MESSAGE.GET;
    RETURN (TRUE);
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (FALSE);
  END GET_NLS_STRINGS;
  FUNCTION BEFOREPFORM RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END BEFOREPFORM;
  FUNCTION AFTERPFORM RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END AFTERPFORM;
  FUNCTION BETWEENPAGE RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END BETWEENPAGE;
  FUNCTION CP_1_P RETURN NUMBER IS
  BEGIN
    RETURN CP_1;
  END CP_1_P;
  FUNCTION SELECT_DR_P RETURN VARCHAR2 IS
  BEGIN
    RETURN SELECT_DR;
  END SELECT_DR_P;
  FUNCTION CP_CURRENCY_CODE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_CURRENCY_CODE;
  END CP_CURRENCY_CODE_P;
  FUNCTION CP_SOB_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_SOB_NAME;
  END CP_SOB_NAME_P;
  FUNCTION SELECT_CR_P RETURN VARCHAR2 IS
  BEGIN
    RETURN SELECT_CR;
  END SELECT_CR_P;
  FUNCTION SELECT_ALL_P RETURN VARCHAR2 IS
  BEGIN
    RETURN SELECT_ALL;
  END SELECT_ALL_P;
  FUNCTION STRUCT_NUM_P RETURN VARCHAR2 IS
  BEGIN
    RETURN STRUCT_NUM;
  END STRUCT_NUM_P;
  FUNCTION C_NLS_END_OF_REPORT_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_NLS_END_OF_REPORT;
  END C_NLS_END_OF_REPORT_P;
  FUNCTION C_NLS_NO_DATA_EXISTS_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_NLS_NO_DATA_EXISTS;
  END C_NLS_NO_DATA_EXISTS_P;
  FUNCTION CP_BUDGET_STAGE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_BUDGET_STAGE;
  END CP_BUDGET_STAGE_P;
  FUNCTION CP_BUDGET_YEAR_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_BUDGET_YEAR;
  END CP_BUDGET_YEAR_P;
  FUNCTION CP_BUDGET_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_BUDGET_NAME;
  END CP_BUDGET_NAME_P;
  FUNCTION CP_CATEGORY_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_CATEGORY;
  END CP_CATEGORY_P;
  FUNCTION CP_SUMMDET_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_SUMMDET;
  END CP_SUMMDET_P;
  FUNCTION ACCOUNTING_SEGMENT_P RETURN VARCHAR2 IS
  BEGIN
    RETURN ACCOUNTING_SEGMENT;
  END ACCOUNTING_SEGMENT_P;
  FUNCTION CP_SORT_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_SORT;
  END CP_SORT_P;
  FUNCTION CP_BUDGET_SET_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_BUDGET_SET_NAME;
  END CP_BUDGET_SET_NAME_P;
  FUNCTION CP_REVISION_TYPE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_REVISION_TYPE;
  END CP_REVISION_TYPE_P;
  FUNCTION CP_PERMANENT_REVISION_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_PERMANENT_REVISION;
  END CP_PERMANENT_REVISION_P;
  FUNCTION CP_BUDGET_YEAR_ID_P RETURN NUMBER IS
  BEGIN
    RETURN CP_BUDGET_YEAR_ID;
  END CP_BUDGET_YEAR_ID_P;
  FUNCTION CP_BUDGET_SET_ID_P RETURN NUMBER IS
  BEGIN
    RETURN CP_BUDGET_SET_ID;
  END CP_BUDGET_SET_ID_P;
END PSB_PSBOTGLR_XMLP_PKG;







/
