--------------------------------------------------------
--  DDL for Package Body BSC_KPI_DEFAULTS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."BSC_KPI_DEFAULTS_PKG" as
/* $Header: BSCKPIDB.pls 115.6 2003/02/12 14:25:56 adrao ship $ */
procedure INSERT_ROW (
  X_ROWID in out NOCOPY VARCHAR2,
  X_TAB_ID in NUMBER,
  X_INDICATOR in NUMBER,
  X_FORMAT_MASK in VARCHAR2,
  X_COLOR_METHOD in NUMBER,
  X_COLOR_LEVEL1 in NUMBER,
  X_COLOR_LEVEL2 in NUMBER,
  X_COLOR_LEVEL3 in NUMBER,
  X_COLOR_LEVEL4 in NUMBER,
  X_DIM_SET_ID in NUMBER,
  X_DIM_LEVEL1_VALUE in NUMBER,
  X_DIM_LEVEL2_VALUE in NUMBER,
  X_DIM_LEVEL3_VALUE in NUMBER,
  X_DIM_LEVEL4_VALUE in NUMBER,
  X_DIM_LEVEL5_VALUE in NUMBER,
  X_DIM_LEVEL6_VALUE in NUMBER,
  X_DIM_LEVEL7_VALUE in NUMBER,
  X_DIM_LEVEL8_VALUE in NUMBER,
  X_ANALYSIS_OPTION0_NAME in VARCHAR2,
  X_ANALYSIS_OPTION1_NAME in VARCHAR2,
  X_ANALYSIS_OPTION2_NAME in VARCHAR2,
  X_PERIOD_NAME in VARCHAR2,
  X_SERIES_NAME in VARCHAR2,
  X_DIM_LEVEL1_NAME in VARCHAR2,
  X_DIM_LEVEL2_NAME in VARCHAR2,
  X_DIM_LEVEL3_NAME in VARCHAR2,
  X_DIM_LEVEL4_NAME in VARCHAR2,
  X_DIM_LEVEL5_NAME in VARCHAR2,
  X_DIM_LEVEL6_NAME in VARCHAR2,
  X_DIM_LEVEL7_NAME in VARCHAR2,
  X_DIM_LEVEL8_NAME in VARCHAR2,
  X_DIM_LEVEL1_TEXT in VARCHAR2,
  X_DIM_LEVEL2_TEXT in VARCHAR2,
  X_DIM_LEVEL3_TEXT in VARCHAR2,
  X_DIM_LEVEL4_TEXT in VARCHAR2,
  X_DIM_LEVEL5_TEXT in VARCHAR2,
  X_DIM_LEVEL6_TEXT in VARCHAR2,
  X_DIM_LEVEL7_TEXT in VARCHAR2,
  X_DIM_LEVEL8_TEXT in VARCHAR2
) is
  cursor C is select ROWID from BSC_KPI_DEFAULTS_B
    where TAB_ID = X_TAB_ID
    and INDICATOR = X_INDICATOR
    ;
begin
  insert into BSC_KPI_DEFAULTS_B (
    TAB_ID,
    INDICATOR,
    FORMAT_MASK,
    COLOR_METHOD,
    COLOR_LEVEL1,
    COLOR_LEVEL2,
    COLOR_LEVEL3,
    COLOR_LEVEL4,
    DIM_SET_ID,
    DIM_LEVEL1_VALUE,
    DIM_LEVEL2_VALUE,
    DIM_LEVEL3_VALUE,
    DIM_LEVEL4_VALUE,
    DIM_LEVEL5_VALUE,
    DIM_LEVEL6_VALUE,
    DIM_LEVEL7_VALUE,
    DIM_LEVEL8_VALUE
  ) values (
    X_TAB_ID,
    X_INDICATOR,
    X_FORMAT_MASK,
    X_COLOR_METHOD,
    X_COLOR_LEVEL1,
    X_COLOR_LEVEL2,
    X_COLOR_LEVEL3,
    X_COLOR_LEVEL4,
    X_DIM_SET_ID,
    X_DIM_LEVEL1_VALUE,
    X_DIM_LEVEL2_VALUE,
    X_DIM_LEVEL3_VALUE,
    X_DIM_LEVEL4_VALUE,
    X_DIM_LEVEL5_VALUE,
    X_DIM_LEVEL6_VALUE,
    X_DIM_LEVEL7_VALUE,
    X_DIM_LEVEL8_VALUE
  );

  insert into BSC_KPI_DEFAULTS_TL (
    TAB_ID,
    INDICATOR,
    ANALYSIS_OPTION0_NAME,
    ANALYSIS_OPTION1_NAME,
    ANALYSIS_OPTION2_NAME,
    PERIOD_NAME,
    SERIES_NAME,
    DIM_LEVEL1_NAME,
    DIM_LEVEL2_NAME,
    DIM_LEVEL3_NAME,
    DIM_LEVEL4_NAME,
    DIM_LEVEL5_NAME,
    DIM_LEVEL6_NAME,
    DIM_LEVEL7_NAME,
    DIM_LEVEL8_NAME,
    DIM_LEVEL1_TEXT,
    DIM_LEVEL2_TEXT,
    DIM_LEVEL3_TEXT,
    DIM_LEVEL4_TEXT,
    DIM_LEVEL5_TEXT,
    DIM_LEVEL6_TEXT,
    DIM_LEVEL7_TEXT,
    DIM_LEVEL8_TEXT,
    LANGUAGE,
    SOURCE_LANG
  ) select
    X_TAB_ID,
    X_INDICATOR,
    X_ANALYSIS_OPTION0_NAME,
    X_ANALYSIS_OPTION1_NAME,
    X_ANALYSIS_OPTION2_NAME,
    X_PERIOD_NAME,
    X_SERIES_NAME,
    X_DIM_LEVEL1_NAME,
    X_DIM_LEVEL2_NAME,
    X_DIM_LEVEL3_NAME,
    X_DIM_LEVEL4_NAME,
    X_DIM_LEVEL5_NAME,
    X_DIM_LEVEL6_NAME,
    X_DIM_LEVEL7_NAME,
    X_DIM_LEVEL8_NAME,
    X_DIM_LEVEL1_TEXT,
    X_DIM_LEVEL2_TEXT,
    X_DIM_LEVEL3_TEXT,
    X_DIM_LEVEL4_TEXT,
    X_DIM_LEVEL5_TEXT,
    X_DIM_LEVEL6_TEXT,
    X_DIM_LEVEL7_TEXT,
    X_DIM_LEVEL8_TEXT,
    L.LANGUAGE_CODE,
    userenv('LANG')
  from FND_LANGUAGES L
  where L.INSTALLED_FLAG in ('I', 'B')
  and not exists
    (select NULL
    from BSC_KPI_DEFAULTS_TL T
    where T.TAB_ID = X_TAB_ID
    and T.INDICATOR = X_INDICATOR
    and T.LANGUAGE = L.LANGUAGE_CODE);

  open c;
  fetch c into X_ROWID;
  if (c%notfound) then
    close c;
    raise no_data_found;
  end if;
  close c;

end INSERT_ROW;

procedure LOCK_ROW (
  X_TAB_ID in NUMBER,
  X_INDICATOR in NUMBER,
  X_FORMAT_MASK in VARCHAR2,
  X_COLOR_METHOD in NUMBER,
  X_COLOR_LEVEL1 in NUMBER,
  X_COLOR_LEVEL2 in NUMBER,
  X_COLOR_LEVEL3 in NUMBER,
  X_COLOR_LEVEL4 in NUMBER,
  X_DIM_SET_ID in NUMBER,
  X_DIM_LEVEL1_VALUE in NUMBER,
  X_DIM_LEVEL2_VALUE in NUMBER,
  X_DIM_LEVEL3_VALUE in NUMBER,
  X_DIM_LEVEL4_VALUE in NUMBER,
  X_DIM_LEVEL5_VALUE in NUMBER,
  X_DIM_LEVEL6_VALUE in NUMBER,
  X_DIM_LEVEL7_VALUE in NUMBER,
  X_DIM_LEVEL8_VALUE in NUMBER,
  X_ANALYSIS_OPTION0_NAME in VARCHAR2,
  X_ANALYSIS_OPTION1_NAME in VARCHAR2,
  X_ANALYSIS_OPTION2_NAME in VARCHAR2,
  X_PERIOD_NAME in VARCHAR2,
  X_SERIES_NAME in VARCHAR2,
  X_DIM_LEVEL1_NAME in VARCHAR2,
  X_DIM_LEVEL2_NAME in VARCHAR2,
  X_DIM_LEVEL3_NAME in VARCHAR2,
  X_DIM_LEVEL4_NAME in VARCHAR2,
  X_DIM_LEVEL5_NAME in VARCHAR2,
  X_DIM_LEVEL6_NAME in VARCHAR2,
  X_DIM_LEVEL7_NAME in VARCHAR2,
  X_DIM_LEVEL8_NAME in VARCHAR2,
  X_DIM_LEVEL1_TEXT in VARCHAR2,
  X_DIM_LEVEL2_TEXT in VARCHAR2,
  X_DIM_LEVEL3_TEXT in VARCHAR2,
  X_DIM_LEVEL4_TEXT in VARCHAR2,
  X_DIM_LEVEL5_TEXT in VARCHAR2,
  X_DIM_LEVEL6_TEXT in VARCHAR2,
  X_DIM_LEVEL7_TEXT in VARCHAR2,
  X_DIM_LEVEL8_TEXT in VARCHAR2
) is
  cursor c is select
      FORMAT_MASK,
      COLOR_METHOD,
      COLOR_LEVEL1,
      COLOR_LEVEL2,
      COLOR_LEVEL3,
      COLOR_LEVEL4,
      DIM_SET_ID,
      DIM_LEVEL1_VALUE,
      DIM_LEVEL2_VALUE,
      DIM_LEVEL3_VALUE,
      DIM_LEVEL4_VALUE,
      DIM_LEVEL5_VALUE,
      DIM_LEVEL6_VALUE,
      DIM_LEVEL7_VALUE,
      DIM_LEVEL8_VALUE
    from BSC_KPI_DEFAULTS_B
    where TAB_ID = X_TAB_ID
    and INDICATOR = X_INDICATOR
    for update of TAB_ID nowait;
  recinfo c%rowtype;

  cursor c1 is select
      ANALYSIS_OPTION0_NAME,
      ANALYSIS_OPTION1_NAME,
      ANALYSIS_OPTION2_NAME,
      PERIOD_NAME,
      SERIES_NAME,
      DIM_LEVEL1_NAME,
      DIM_LEVEL2_NAME,
      DIM_LEVEL3_NAME,
      DIM_LEVEL4_NAME,
      DIM_LEVEL5_NAME,
      DIM_LEVEL6_NAME,
      DIM_LEVEL7_NAME,
      DIM_LEVEL8_NAME,
      DIM_LEVEL1_TEXT,
      DIM_LEVEL2_TEXT,
      DIM_LEVEL3_TEXT,
      DIM_LEVEL4_TEXT,
      DIM_LEVEL5_TEXT,
      DIM_LEVEL6_TEXT,
      DIM_LEVEL7_TEXT,
      DIM_LEVEL8_TEXT,
      decode(LANGUAGE, userenv('LANG'), 'Y', 'N') BASELANG
    from BSC_KPI_DEFAULTS_TL
    where TAB_ID = X_TAB_ID
    and INDICATOR = X_INDICATOR
    and userenv('LANG') in (LANGUAGE, SOURCE_LANG)
    for update of TAB_ID nowait;
begin
  open c;
  fetch c into recinfo;
  if (c%notfound) then
    close c;
    fnd_message.set_name('FND', 'FORM_RECORD_DELETED');
    app_exception.raise_exception;
  end if;
  close c;
  if (    ((recinfo.FORMAT_MASK = X_FORMAT_MASK)
           OR ((recinfo.FORMAT_MASK is null) AND (X_FORMAT_MASK is null)))
      AND ((recinfo.COLOR_METHOD = X_COLOR_METHOD)
           OR ((recinfo.COLOR_METHOD is null) AND (X_COLOR_METHOD is null)))
      AND ((recinfo.COLOR_LEVEL1 = X_COLOR_LEVEL1)
           OR ((recinfo.COLOR_LEVEL1 is null) AND (X_COLOR_LEVEL1 is null)))
      AND ((recinfo.COLOR_LEVEL2 = X_COLOR_LEVEL2)
           OR ((recinfo.COLOR_LEVEL2 is null) AND (X_COLOR_LEVEL2 is null)))
      AND ((recinfo.COLOR_LEVEL3 = X_COLOR_LEVEL3)
           OR ((recinfo.COLOR_LEVEL3 is null) AND (X_COLOR_LEVEL3 is null)))
      AND ((recinfo.COLOR_LEVEL4 = X_COLOR_LEVEL4)
           OR ((recinfo.COLOR_LEVEL4 is null) AND (X_COLOR_LEVEL4 is null)))
      AND ((recinfo.DIM_SET_ID = X_DIM_SET_ID)
           OR ((recinfo.DIM_SET_ID is null) AND (X_DIM_SET_ID is null)))
      AND ((recinfo.DIM_LEVEL1_VALUE = X_DIM_LEVEL1_VALUE)
           OR ((recinfo.DIM_LEVEL1_VALUE is null) AND (X_DIM_LEVEL1_VALUE is null)))
      AND ((recinfo.DIM_LEVEL2_VALUE = X_DIM_LEVEL2_VALUE)
           OR ((recinfo.DIM_LEVEL2_VALUE is null) AND (X_DIM_LEVEL2_VALUE is null)))
      AND ((recinfo.DIM_LEVEL3_VALUE = X_DIM_LEVEL3_VALUE)
           OR ((recinfo.DIM_LEVEL3_VALUE is null) AND (X_DIM_LEVEL3_VALUE is null)))
      AND ((recinfo.DIM_LEVEL4_VALUE = X_DIM_LEVEL4_VALUE)
           OR ((recinfo.DIM_LEVEL4_VALUE is null) AND (X_DIM_LEVEL4_VALUE is null)))
      AND ((recinfo.DIM_LEVEL5_VALUE = X_DIM_LEVEL5_VALUE)
           OR ((recinfo.DIM_LEVEL5_VALUE is null) AND (X_DIM_LEVEL5_VALUE is null)))
      AND ((recinfo.DIM_LEVEL6_VALUE = X_DIM_LEVEL6_VALUE)
           OR ((recinfo.DIM_LEVEL6_VALUE is null) AND (X_DIM_LEVEL6_VALUE is null)))
      AND ((recinfo.DIM_LEVEL7_VALUE = X_DIM_LEVEL7_VALUE)
           OR ((recinfo.DIM_LEVEL7_VALUE is null) AND (X_DIM_LEVEL7_VALUE is null)))
      AND ((recinfo.DIM_LEVEL8_VALUE = X_DIM_LEVEL8_VALUE)
           OR ((recinfo.DIM_LEVEL8_VALUE is null) AND (X_DIM_LEVEL8_VALUE is null)))
  ) then
    null;
  else
    fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
    app_exception.raise_exception;
  end if;

  for tlinfo in c1 loop
    if (tlinfo.BASELANG = 'Y') then
      if (    ((tlinfo.ANALYSIS_OPTION0_NAME = X_ANALYSIS_OPTION0_NAME)
               OR ((tlinfo.ANALYSIS_OPTION0_NAME is null) AND (X_ANALYSIS_OPTION0_NAME is null)))
          AND ((tlinfo.ANALYSIS_OPTION1_NAME = X_ANALYSIS_OPTION1_NAME)
               OR ((tlinfo.ANALYSIS_OPTION1_NAME is null) AND (X_ANALYSIS_OPTION1_NAME is null)))
          AND ((tlinfo.ANALYSIS_OPTION2_NAME = X_ANALYSIS_OPTION2_NAME)
               OR ((tlinfo.ANALYSIS_OPTION2_NAME is null) AND (X_ANALYSIS_OPTION2_NAME is null)))
          AND ((tlinfo.PERIOD_NAME = X_PERIOD_NAME)
               OR ((tlinfo.PERIOD_NAME is null) AND (X_PERIOD_NAME is null)))
          AND ((tlinfo.SERIES_NAME = X_SERIES_NAME)
               OR ((tlinfo.SERIES_NAME is null) AND (X_SERIES_NAME is null)))
          AND ((tlinfo.DIM_LEVEL1_NAME = X_DIM_LEVEL1_NAME)
               OR ((tlinfo.DIM_LEVEL1_NAME is null) AND (X_DIM_LEVEL1_NAME is null)))
          AND ((tlinfo.DIM_LEVEL2_NAME = X_DIM_LEVEL2_NAME)
               OR ((tlinfo.DIM_LEVEL2_NAME is null) AND (X_DIM_LEVEL2_NAME is null)))
          AND ((tlinfo.DIM_LEVEL3_NAME = X_DIM_LEVEL3_NAME)
               OR ((tlinfo.DIM_LEVEL3_NAME is null) AND (X_DIM_LEVEL3_NAME is null)))
          AND ((tlinfo.DIM_LEVEL4_NAME = X_DIM_LEVEL4_NAME)
               OR ((tlinfo.DIM_LEVEL4_NAME is null) AND (X_DIM_LEVEL4_NAME is null)))
          AND ((tlinfo.DIM_LEVEL5_NAME = X_DIM_LEVEL5_NAME)
               OR ((tlinfo.DIM_LEVEL5_NAME is null) AND (X_DIM_LEVEL5_NAME is null)))
          AND ((tlinfo.DIM_LEVEL6_NAME = X_DIM_LEVEL6_NAME)
               OR ((tlinfo.DIM_LEVEL6_NAME is null) AND (X_DIM_LEVEL6_NAME is null)))
          AND ((tlinfo.DIM_LEVEL7_NAME = X_DIM_LEVEL7_NAME)
               OR ((tlinfo.DIM_LEVEL7_NAME is null) AND (X_DIM_LEVEL7_NAME is null)))
          AND ((tlinfo.DIM_LEVEL8_NAME = X_DIM_LEVEL8_NAME)
               OR ((tlinfo.DIM_LEVEL8_NAME is null) AND (X_DIM_LEVEL8_NAME is null)))
          AND ((tlinfo.DIM_LEVEL1_TEXT = X_DIM_LEVEL1_TEXT)
               OR ((tlinfo.DIM_LEVEL1_TEXT is null) AND (X_DIM_LEVEL1_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL2_TEXT = X_DIM_LEVEL2_TEXT)
               OR ((tlinfo.DIM_LEVEL2_TEXT is null) AND (X_DIM_LEVEL2_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL3_TEXT = X_DIM_LEVEL3_TEXT)
               OR ((tlinfo.DIM_LEVEL3_TEXT is null) AND (X_DIM_LEVEL3_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL4_TEXT = X_DIM_LEVEL4_TEXT)
               OR ((tlinfo.DIM_LEVEL4_TEXT is null) AND (X_DIM_LEVEL4_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL5_TEXT = X_DIM_LEVEL5_TEXT)
               OR ((tlinfo.DIM_LEVEL5_TEXT is null) AND (X_DIM_LEVEL5_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL6_TEXT = X_DIM_LEVEL6_TEXT)
               OR ((tlinfo.DIM_LEVEL6_TEXT is null) AND (X_DIM_LEVEL6_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL7_TEXT = X_DIM_LEVEL7_TEXT)
               OR ((tlinfo.DIM_LEVEL7_TEXT is null) AND (X_DIM_LEVEL7_TEXT is null)))
          AND ((tlinfo.DIM_LEVEL8_TEXT = X_DIM_LEVEL8_TEXT)
               OR ((tlinfo.DIM_LEVEL8_TEXT is null) AND (X_DIM_LEVEL8_TEXT is null)))
      ) then
        null;
      else
        fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
        app_exception.raise_exception;
      end if;
    end if;
  end loop;
  return;
end LOCK_ROW;

procedure UPDATE_ROW (
  X_TAB_ID in NUMBER,
  X_INDICATOR in NUMBER,
  X_FORMAT_MASK in VARCHAR2,
  X_COLOR_METHOD in NUMBER,
  X_COLOR_LEVEL1 in NUMBER,
  X_COLOR_LEVEL2 in NUMBER,
  X_COLOR_LEVEL3 in NUMBER,
  X_COLOR_LEVEL4 in NUMBER,
  X_DIM_SET_ID in NUMBER,
  X_DIM_LEVEL1_VALUE in NUMBER,
  X_DIM_LEVEL2_VALUE in NUMBER,
  X_DIM_LEVEL3_VALUE in NUMBER,
  X_DIM_LEVEL4_VALUE in NUMBER,
  X_DIM_LEVEL5_VALUE in NUMBER,
  X_DIM_LEVEL6_VALUE in NUMBER,
  X_DIM_LEVEL7_VALUE in NUMBER,
  X_DIM_LEVEL8_VALUE in NUMBER,
  X_ANALYSIS_OPTION0_NAME in VARCHAR2,
  X_ANALYSIS_OPTION1_NAME in VARCHAR2,
  X_ANALYSIS_OPTION2_NAME in VARCHAR2,
  X_PERIOD_NAME in VARCHAR2,
  X_SERIES_NAME in VARCHAR2,
  X_DIM_LEVEL1_NAME in VARCHAR2,
  X_DIM_LEVEL2_NAME in VARCHAR2,
  X_DIM_LEVEL3_NAME in VARCHAR2,
  X_DIM_LEVEL4_NAME in VARCHAR2,
  X_DIM_LEVEL5_NAME in VARCHAR2,
  X_DIM_LEVEL6_NAME in VARCHAR2,
  X_DIM_LEVEL7_NAME in VARCHAR2,
  X_DIM_LEVEL8_NAME in VARCHAR2,
  X_DIM_LEVEL1_TEXT in VARCHAR2,
  X_DIM_LEVEL2_TEXT in VARCHAR2,
  X_DIM_LEVEL3_TEXT in VARCHAR2,
  X_DIM_LEVEL4_TEXT in VARCHAR2,
  X_DIM_LEVEL5_TEXT in VARCHAR2,
  X_DIM_LEVEL6_TEXT in VARCHAR2,
  X_DIM_LEVEL7_TEXT in VARCHAR2,
  X_DIM_LEVEL8_TEXT in VARCHAR2
) is
begin
  update BSC_KPI_DEFAULTS_B set
    FORMAT_MASK = X_FORMAT_MASK,
    COLOR_METHOD = X_COLOR_METHOD,
    COLOR_LEVEL1 = X_COLOR_LEVEL1,
    COLOR_LEVEL2 = X_COLOR_LEVEL2,
    COLOR_LEVEL3 = X_COLOR_LEVEL3,
    COLOR_LEVEL4 = X_COLOR_LEVEL4,
    DIM_SET_ID = X_DIM_SET_ID,
    DIM_LEVEL1_VALUE = X_DIM_LEVEL1_VALUE,
    DIM_LEVEL2_VALUE = X_DIM_LEVEL2_VALUE,
    DIM_LEVEL3_VALUE = X_DIM_LEVEL3_VALUE,
    DIM_LEVEL4_VALUE = X_DIM_LEVEL4_VALUE,
    DIM_LEVEL5_VALUE = X_DIM_LEVEL5_VALUE,
    DIM_LEVEL6_VALUE = X_DIM_LEVEL6_VALUE,
    DIM_LEVEL7_VALUE = X_DIM_LEVEL7_VALUE,
    DIM_LEVEL8_VALUE = X_DIM_LEVEL8_VALUE
  where TAB_ID = X_TAB_ID
  and INDICATOR = X_INDICATOR;

  if (sql%notfound) then
    raise no_data_found;
  end if;

  update BSC_KPI_DEFAULTS_TL set
    ANALYSIS_OPTION0_NAME = X_ANALYSIS_OPTION0_NAME,
    ANALYSIS_OPTION1_NAME = X_ANALYSIS_OPTION1_NAME,
    ANALYSIS_OPTION2_NAME = X_ANALYSIS_OPTION2_NAME,
    PERIOD_NAME = X_PERIOD_NAME,
    SERIES_NAME = X_SERIES_NAME,
    DIM_LEVEL1_NAME = X_DIM_LEVEL1_NAME,
    DIM_LEVEL2_NAME = X_DIM_LEVEL2_NAME,
    DIM_LEVEL3_NAME = X_DIM_LEVEL3_NAME,
    DIM_LEVEL4_NAME = X_DIM_LEVEL4_NAME,
    DIM_LEVEL5_NAME = X_DIM_LEVEL5_NAME,
    DIM_LEVEL6_NAME = X_DIM_LEVEL6_NAME,
    DIM_LEVEL7_NAME = X_DIM_LEVEL7_NAME,
    DIM_LEVEL8_NAME = X_DIM_LEVEL8_NAME,
    DIM_LEVEL1_TEXT = X_DIM_LEVEL1_TEXT,
    DIM_LEVEL2_TEXT = X_DIM_LEVEL2_TEXT,
    DIM_LEVEL3_TEXT = X_DIM_LEVEL3_TEXT,
    DIM_LEVEL4_TEXT = X_DIM_LEVEL4_TEXT,
    DIM_LEVEL5_TEXT = X_DIM_LEVEL5_TEXT,
    DIM_LEVEL6_TEXT = X_DIM_LEVEL6_TEXT,
    DIM_LEVEL7_TEXT = X_DIM_LEVEL7_TEXT,
    DIM_LEVEL8_TEXT = X_DIM_LEVEL8_TEXT,
    SOURCE_LANG = userenv('LANG')
  where TAB_ID = X_TAB_ID
  and INDICATOR = X_INDICATOR
  and userenv('LANG') in (LANGUAGE, SOURCE_LANG);

  if (sql%notfound) then
    raise no_data_found;
  end if;
end UPDATE_ROW;

procedure DELETE_ROW (
  X_TAB_ID in NUMBER,
  X_INDICATOR in NUMBER
) is
begin
  delete from BSC_KPI_DEFAULTS_TL
  where TAB_ID = X_TAB_ID
  and INDICATOR = X_INDICATOR;

  if (sql%notfound) then
    raise no_data_found;
  end if;

  delete from BSC_KPI_DEFAULTS_B
  where TAB_ID = X_TAB_ID
  and INDICATOR = X_INDICATOR;

  if (sql%notfound) then
    raise no_data_found;
  end if;
end DELETE_ROW;

procedure ADD_LANGUAGE
is
begin
  delete from BSC_KPI_DEFAULTS_TL T
  where not exists
    (select NULL
    from BSC_KPI_DEFAULTS_B B
    where B.TAB_ID = T.TAB_ID
    and B.INDICATOR = T.INDICATOR
    );

  update BSC_KPI_DEFAULTS_TL T set (
      ANALYSIS_OPTION0_NAME,
      ANALYSIS_OPTION1_NAME,
      ANALYSIS_OPTION2_NAME,
      PERIOD_NAME,
      SERIES_NAME,
      DIM_LEVEL1_NAME,
      DIM_LEVEL2_NAME,
      DIM_LEVEL3_NAME,
      DIM_LEVEL4_NAME,
      DIM_LEVEL5_NAME,
      DIM_LEVEL6_NAME,
      DIM_LEVEL7_NAME,
      DIM_LEVEL8_NAME,
      DIM_LEVEL1_TEXT,
      DIM_LEVEL2_TEXT,
      DIM_LEVEL3_TEXT,
      DIM_LEVEL4_TEXT,
      DIM_LEVEL5_TEXT,
      DIM_LEVEL6_TEXT,
      DIM_LEVEL7_TEXT,
      DIM_LEVEL8_TEXT
    ) = (select
      B.ANALYSIS_OPTION0_NAME,
      B.ANALYSIS_OPTION1_NAME,
      B.ANALYSIS_OPTION2_NAME,
      B.PERIOD_NAME,
      B.SERIES_NAME,
      B.DIM_LEVEL1_NAME,
      B.DIM_LEVEL2_NAME,
      B.DIM_LEVEL3_NAME,
      B.DIM_LEVEL4_NAME,
      B.DIM_LEVEL5_NAME,
      B.DIM_LEVEL6_NAME,
      B.DIM_LEVEL7_NAME,
      B.DIM_LEVEL8_NAME,
      B.DIM_LEVEL1_TEXT,
      B.DIM_LEVEL2_TEXT,
      B.DIM_LEVEL3_TEXT,
      B.DIM_LEVEL4_TEXT,
      B.DIM_LEVEL5_TEXT,
      B.DIM_LEVEL6_TEXT,
      B.DIM_LEVEL7_TEXT,
      B.DIM_LEVEL8_TEXT
    from BSC_KPI_DEFAULTS_TL B
    where B.TAB_ID = T.TAB_ID
    and B.INDICATOR = T.INDICATOR
    and B.LANGUAGE = T.SOURCE_LANG)
  where (
      T.TAB_ID,
      T.INDICATOR,
      T.LANGUAGE
  ) in (select
      SUBT.TAB_ID,
      SUBT.INDICATOR,
      SUBT.LANGUAGE
    from BSC_KPI_DEFAULTS_TL SUBB, BSC_KPI_DEFAULTS_TL SUBT
    where SUBB.TAB_ID = SUBT.TAB_ID
    and SUBB.INDICATOR = SUBT.INDICATOR
    and SUBB.LANGUAGE = SUBT.SOURCE_LANG
    and (SUBB.ANALYSIS_OPTION0_NAME <> SUBT.ANALYSIS_OPTION0_NAME
      or (SUBB.ANALYSIS_OPTION0_NAME is null and SUBT.ANALYSIS_OPTION0_NAME is not null)
      or (SUBB.ANALYSIS_OPTION0_NAME is not null and SUBT.ANALYSIS_OPTION0_NAME is null)
      or SUBB.ANALYSIS_OPTION1_NAME <> SUBT.ANALYSIS_OPTION1_NAME
      or (SUBB.ANALYSIS_OPTION1_NAME is null and SUBT.ANALYSIS_OPTION1_NAME is not null)
      or (SUBB.ANALYSIS_OPTION1_NAME is not null and SUBT.ANALYSIS_OPTION1_NAME is null)
      or SUBB.ANALYSIS_OPTION2_NAME <> SUBT.ANALYSIS_OPTION2_NAME
      or (SUBB.ANALYSIS_OPTION2_NAME is null and SUBT.ANALYSIS_OPTION2_NAME is not null)
      or (SUBB.ANALYSIS_OPTION2_NAME is not null and SUBT.ANALYSIS_OPTION2_NAME is null)
      or SUBB.PERIOD_NAME <> SUBT.PERIOD_NAME
      or (SUBB.PERIOD_NAME is null and SUBT.PERIOD_NAME is not null)
      or (SUBB.PERIOD_NAME is not null and SUBT.PERIOD_NAME is null)
      or SUBB.SERIES_NAME <> SUBT.SERIES_NAME
      or (SUBB.SERIES_NAME is null and SUBT.SERIES_NAME is not null)
      or (SUBB.SERIES_NAME is not null and SUBT.SERIES_NAME is null)
      or SUBB.DIM_LEVEL1_NAME <> SUBT.DIM_LEVEL1_NAME
      or (SUBB.DIM_LEVEL1_NAME is null and SUBT.DIM_LEVEL1_NAME is not null)
      or (SUBB.DIM_LEVEL1_NAME is not null and SUBT.DIM_LEVEL1_NAME is null)
      or SUBB.DIM_LEVEL2_NAME <> SUBT.DIM_LEVEL2_NAME
      or (SUBB.DIM_LEVEL2_NAME is null and SUBT.DIM_LEVEL2_NAME is not null)
      or (SUBB.DIM_LEVEL2_NAME is not null and SUBT.DIM_LEVEL2_NAME is null)
      or SUBB.DIM_LEVEL3_NAME <> SUBT.DIM_LEVEL3_NAME
      or (SUBB.DIM_LEVEL3_NAME is null and SUBT.DIM_LEVEL3_NAME is not null)
      or (SUBB.DIM_LEVEL3_NAME is not null and SUBT.DIM_LEVEL3_NAME is null)
      or SUBB.DIM_LEVEL4_NAME <> SUBT.DIM_LEVEL4_NAME
      or (SUBB.DIM_LEVEL4_NAME is null and SUBT.DIM_LEVEL4_NAME is not null)
      or (SUBB.DIM_LEVEL4_NAME is not null and SUBT.DIM_LEVEL4_NAME is null)
      or SUBB.DIM_LEVEL5_NAME <> SUBT.DIM_LEVEL5_NAME
      or (SUBB.DIM_LEVEL5_NAME is null and SUBT.DIM_LEVEL5_NAME is not null)
      or (SUBB.DIM_LEVEL5_NAME is not null and SUBT.DIM_LEVEL5_NAME is null)
      or SUBB.DIM_LEVEL6_NAME <> SUBT.DIM_LEVEL6_NAME
      or (SUBB.DIM_LEVEL6_NAME is null and SUBT.DIM_LEVEL6_NAME is not null)
      or (SUBB.DIM_LEVEL6_NAME is not null and SUBT.DIM_LEVEL6_NAME is null)
      or SUBB.DIM_LEVEL7_NAME <> SUBT.DIM_LEVEL7_NAME
      or (SUBB.DIM_LEVEL7_NAME is null and SUBT.DIM_LEVEL7_NAME is not null)
      or (SUBB.DIM_LEVEL7_NAME is not null and SUBT.DIM_LEVEL7_NAME is null)
      or SUBB.DIM_LEVEL8_NAME <> SUBT.DIM_LEVEL8_NAME
      or (SUBB.DIM_LEVEL8_NAME is null and SUBT.DIM_LEVEL8_NAME is not null)
      or (SUBB.DIM_LEVEL8_NAME is not null and SUBT.DIM_LEVEL8_NAME is null)
      or SUBB.DIM_LEVEL1_TEXT <> SUBT.DIM_LEVEL1_TEXT
      or (SUBB.DIM_LEVEL1_TEXT is null and SUBT.DIM_LEVEL1_TEXT is not null)
      or (SUBB.DIM_LEVEL1_TEXT is not null and SUBT.DIM_LEVEL1_TEXT is null)
      or SUBB.DIM_LEVEL2_TEXT <> SUBT.DIM_LEVEL2_TEXT
      or (SUBB.DIM_LEVEL2_TEXT is null and SUBT.DIM_LEVEL2_TEXT is not null)
      or (SUBB.DIM_LEVEL2_TEXT is not null and SUBT.DIM_LEVEL2_TEXT is null)
      or SUBB.DIM_LEVEL3_TEXT <> SUBT.DIM_LEVEL3_TEXT
      or (SUBB.DIM_LEVEL3_TEXT is null and SUBT.DIM_LEVEL3_TEXT is not null)
      or (SUBB.DIM_LEVEL3_TEXT is not null and SUBT.DIM_LEVEL3_TEXT is null)
      or SUBB.DIM_LEVEL4_TEXT <> SUBT.DIM_LEVEL4_TEXT
      or (SUBB.DIM_LEVEL4_TEXT is null and SUBT.DIM_LEVEL4_TEXT is not null)
      or (SUBB.DIM_LEVEL4_TEXT is not null and SUBT.DIM_LEVEL4_TEXT is null)
      or SUBB.DIM_LEVEL5_TEXT <> SUBT.DIM_LEVEL5_TEXT
      or (SUBB.DIM_LEVEL5_TEXT is null and SUBT.DIM_LEVEL5_TEXT is not null)
      or (SUBB.DIM_LEVEL5_TEXT is not null and SUBT.DIM_LEVEL5_TEXT is null)
      or SUBB.DIM_LEVEL6_TEXT <> SUBT.DIM_LEVEL6_TEXT
      or (SUBB.DIM_LEVEL6_TEXT is null and SUBT.DIM_LEVEL6_TEXT is not null)
      or (SUBB.DIM_LEVEL6_TEXT is not null and SUBT.DIM_LEVEL6_TEXT is null)
      or SUBB.DIM_LEVEL7_TEXT <> SUBT.DIM_LEVEL7_TEXT
      or (SUBB.DIM_LEVEL7_TEXT is null and SUBT.DIM_LEVEL7_TEXT is not null)
      or (SUBB.DIM_LEVEL7_TEXT is not null and SUBT.DIM_LEVEL7_TEXT is null)
      or SUBB.DIM_LEVEL8_TEXT <> SUBT.DIM_LEVEL8_TEXT
      or (SUBB.DIM_LEVEL8_TEXT is null and SUBT.DIM_LEVEL8_TEXT is not null)
      or (SUBB.DIM_LEVEL8_TEXT is not null and SUBT.DIM_LEVEL8_TEXT is null)
  ));

  insert into BSC_KPI_DEFAULTS_TL (
    TAB_ID,
    INDICATOR,
    ANALYSIS_OPTION0_NAME,
    ANALYSIS_OPTION1_NAME,
    ANALYSIS_OPTION2_NAME,
    PERIOD_NAME,
    SERIES_NAME,
    DIM_LEVEL1_NAME,
    DIM_LEVEL2_NAME,
    DIM_LEVEL3_NAME,
    DIM_LEVEL4_NAME,
    DIM_LEVEL5_NAME,
    DIM_LEVEL6_NAME,
    DIM_LEVEL7_NAME,
    DIM_LEVEL8_NAME,
    DIM_LEVEL1_TEXT,
    DIM_LEVEL2_TEXT,
    DIM_LEVEL3_TEXT,
    DIM_LEVEL4_TEXT,
    DIM_LEVEL5_TEXT,
    DIM_LEVEL6_TEXT,
    DIM_LEVEL7_TEXT,
    DIM_LEVEL8_TEXT,
    LANGUAGE,
    SOURCE_LANG
  ) select
    B.TAB_ID,
    B.INDICATOR,
    B.ANALYSIS_OPTION0_NAME,
    B.ANALYSIS_OPTION1_NAME,
    B.ANALYSIS_OPTION2_NAME,
    B.PERIOD_NAME,
    B.SERIES_NAME,
    B.DIM_LEVEL1_NAME,
    B.DIM_LEVEL2_NAME,
    B.DIM_LEVEL3_NAME,
    B.DIM_LEVEL4_NAME,
    B.DIM_LEVEL5_NAME,
    B.DIM_LEVEL6_NAME,
    B.DIM_LEVEL7_NAME,
    B.DIM_LEVEL8_NAME,
    B.DIM_LEVEL1_TEXT,
    B.DIM_LEVEL2_TEXT,
    B.DIM_LEVEL3_TEXT,
    B.DIM_LEVEL4_TEXT,
    B.DIM_LEVEL5_TEXT,
    B.DIM_LEVEL6_TEXT,
    B.DIM_LEVEL7_TEXT,
    B.DIM_LEVEL8_TEXT,
    L.LANGUAGE_CODE,
    B.SOURCE_LANG
  from BSC_KPI_DEFAULTS_TL B, FND_LANGUAGES L
  where L.INSTALLED_FLAG in ('I', 'B')
  and B.LANGUAGE = userenv('LANG')
  and not exists
    (select NULL
    from BSC_KPI_DEFAULTS_TL T
    where T.TAB_ID = B.TAB_ID
    and T.INDICATOR = B.INDICATOR
    and T.LANGUAGE = L.LANGUAGE_CODE);
end ADD_LANGUAGE;

end BSC_KPI_DEFAULTS_PKG;

/
