--------------------------------------------------------
--  DDL for Package Body PO_ATTR_VALUES_DRAFT_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PO_ATTR_VALUES_DRAFT_PKG" AS
/* $Header: PO_ATTR_VALUES_DRAFT_PKG.plb 120.9 2006/09/28 22:58:19 bao noship $ */

d_pkg_name CONSTANT varchar2(50) :=
  PO_LOG.get_package_base('PO_ATTR_VALUES_DRAFT_PKG');

-----------------------------------------------------------------------
--Start of Comments
--Name: delete_rows
--Pre-reqs: None
--Modifies:
--Locks:
--  None
--Function:
--  Deletes drafts for attribute values based on the information given
--  If only draft_id is provided, then all attribute values for the draft
--  will be deleted
--  If attribute_values_id is also provided, then the one record that has such
--  primary key will be deleted
--Parameters:
--IN:
--p_draft_id
--  draft unique identifier
--p_attribute_values_id
--  po attribute values unique identifier
--IN OUT:
--OUT:
--Returns:
--Notes:
--Testing:
--End of Comments
------------------------------------------------------------------------
PROCEDURE delete_rows
( p_draft_id IN NUMBER,
  p_attribute_values_id IN NUMBER
) IS

d_api_name CONSTANT VARCHAR2(30) := 'delete_rows';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

BEGIN
  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
  END IF;

  DELETE FROM po_attribute_values_draft
  WHERE draft_id = p_draft_id
  AND attribute_values_id = NVL(p_attribute_values_id, attribute_values_id);

  d_position := 10;
EXCEPTION
  WHEN OTHERS THEN
    PO_MESSAGE_S.add_exc_msg
    ( p_pkg_name => d_pkg_name,
      p_procedure_name => d_api_name || '.' || d_position
    );
    RAISE FND_API.G_EXC_UNEXPECTED_ERROR;
END delete_rows;

-----------------------------------------------------------------------
--Start of Comments
--Name: sync_draft_from_txn
--Pre-reqs: None
--Modifies:
--Locks:
--  None
--Function:
--  Copy data from transaction table to draft table, if the corresponding
--  record in draft table does not exist. It also sets the delete flag of
--  the draft record according to the parameter.
--Parameters:
--IN:
--p_attribute_values_id_tbl
--  table of po attribute_values unique identifier
--p_draft_id_tbl
--  table of draft ids this sync up will be done for
--p_delete_flag_tbl
--  table fo flags to indicate whether the draft record should be maked as
--  "to be deleted"
--IN OUT:
--OUT:
--x_record_already_exist_tbl
--  Returns whether the record was already in draft table or not
--Returns:
--Notes:
--Testing:
--End of Comments
------------------------------------------------------------------------
PROCEDURE sync_draft_from_txn
( p_attribute_values_id_tbl  IN PO_TBL_NUMBER,
  p_draft_id_tbl             IN PO_TBL_NUMBER,
  p_delete_flag_tbl          IN PO_TBL_VARCHAR1,
  x_record_already_exist_tbl OUT NOCOPY PO_TBL_VARCHAR1
) IS

d_api_name CONSTANT VARCHAR2(30) := 'sync_draft_from_txn';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

l_distinct_id_list DBMS_SQL.NUMBER_TABLE;
l_duplicate_flag_tbl PO_TBL_VARCHAR1 := PO_TBL_VARCHAR1();

BEGIN
  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
  END IF;

  x_record_already_exist_tbl :=
    PO_ATTR_VALUES_DRAFT_PVT.draft_changes_exist
    ( p_draft_id_tbl => p_draft_id_tbl,
      p_attribute_values_id_tbl => p_attribute_values_id_tbl
    );

  -- bug5471513 START
  -- If there're duplicate entries in the id table,
  -- we do not want to insert multiple entries
  -- Created an associative array to store what id has appeared.
  l_duplicate_flag_tbl.EXTEND(p_attribute_values_id_tbl.COUNT);

  FOR i IN 1..p_attribute_values_id_tbl.COUNT LOOP
    IF (x_record_already_exist_tbl(i) = FND_API.G_FALSE) THEN

      IF (l_distinct_id_list.EXISTS(p_attribute_values_id_tbl(i))) THEN

        l_duplicate_flag_tbl(i) := FND_API.G_TRUE;
      ELSE
        l_duplicate_flag_tbl(i) := FND_API.G_FALSE;

        l_distinct_id_list(p_attribute_values_id_tbl(i)) := 1;
      END IF;

    ELSE

      l_duplicate_flag_tbl(i) := NULL;

    END IF;
  END LOOP;
  -- bug5471513 END

  d_position := 10;
  IF (PO_LOG.d_stmt) THEN
    PO_LOG.stmt(d_module, d_position, 'transfer records from txn to dft');
  END IF;

  FORALL i IN 1..p_attribute_values_id_tbl.COUNT
    INSERT INTO po_attribute_values_draft
    ( draft_id,
      delete_flag,
      change_accepted_flag,
      attribute_values_id,
      po_line_id,
      req_template_name,
      req_template_line_num,
      ip_category_id,
      inventory_item_id,
      org_id,
      manufacturer_part_num,
      picture,
      thumbnail_image,
      supplier_url,
      manufacturer_url,
      attachment_url,
      unspsc,
      availability,
      lead_time,
      text_base_attribute1,
      text_base_attribute2,
      text_base_attribute3,
      text_base_attribute4,
      text_base_attribute5,
      text_base_attribute6,
      text_base_attribute7,
      text_base_attribute8,
      text_base_attribute9,
      text_base_attribute10,
      text_base_attribute11,
      text_base_attribute12,
      text_base_attribute13,
      text_base_attribute14,
      text_base_attribute15,
      text_base_attribute16,
      text_base_attribute17,
      text_base_attribute18,
      text_base_attribute19,
      text_base_attribute20,
      text_base_attribute21,
      text_base_attribute22,
      text_base_attribute23,
      text_base_attribute24,
      text_base_attribute25,
      text_base_attribute26,
      text_base_attribute27,
      text_base_attribute28,
      text_base_attribute29,
      text_base_attribute30,
      text_base_attribute31,
      text_base_attribute32,
      text_base_attribute33,
      text_base_attribute34,
      text_base_attribute35,
      text_base_attribute36,
      text_base_attribute37,
      text_base_attribute38,
      text_base_attribute39,
      text_base_attribute40,
      text_base_attribute41,
      text_base_attribute42,
      text_base_attribute43,
      text_base_attribute44,
      text_base_attribute45,
      text_base_attribute46,
      text_base_attribute47,
      text_base_attribute48,
      text_base_attribute49,
      text_base_attribute50,
      text_base_attribute51,
      text_base_attribute52,
      text_base_attribute53,
      text_base_attribute54,
      text_base_attribute55,
      text_base_attribute56,
      text_base_attribute57,
      text_base_attribute58,
      text_base_attribute59,
      text_base_attribute60,
      text_base_attribute61,
      text_base_attribute62,
      text_base_attribute63,
      text_base_attribute64,
      text_base_attribute65,
      text_base_attribute66,
      text_base_attribute67,
      text_base_attribute68,
      text_base_attribute69,
      text_base_attribute70,
      text_base_attribute71,
      text_base_attribute72,
      text_base_attribute73,
      text_base_attribute74,
      text_base_attribute75,
      text_base_attribute76,
      text_base_attribute77,
      text_base_attribute78,
      text_base_attribute79,
      text_base_attribute80,
      text_base_attribute81,
      text_base_attribute82,
      text_base_attribute83,
      text_base_attribute84,
      text_base_attribute85,
      text_base_attribute86,
      text_base_attribute87,
      text_base_attribute88,
      text_base_attribute89,
      text_base_attribute90,
      text_base_attribute91,
      text_base_attribute92,
      text_base_attribute93,
      text_base_attribute94,
      text_base_attribute95,
      text_base_attribute96,
      text_base_attribute97,
      text_base_attribute98,
      text_base_attribute99,
      text_base_attribute100,
      num_base_attribute1,
      num_base_attribute2,
      num_base_attribute3,
      num_base_attribute4,
      num_base_attribute5,
      num_base_attribute6,
      num_base_attribute7,
      num_base_attribute8,
      num_base_attribute9,
      num_base_attribute10,
      num_base_attribute11,
      num_base_attribute12,
      num_base_attribute13,
      num_base_attribute14,
      num_base_attribute15,
      num_base_attribute16,
      num_base_attribute17,
      num_base_attribute18,
      num_base_attribute19,
      num_base_attribute20,
      num_base_attribute21,
      num_base_attribute22,
      num_base_attribute23,
      num_base_attribute24,
      num_base_attribute25,
      num_base_attribute26,
      num_base_attribute27,
      num_base_attribute28,
      num_base_attribute29,
      num_base_attribute30,
      num_base_attribute31,
      num_base_attribute32,
      num_base_attribute33,
      num_base_attribute34,
      num_base_attribute35,
      num_base_attribute36,
      num_base_attribute37,
      num_base_attribute38,
      num_base_attribute39,
      num_base_attribute40,
      num_base_attribute41,
      num_base_attribute42,
      num_base_attribute43,
      num_base_attribute44,
      num_base_attribute45,
      num_base_attribute46,
      num_base_attribute47,
      num_base_attribute48,
      num_base_attribute49,
      num_base_attribute50,
      num_base_attribute51,
      num_base_attribute52,
      num_base_attribute53,
      num_base_attribute54,
      num_base_attribute55,
      num_base_attribute56,
      num_base_attribute57,
      num_base_attribute58,
      num_base_attribute59,
      num_base_attribute60,
      num_base_attribute61,
      num_base_attribute62,
      num_base_attribute63,
      num_base_attribute64,
      num_base_attribute65,
      num_base_attribute66,
      num_base_attribute67,
      num_base_attribute68,
      num_base_attribute69,
      num_base_attribute70,
      num_base_attribute71,
      num_base_attribute72,
      num_base_attribute73,
      num_base_attribute74,
      num_base_attribute75,
      num_base_attribute76,
      num_base_attribute77,
      num_base_attribute78,
      num_base_attribute79,
      num_base_attribute80,
      num_base_attribute81,
      num_base_attribute82,
      num_base_attribute83,
      num_base_attribute84,
      num_base_attribute85,
      num_base_attribute86,
      num_base_attribute87,
      num_base_attribute88,
      num_base_attribute89,
      num_base_attribute90,
      num_base_attribute91,
      num_base_attribute92,
      num_base_attribute93,
      num_base_attribute94,
      num_base_attribute95,
      num_base_attribute96,
      num_base_attribute97,
      num_base_attribute98,
      num_base_attribute99,
      num_base_attribute100,
      text_cat_attribute1,
      text_cat_attribute2,
      text_cat_attribute3,
      text_cat_attribute4,
      text_cat_attribute5,
      text_cat_attribute6,
      text_cat_attribute7,
      text_cat_attribute8,
      text_cat_attribute9,
      text_cat_attribute10,
      text_cat_attribute11,
      text_cat_attribute12,
      text_cat_attribute13,
      text_cat_attribute14,
      text_cat_attribute15,
      text_cat_attribute16,
      text_cat_attribute17,
      text_cat_attribute18,
      text_cat_attribute19,
      text_cat_attribute20,
      text_cat_attribute21,
      text_cat_attribute22,
      text_cat_attribute23,
      text_cat_attribute24,
      text_cat_attribute25,
      text_cat_attribute26,
      text_cat_attribute27,
      text_cat_attribute28,
      text_cat_attribute29,
      text_cat_attribute30,
      text_cat_attribute31,
      text_cat_attribute32,
      text_cat_attribute33,
      text_cat_attribute34,
      text_cat_attribute35,
      text_cat_attribute36,
      text_cat_attribute37,
      text_cat_attribute38,
      text_cat_attribute39,
      text_cat_attribute40,
      text_cat_attribute41,
      text_cat_attribute42,
      text_cat_attribute43,
      text_cat_attribute44,
      text_cat_attribute45,
      text_cat_attribute46,
      text_cat_attribute47,
      text_cat_attribute48,
      text_cat_attribute49,
      text_cat_attribute50,
      num_cat_attribute1,
      num_cat_attribute2,
      num_cat_attribute3,
      num_cat_attribute4,
      num_cat_attribute5,
      num_cat_attribute6,
      num_cat_attribute7,
      num_cat_attribute8,
      num_cat_attribute9,
      num_cat_attribute10,
      num_cat_attribute11,
      num_cat_attribute12,
      num_cat_attribute13,
      num_cat_attribute14,
      num_cat_attribute15,
      num_cat_attribute16,
      num_cat_attribute17,
      num_cat_attribute18,
      num_cat_attribute19,
      num_cat_attribute20,
      num_cat_attribute21,
      num_cat_attribute22,
      num_cat_attribute23,
      num_cat_attribute24,
      num_cat_attribute25,
      num_cat_attribute26,
      num_cat_attribute27,
      num_cat_attribute28,
      num_cat_attribute29,
      num_cat_attribute30,
      num_cat_attribute31,
      num_cat_attribute32,
      num_cat_attribute33,
      num_cat_attribute34,
      num_cat_attribute35,
      num_cat_attribute36,
      num_cat_attribute37,
      num_cat_attribute38,
      num_cat_attribute39,
      num_cat_attribute40,
      num_cat_attribute41,
      num_cat_attribute42,
      num_cat_attribute43,
      num_cat_attribute44,
      num_cat_attribute45,
      num_cat_attribute46,
      num_cat_attribute47,
      num_cat_attribute48,
      num_cat_attribute49,
      num_cat_attribute50,
      last_update_login,
      last_updated_by,
      last_update_date,
      created_by,
      creation_date,
      request_id,
      program_application_id,
      program_id,
      program_update_date
    )
    SELECT
      p_draft_id_tbl(i),
      p_delete_flag_tbl(i),
      NULL,
      attribute_values_id,
      po_line_id,
      req_template_name,
      req_template_line_num,
      ip_category_id,
      inventory_item_id,
      org_id,
      manufacturer_part_num,
      picture,
      thumbnail_image,
      supplier_url,
      manufacturer_url,
      attachment_url,
      unspsc,
      availability,
      lead_time,
      text_base_attribute1,
      text_base_attribute2,
      text_base_attribute3,
      text_base_attribute4,
      text_base_attribute5,
      text_base_attribute6,
      text_base_attribute7,
      text_base_attribute8,
      text_base_attribute9,
      text_base_attribute10,
      text_base_attribute11,
      text_base_attribute12,
      text_base_attribute13,
      text_base_attribute14,
      text_base_attribute15,
      text_base_attribute16,
      text_base_attribute17,
      text_base_attribute18,
      text_base_attribute19,
      text_base_attribute20,
      text_base_attribute21,
      text_base_attribute22,
      text_base_attribute23,
      text_base_attribute24,
      text_base_attribute25,
      text_base_attribute26,
      text_base_attribute27,
      text_base_attribute28,
      text_base_attribute29,
      text_base_attribute30,
      text_base_attribute31,
      text_base_attribute32,
      text_base_attribute33,
      text_base_attribute34,
      text_base_attribute35,
      text_base_attribute36,
      text_base_attribute37,
      text_base_attribute38,
      text_base_attribute39,
      text_base_attribute40,
      text_base_attribute41,
      text_base_attribute42,
      text_base_attribute43,
      text_base_attribute44,
      text_base_attribute45,
      text_base_attribute46,
      text_base_attribute47,
      text_base_attribute48,
      text_base_attribute49,
      text_base_attribute50,
      text_base_attribute51,
      text_base_attribute52,
      text_base_attribute53,
      text_base_attribute54,
      text_base_attribute55,
      text_base_attribute56,
      text_base_attribute57,
      text_base_attribute58,
      text_base_attribute59,
      text_base_attribute60,
      text_base_attribute61,
      text_base_attribute62,
      text_base_attribute63,
      text_base_attribute64,
      text_base_attribute65,
      text_base_attribute66,
      text_base_attribute67,
      text_base_attribute68,
      text_base_attribute69,
      text_base_attribute70,
      text_base_attribute71,
      text_base_attribute72,
      text_base_attribute73,
      text_base_attribute74,
      text_base_attribute75,
      text_base_attribute76,
      text_base_attribute77,
      text_base_attribute78,
      text_base_attribute79,
      text_base_attribute80,
      text_base_attribute81,
      text_base_attribute82,
      text_base_attribute83,
      text_base_attribute84,
      text_base_attribute85,
      text_base_attribute86,
      text_base_attribute87,
      text_base_attribute88,
      text_base_attribute89,
      text_base_attribute90,
      text_base_attribute91,
      text_base_attribute92,
      text_base_attribute93,
      text_base_attribute94,
      text_base_attribute95,
      text_base_attribute96,
      text_base_attribute97,
      text_base_attribute98,
      text_base_attribute99,
      text_base_attribute100,
      num_base_attribute1,
      num_base_attribute2,
      num_base_attribute3,
      num_base_attribute4,
      num_base_attribute5,
      num_base_attribute6,
      num_base_attribute7,
      num_base_attribute8,
      num_base_attribute9,
      num_base_attribute10,
      num_base_attribute11,
      num_base_attribute12,
      num_base_attribute13,
      num_base_attribute14,
      num_base_attribute15,
      num_base_attribute16,
      num_base_attribute17,
      num_base_attribute18,
      num_base_attribute19,
      num_base_attribute20,
      num_base_attribute21,
      num_base_attribute22,
      num_base_attribute23,
      num_base_attribute24,
      num_base_attribute25,
      num_base_attribute26,
      num_base_attribute27,
      num_base_attribute28,
      num_base_attribute29,
      num_base_attribute30,
      num_base_attribute31,
      num_base_attribute32,
      num_base_attribute33,
      num_base_attribute34,
      num_base_attribute35,
      num_base_attribute36,
      num_base_attribute37,
      num_base_attribute38,
      num_base_attribute39,
      num_base_attribute40,
      num_base_attribute41,
      num_base_attribute42,
      num_base_attribute43,
      num_base_attribute44,
      num_base_attribute45,
      num_base_attribute46,
      num_base_attribute47,
      num_base_attribute48,
      num_base_attribute49,
      num_base_attribute50,
      num_base_attribute51,
      num_base_attribute52,
      num_base_attribute53,
      num_base_attribute54,
      num_base_attribute55,
      num_base_attribute56,
      num_base_attribute57,
      num_base_attribute58,
      num_base_attribute59,
      num_base_attribute60,
      num_base_attribute61,
      num_base_attribute62,
      num_base_attribute63,
      num_base_attribute64,
      num_base_attribute65,
      num_base_attribute66,
      num_base_attribute67,
      num_base_attribute68,
      num_base_attribute69,
      num_base_attribute70,
      num_base_attribute71,
      num_base_attribute72,
      num_base_attribute73,
      num_base_attribute74,
      num_base_attribute75,
      num_base_attribute76,
      num_base_attribute77,
      num_base_attribute78,
      num_base_attribute79,
      num_base_attribute80,
      num_base_attribute81,
      num_base_attribute82,
      num_base_attribute83,
      num_base_attribute84,
      num_base_attribute85,
      num_base_attribute86,
      num_base_attribute87,
      num_base_attribute88,
      num_base_attribute89,
      num_base_attribute90,
      num_base_attribute91,
      num_base_attribute92,
      num_base_attribute93,
      num_base_attribute94,
      num_base_attribute95,
      num_base_attribute96,
      num_base_attribute97,
      num_base_attribute98,
      num_base_attribute99,
      num_base_attribute100,
      text_cat_attribute1,
      text_cat_attribute2,
      text_cat_attribute3,
      text_cat_attribute4,
      text_cat_attribute5,
      text_cat_attribute6,
      text_cat_attribute7,
      text_cat_attribute8,
      text_cat_attribute9,
      text_cat_attribute10,
      text_cat_attribute11,
      text_cat_attribute12,
      text_cat_attribute13,
      text_cat_attribute14,
      text_cat_attribute15,
      text_cat_attribute16,
      text_cat_attribute17,
      text_cat_attribute18,
      text_cat_attribute19,
      text_cat_attribute20,
      text_cat_attribute21,
      text_cat_attribute22,
      text_cat_attribute23,
      text_cat_attribute24,
      text_cat_attribute25,
      text_cat_attribute26,
      text_cat_attribute27,
      text_cat_attribute28,
      text_cat_attribute29,
      text_cat_attribute30,
      text_cat_attribute31,
      text_cat_attribute32,
      text_cat_attribute33,
      text_cat_attribute34,
      text_cat_attribute35,
      text_cat_attribute36,
      text_cat_attribute37,
      text_cat_attribute38,
      text_cat_attribute39,
      text_cat_attribute40,
      text_cat_attribute41,
      text_cat_attribute42,
      text_cat_attribute43,
      text_cat_attribute44,
      text_cat_attribute45,
      text_cat_attribute46,
      text_cat_attribute47,
      text_cat_attribute48,
      text_cat_attribute49,
      text_cat_attribute50,
      num_cat_attribute1,
      num_cat_attribute2,
      num_cat_attribute3,
      num_cat_attribute4,
      num_cat_attribute5,
      num_cat_attribute6,
      num_cat_attribute7,
      num_cat_attribute8,
      num_cat_attribute9,
      num_cat_attribute10,
      num_cat_attribute11,
      num_cat_attribute12,
      num_cat_attribute13,
      num_cat_attribute14,
      num_cat_attribute15,
      num_cat_attribute16,
      num_cat_attribute17,
      num_cat_attribute18,
      num_cat_attribute19,
      num_cat_attribute20,
      num_cat_attribute21,
      num_cat_attribute22,
      num_cat_attribute23,
      num_cat_attribute24,
      num_cat_attribute25,
      num_cat_attribute26,
      num_cat_attribute27,
      num_cat_attribute28,
      num_cat_attribute29,
      num_cat_attribute30,
      num_cat_attribute31,
      num_cat_attribute32,
      num_cat_attribute33,
      num_cat_attribute34,
      num_cat_attribute35,
      num_cat_attribute36,
      num_cat_attribute37,
      num_cat_attribute38,
      num_cat_attribute39,
      num_cat_attribute40,
      num_cat_attribute41,
      num_cat_attribute42,
      num_cat_attribute43,
      num_cat_attribute44,
      num_cat_attribute45,
      num_cat_attribute46,
      num_cat_attribute47,
      num_cat_attribute48,
      num_cat_attribute49,
      num_cat_attribute50,
      last_update_login,
      last_updated_by,
      last_update_date,
      created_by,
      creation_date,
      request_id,
      program_application_id,
      program_id,
      program_update_date
    FROM po_attribute_values
    WHERE attribute_values_id = p_attribute_values_id_tbl(i)
    AND x_record_already_exist_tbl(i) = FND_API.G_FALSE
    AND l_duplicate_flag_tbl(i) = FND_API.G_FALSE;

  d_position := 20;
  IF (PO_LOG.d_stmt) THEN
    PO_LOG.stmt(d_module, d_position, 'transfer count = ' || SQL%ROWCOUNT);
  END IF;

  FORALL i IN 1..p_attribute_values_id_tbl.COUNT
    UPDATE po_attribute_values_draft
    SET    delete_flag = p_delete_flag_tbl(i)
    WHERE  attribute_values_id = p_attribute_values_id_tbl(i)
    AND    draft_id = p_draft_id_tbl(i)
    AND    NVL(delete_flag, 'N') <> 'Y'  -- bug5570989
    AND    x_record_already_exist_tbl(i) = FND_API.G_TRUE;

  d_position := 30;

  IF (PO_LOG.d_stmt) THEN
    PO_LOG.stmt(d_module, d_position, 'update draft records that are already' ||
                ' in draft table. Count = ' || SQL%ROWCOUNT);
  END IF;

  d_position := 40;

  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_end(d_module);
  END IF;

EXCEPTION
  WHEN OTHERS THEN
    PO_MESSAGE_S.add_exc_msg
    ( p_pkg_name => d_pkg_name,
      p_procedure_name => d_api_name || '.' || d_position
    );
    RAISE FND_API.G_EXC_UNEXPECTED_ERROR;
END sync_draft_from_txn;

-----------------------------------------------------------------------
--Start of Comments
--Name: sync_draft_from_txn
--Pre-reqs: None
--Modifies:
--Locks:
--  None
--Function:
--  Same functionality as the bulk version of this procedure
--Parameters:
--IN:
--p_attribute_values_id
--  attribute values unique identifier
--p_draft_id
--  the draft this sync up will be done for
--p_delete_flag
--  flag to indicate whether the draft record should be maked as "to be
--  deleted"
--IN OUT:
--OUT:
--x_record_already_exist
--  Returns whether the record was already in draft table or not
--Returns:
--Notes:
--Testing:
--End of Comments
------------------------------------------------------------------------
PROCEDURE sync_draft_from_txn
( p_attribute_values_id IN NUMBER,
  p_draft_id IN NUMBER,
  p_delete_flag IN VARCHAR2,
  x_record_already_exist OUT NOCOPY VARCHAR2
) IS

d_api_name CONSTANT VARCHAR2(30) := 'sync_draft_from_txn';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

l_record_already_exist_tbl PO_TBL_VARCHAR1;

BEGIN
  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
    PO_LOG.proc_begin(d_module, 'p_attribute_values_id', p_attribute_values_id);
  END IF;

  sync_draft_from_txn
  ( p_attribute_values_id_tbl  => PO_TBL_NUMBER(p_attribute_values_id),
    p_draft_id_tbl             => PO_TBL_NUMBER(p_draft_id),
    p_delete_flag_tbl          => PO_TBL_VARCHAR1(p_delete_flag),
    x_record_already_exist_tbl => l_record_already_exist_tbl
  );

  x_record_already_exist := l_record_already_exist_tbl(1);

  d_position := 10;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_end(d_module);
    PO_LOG.proc_end(d_module, 'x_record_already_exist', x_record_already_exist);
  END IF;

EXCEPTION
  WHEN OTHERS THEN
    PO_MESSAGE_S.add_exc_msg
    ( p_pkg_name => d_pkg_name,
      p_procedure_name => d_api_name || '.' || d_position
    );
    RAISE FND_API.G_EXC_UNEXPECTED_ERROR;
END sync_draft_from_txn;

-----------------------------------------------------------------------
--Start of Comments
--Name: merge_changes
--Pre-reqs: None
--Modifies:
--Locks:
--  None
--Function:
--  Merge the records in draft table to transaction table
--  Either insert, update or delete will be performed on top of transaction
--  table, depending on the delete_flag on the draft record and whether the
--  record already exists in transaction table
--
--Parameters:
--IN:
--p_draft_id
--  draft unique identifier
--IN OUT:
--OUT:
--Returns:
--Notes:
--Testing:
--End of Comments
------------------------------------------------------------------------
PROCEDURE merge_changes
( p_draft_id IN NUMBER
) IS

d_api_name CONSTANT VARCHAR2(30) := 'merge_changes';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

BEGIN

  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
  END IF;

  -- Since putting DELETE within MERGE statement is causing database
  -- to thrown internal error, for now we just separate the DELETE statement.
  -- Once this is fixed we'll move the delete statement back to the merge
  -- statement

  -- bug5187544
  -- Delete only records that have not been rejected

  DELETE FROM po_attribute_values PAV
  WHERE PAV.attribute_values_id IN
         ( SELECT PAVD.attribute_values_id
           FROM   po_attribute_values_draft PAVD
           WHERE  PAVD.draft_id = p_draft_id
           AND    PAVD.delete_flag = 'Y'
           AND    NVL(PAVD.change_accepted_flag, 'Y') = 'Y');

  -- During Update case, the following attributes will be skipped:
  --  PAV.attribute_values_id = PAVDV.attribute_values_id,
  --  PAV.created_by = PAVDV.created_by,
  --  PAV.creation_date = PAVDV.creation_date,
  MERGE INTO po_attribute_values PAV
  USING (
    SELECT
      PAVD.draft_id,
      PAVD.change_accepted_flag,
      PAVD.delete_flag,
      PAVD.attribute_values_id,
      PAVD.po_line_id,
      PAVD.req_template_name,
      PAVD.req_template_line_num,
      PAVD.ip_category_id,
      PAVD.inventory_item_id,
      PAVD.org_id,
      PAVD.manufacturer_part_num,
      PAVD.picture,
      PAVD.thumbnail_image,
      PAVD.supplier_url,
      PAVD.manufacturer_url,
      PAVD.attachment_url,
      PAVD.unspsc,
      PAVD.availability,
      PAVD.lead_time,
      PAVD.text_base_attribute1,
      PAVD.text_base_attribute2,
      PAVD.text_base_attribute3,
      PAVD.text_base_attribute4,
      PAVD.text_base_attribute5,
      PAVD.text_base_attribute6,
      PAVD.text_base_attribute7,
      PAVD.text_base_attribute8,
      PAVD.text_base_attribute9,
      PAVD.text_base_attribute10,
      PAVD.text_base_attribute11,
      PAVD.text_base_attribute12,
      PAVD.text_base_attribute13,
      PAVD.text_base_attribute14,
      PAVD.text_base_attribute15,
      PAVD.text_base_attribute16,
      PAVD.text_base_attribute17,
      PAVD.text_base_attribute18,
      PAVD.text_base_attribute19,
      PAVD.text_base_attribute20,
      PAVD.text_base_attribute21,
      PAVD.text_base_attribute22,
      PAVD.text_base_attribute23,
      PAVD.text_base_attribute24,
      PAVD.text_base_attribute25,
      PAVD.text_base_attribute26,
      PAVD.text_base_attribute27,
      PAVD.text_base_attribute28,
      PAVD.text_base_attribute29,
      PAVD.text_base_attribute30,
      PAVD.text_base_attribute31,
      PAVD.text_base_attribute32,
      PAVD.text_base_attribute33,
      PAVD.text_base_attribute34,
      PAVD.text_base_attribute35,
      PAVD.text_base_attribute36,
      PAVD.text_base_attribute37,
      PAVD.text_base_attribute38,
      PAVD.text_base_attribute39,
      PAVD.text_base_attribute40,
      PAVD.text_base_attribute41,
      PAVD.text_base_attribute42,
      PAVD.text_base_attribute43,
      PAVD.text_base_attribute44,
      PAVD.text_base_attribute45,
      PAVD.text_base_attribute46,
      PAVD.text_base_attribute47,
      PAVD.text_base_attribute48,
      PAVD.text_base_attribute49,
      PAVD.text_base_attribute50,
      PAVD.text_base_attribute51,
      PAVD.text_base_attribute52,
      PAVD.text_base_attribute53,
      PAVD.text_base_attribute54,
      PAVD.text_base_attribute55,
      PAVD.text_base_attribute56,
      PAVD.text_base_attribute57,
      PAVD.text_base_attribute58,
      PAVD.text_base_attribute59,
      PAVD.text_base_attribute60,
      PAVD.text_base_attribute61,
      PAVD.text_base_attribute62,
      PAVD.text_base_attribute63,
      PAVD.text_base_attribute64,
      PAVD.text_base_attribute65,
      PAVD.text_base_attribute66,
      PAVD.text_base_attribute67,
      PAVD.text_base_attribute68,
      PAVD.text_base_attribute69,
      PAVD.text_base_attribute70,
      PAVD.text_base_attribute71,
      PAVD.text_base_attribute72,
      PAVD.text_base_attribute73,
      PAVD.text_base_attribute74,
      PAVD.text_base_attribute75,
      PAVD.text_base_attribute76,
      PAVD.text_base_attribute77,
      PAVD.text_base_attribute78,
      PAVD.text_base_attribute79,
      PAVD.text_base_attribute80,
      PAVD.text_base_attribute81,
      PAVD.text_base_attribute82,
      PAVD.text_base_attribute83,
      PAVD.text_base_attribute84,
      PAVD.text_base_attribute85,
      PAVD.text_base_attribute86,
      PAVD.text_base_attribute87,
      PAVD.text_base_attribute88,
      PAVD.text_base_attribute89,
      PAVD.text_base_attribute90,
      PAVD.text_base_attribute91,
      PAVD.text_base_attribute92,
      PAVD.text_base_attribute93,
      PAVD.text_base_attribute94,
      PAVD.text_base_attribute95,
      PAVD.text_base_attribute96,
      PAVD.text_base_attribute97,
      PAVD.text_base_attribute98,
      PAVD.text_base_attribute99,
      PAVD.text_base_attribute100,
      PAVD.num_base_attribute1,
      PAVD.num_base_attribute2,
      PAVD.num_base_attribute3,
      PAVD.num_base_attribute4,
      PAVD.num_base_attribute5,
      PAVD.num_base_attribute6,
      PAVD.num_base_attribute7,
      PAVD.num_base_attribute8,
      PAVD.num_base_attribute9,
      PAVD.num_base_attribute10,
      PAVD.num_base_attribute11,
      PAVD.num_base_attribute12,
      PAVD.num_base_attribute13,
      PAVD.num_base_attribute14,
      PAVD.num_base_attribute15,
      PAVD.num_base_attribute16,
      PAVD.num_base_attribute17,
      PAVD.num_base_attribute18,
      PAVD.num_base_attribute19,
      PAVD.num_base_attribute20,
      PAVD.num_base_attribute21,
      PAVD.num_base_attribute22,
      PAVD.num_base_attribute23,
      PAVD.num_base_attribute24,
      PAVD.num_base_attribute25,
      PAVD.num_base_attribute26,
      PAVD.num_base_attribute27,
      PAVD.num_base_attribute28,
      PAVD.num_base_attribute29,
      PAVD.num_base_attribute30,
      PAVD.num_base_attribute31,
      PAVD.num_base_attribute32,
      PAVD.num_base_attribute33,
      PAVD.num_base_attribute34,
      PAVD.num_base_attribute35,
      PAVD.num_base_attribute36,
      PAVD.num_base_attribute37,
      PAVD.num_base_attribute38,
      PAVD.num_base_attribute39,
      PAVD.num_base_attribute40,
      PAVD.num_base_attribute41,
      PAVD.num_base_attribute42,
      PAVD.num_base_attribute43,
      PAVD.num_base_attribute44,
      PAVD.num_base_attribute45,
      PAVD.num_base_attribute46,
      PAVD.num_base_attribute47,
      PAVD.num_base_attribute48,
      PAVD.num_base_attribute49,
      PAVD.num_base_attribute50,
      PAVD.num_base_attribute51,
      PAVD.num_base_attribute52,
      PAVD.num_base_attribute53,
      PAVD.num_base_attribute54,
      PAVD.num_base_attribute55,
      PAVD.num_base_attribute56,
      PAVD.num_base_attribute57,
      PAVD.num_base_attribute58,
      PAVD.num_base_attribute59,
      PAVD.num_base_attribute60,
      PAVD.num_base_attribute61,
      PAVD.num_base_attribute62,
      PAVD.num_base_attribute63,
      PAVD.num_base_attribute64,
      PAVD.num_base_attribute65,
      PAVD.num_base_attribute66,
      PAVD.num_base_attribute67,
      PAVD.num_base_attribute68,
      PAVD.num_base_attribute69,
      PAVD.num_base_attribute70,
      PAVD.num_base_attribute71,
      PAVD.num_base_attribute72,
      PAVD.num_base_attribute73,
      PAVD.num_base_attribute74,
      PAVD.num_base_attribute75,
      PAVD.num_base_attribute76,
      PAVD.num_base_attribute77,
      PAVD.num_base_attribute78,
      PAVD.num_base_attribute79,
      PAVD.num_base_attribute80,
      PAVD.num_base_attribute81,
      PAVD.num_base_attribute82,
      PAVD.num_base_attribute83,
      PAVD.num_base_attribute84,
      PAVD.num_base_attribute85,
      PAVD.num_base_attribute86,
      PAVD.num_base_attribute87,
      PAVD.num_base_attribute88,
      PAVD.num_base_attribute89,
      PAVD.num_base_attribute90,
      PAVD.num_base_attribute91,
      PAVD.num_base_attribute92,
      PAVD.num_base_attribute93,
      PAVD.num_base_attribute94,
      PAVD.num_base_attribute95,
      PAVD.num_base_attribute96,
      PAVD.num_base_attribute97,
      PAVD.num_base_attribute98,
      PAVD.num_base_attribute99,
      PAVD.num_base_attribute100,
      PAVD.text_cat_attribute1,
      PAVD.text_cat_attribute2,
      PAVD.text_cat_attribute3,
      PAVD.text_cat_attribute4,
      PAVD.text_cat_attribute5,
      PAVD.text_cat_attribute6,
      PAVD.text_cat_attribute7,
      PAVD.text_cat_attribute8,
      PAVD.text_cat_attribute9,
      PAVD.text_cat_attribute10,
      PAVD.text_cat_attribute11,
      PAVD.text_cat_attribute12,
      PAVD.text_cat_attribute13,
      PAVD.text_cat_attribute14,
      PAVD.text_cat_attribute15,
      PAVD.text_cat_attribute16,
      PAVD.text_cat_attribute17,
      PAVD.text_cat_attribute18,
      PAVD.text_cat_attribute19,
      PAVD.text_cat_attribute20,
      PAVD.text_cat_attribute21,
      PAVD.text_cat_attribute22,
      PAVD.text_cat_attribute23,
      PAVD.text_cat_attribute24,
      PAVD.text_cat_attribute25,
      PAVD.text_cat_attribute26,
      PAVD.text_cat_attribute27,
      PAVD.text_cat_attribute28,
      PAVD.text_cat_attribute29,
      PAVD.text_cat_attribute30,
      PAVD.text_cat_attribute31,
      PAVD.text_cat_attribute32,
      PAVD.text_cat_attribute33,
      PAVD.text_cat_attribute34,
      PAVD.text_cat_attribute35,
      PAVD.text_cat_attribute36,
      PAVD.text_cat_attribute37,
      PAVD.text_cat_attribute38,
      PAVD.text_cat_attribute39,
      PAVD.text_cat_attribute40,
      PAVD.text_cat_attribute41,
      PAVD.text_cat_attribute42,
      PAVD.text_cat_attribute43,
      PAVD.text_cat_attribute44,
      PAVD.text_cat_attribute45,
      PAVD.text_cat_attribute46,
      PAVD.text_cat_attribute47,
      PAVD.text_cat_attribute48,
      PAVD.text_cat_attribute49,
      PAVD.text_cat_attribute50,
      PAVD.num_cat_attribute1,
      PAVD.num_cat_attribute2,
      PAVD.num_cat_attribute3,
      PAVD.num_cat_attribute4,
      PAVD.num_cat_attribute5,
      PAVD.num_cat_attribute6,
      PAVD.num_cat_attribute7,
      PAVD.num_cat_attribute8,
      PAVD.num_cat_attribute9,
      PAVD.num_cat_attribute10,
      PAVD.num_cat_attribute11,
      PAVD.num_cat_attribute12,
      PAVD.num_cat_attribute13,
      PAVD.num_cat_attribute14,
      PAVD.num_cat_attribute15,
      PAVD.num_cat_attribute16,
      PAVD.num_cat_attribute17,
      PAVD.num_cat_attribute18,
      PAVD.num_cat_attribute19,
      PAVD.num_cat_attribute20,
      PAVD.num_cat_attribute21,
      PAVD.num_cat_attribute22,
      PAVD.num_cat_attribute23,
      PAVD.num_cat_attribute24,
      PAVD.num_cat_attribute25,
      PAVD.num_cat_attribute26,
      PAVD.num_cat_attribute27,
      PAVD.num_cat_attribute28,
      PAVD.num_cat_attribute29,
      PAVD.num_cat_attribute30,
      PAVD.num_cat_attribute31,
      PAVD.num_cat_attribute32,
      PAVD.num_cat_attribute33,
      PAVD.num_cat_attribute34,
      PAVD.num_cat_attribute35,
      PAVD.num_cat_attribute36,
      PAVD.num_cat_attribute37,
      PAVD.num_cat_attribute38,
      PAVD.num_cat_attribute39,
      PAVD.num_cat_attribute40,
      PAVD.num_cat_attribute41,
      PAVD.num_cat_attribute42,
      PAVD.num_cat_attribute43,
      PAVD.num_cat_attribute44,
      PAVD.num_cat_attribute45,
      PAVD.num_cat_attribute46,
      PAVD.num_cat_attribute47,
      PAVD.num_cat_attribute48,
      PAVD.num_cat_attribute49,
      PAVD.num_cat_attribute50,
      PAVD.last_update_login,
      PAVD.last_updated_by,
      PAVD.last_update_date,
      PAVD.created_by,
      PAVD.creation_date,
      PAVD.request_id,
      PAVD.program_application_id,
      PAVD.program_id,
      PAVD.program_update_date
    FROM po_attribute_values_draft PAVD
    WHERE PAVD.draft_id = p_draft_id
    AND NVL(PAVD.change_accepted_flag, 'Y') = 'Y') PAVDV
  ON (PAV.attribute_values_id = PAVDV.attribute_values_id)
  WHEN MATCHED THEN
    UPDATE
    SET
      PAV.po_line_id = PAVDV.po_line_id,
      PAV.req_template_name = PAVDV.req_template_name,
      PAV.req_template_line_num = PAVDV.req_template_line_num,
      PAV.ip_category_id = PAVDV.ip_category_id,
      PAV.inventory_item_id = PAVDV.inventory_item_id,
      PAV.org_id = PAVDV.org_id,
      PAV.manufacturer_part_num = PAVDV.manufacturer_part_num,
      PAV.picture = PAVDV.picture,
      PAV.thumbnail_image = PAVDV.thumbnail_image,
      PAV.supplier_url = PAVDV.supplier_url,
      PAV.manufacturer_url = PAVDV.manufacturer_url,
      PAV.attachment_url = PAVDV.attachment_url,
      PAV.unspsc = PAVDV.unspsc,
      PAV.availability = PAVDV.availability,
      PAV.lead_time = PAVDV.lead_time,
      PAV.text_base_attribute1 = PAVDV.text_base_attribute1,
      PAV.text_base_attribute2 = PAVDV.text_base_attribute2,
      PAV.text_base_attribute3 = PAVDV.text_base_attribute3,
      PAV.text_base_attribute4 = PAVDV.text_base_attribute4,
      PAV.text_base_attribute5 = PAVDV.text_base_attribute5,
      PAV.text_base_attribute6 = PAVDV.text_base_attribute6,
      PAV.text_base_attribute7 = PAVDV.text_base_attribute7,
      PAV.text_base_attribute8 = PAVDV.text_base_attribute8,
      PAV.text_base_attribute9 = PAVDV.text_base_attribute9,
      PAV.text_base_attribute10 = PAVDV.text_base_attribute10,
      PAV.text_base_attribute11 = PAVDV.text_base_attribute11,
      PAV.text_base_attribute12 = PAVDV.text_base_attribute12,
      PAV.text_base_attribute13 = PAVDV.text_base_attribute13,
      PAV.text_base_attribute14 = PAVDV.text_base_attribute14,
      PAV.text_base_attribute15 = PAVDV.text_base_attribute15,
      PAV.text_base_attribute16 = PAVDV.text_base_attribute16,
      PAV.text_base_attribute17 = PAVDV.text_base_attribute17,
      PAV.text_base_attribute18 = PAVDV.text_base_attribute18,
      PAV.text_base_attribute19 = PAVDV.text_base_attribute19,
      PAV.text_base_attribute20 = PAVDV.text_base_attribute20,
      PAV.text_base_attribute21 = PAVDV.text_base_attribute21,
      PAV.text_base_attribute22 = PAVDV.text_base_attribute22,
      PAV.text_base_attribute23 = PAVDV.text_base_attribute23,
      PAV.text_base_attribute24 = PAVDV.text_base_attribute24,
      PAV.text_base_attribute25 = PAVDV.text_base_attribute25,
      PAV.text_base_attribute26 = PAVDV.text_base_attribute26,
      PAV.text_base_attribute27 = PAVDV.text_base_attribute27,
      PAV.text_base_attribute28 = PAVDV.text_base_attribute28,
      PAV.text_base_attribute29 = PAVDV.text_base_attribute29,
      PAV.text_base_attribute30 = PAVDV.text_base_attribute30,
      PAV.text_base_attribute31 = PAVDV.text_base_attribute31,
      PAV.text_base_attribute32 = PAVDV.text_base_attribute32,
      PAV.text_base_attribute33 = PAVDV.text_base_attribute33,
      PAV.text_base_attribute34 = PAVDV.text_base_attribute34,
      PAV.text_base_attribute35 = PAVDV.text_base_attribute35,
      PAV.text_base_attribute36 = PAVDV.text_base_attribute36,
      PAV.text_base_attribute37 = PAVDV.text_base_attribute37,
      PAV.text_base_attribute38 = PAVDV.text_base_attribute38,
      PAV.text_base_attribute39 = PAVDV.text_base_attribute39,
      PAV.text_base_attribute40 = PAVDV.text_base_attribute40,
      PAV.text_base_attribute41 = PAVDV.text_base_attribute41,
      PAV.text_base_attribute42 = PAVDV.text_base_attribute42,
      PAV.text_base_attribute43 = PAVDV.text_base_attribute43,
      PAV.text_base_attribute44 = PAVDV.text_base_attribute44,
      PAV.text_base_attribute45 = PAVDV.text_base_attribute45,
      PAV.text_base_attribute46 = PAVDV.text_base_attribute46,
      PAV.text_base_attribute47 = PAVDV.text_base_attribute47,
      PAV.text_base_attribute48 = PAVDV.text_base_attribute48,
      PAV.text_base_attribute49 = PAVDV.text_base_attribute49,
      PAV.text_base_attribute50 = PAVDV.text_base_attribute50,
      PAV.text_base_attribute51 = PAVDV.text_base_attribute51,
      PAV.text_base_attribute52 = PAVDV.text_base_attribute52,
      PAV.text_base_attribute53 = PAVDV.text_base_attribute53,
      PAV.text_base_attribute54 = PAVDV.text_base_attribute54,
      PAV.text_base_attribute55 = PAVDV.text_base_attribute55,
      PAV.text_base_attribute56 = PAVDV.text_base_attribute56,
      PAV.text_base_attribute57 = PAVDV.text_base_attribute57,
      PAV.text_base_attribute58 = PAVDV.text_base_attribute58,
      PAV.text_base_attribute59 = PAVDV.text_base_attribute59,
      PAV.text_base_attribute60 = PAVDV.text_base_attribute60,
      PAV.text_base_attribute61 = PAVDV.text_base_attribute61,
      PAV.text_base_attribute62 = PAVDV.text_base_attribute62,
      PAV.text_base_attribute63 = PAVDV.text_base_attribute63,
      PAV.text_base_attribute64 = PAVDV.text_base_attribute64,
      PAV.text_base_attribute65 = PAVDV.text_base_attribute65,
      PAV.text_base_attribute66 = PAVDV.text_base_attribute66,
      PAV.text_base_attribute67 = PAVDV.text_base_attribute67,
      PAV.text_base_attribute68 = PAVDV.text_base_attribute68,
      PAV.text_base_attribute69 = PAVDV.text_base_attribute69,
      PAV.text_base_attribute70 = PAVDV.text_base_attribute70,
      PAV.text_base_attribute71 = PAVDV.text_base_attribute71,
      PAV.text_base_attribute72 = PAVDV.text_base_attribute72,
      PAV.text_base_attribute73 = PAVDV.text_base_attribute73,
      PAV.text_base_attribute74 = PAVDV.text_base_attribute74,
      PAV.text_base_attribute75 = PAVDV.text_base_attribute75,
      PAV.text_base_attribute76 = PAVDV.text_base_attribute76,
      PAV.text_base_attribute77 = PAVDV.text_base_attribute77,
      PAV.text_base_attribute78 = PAVDV.text_base_attribute78,
      PAV.text_base_attribute79 = PAVDV.text_base_attribute79,
      PAV.text_base_attribute80 = PAVDV.text_base_attribute80,
      PAV.text_base_attribute81 = PAVDV.text_base_attribute81,
      PAV.text_base_attribute82 = PAVDV.text_base_attribute82,
      PAV.text_base_attribute83 = PAVDV.text_base_attribute83,
      PAV.text_base_attribute84 = PAVDV.text_base_attribute84,
      PAV.text_base_attribute85 = PAVDV.text_base_attribute85,
      PAV.text_base_attribute86 = PAVDV.text_base_attribute86,
      PAV.text_base_attribute87 = PAVDV.text_base_attribute87,
      PAV.text_base_attribute88 = PAVDV.text_base_attribute88,
      PAV.text_base_attribute89 = PAVDV.text_base_attribute89,
      PAV.text_base_attribute90 = PAVDV.text_base_attribute90,
      PAV.text_base_attribute91 = PAVDV.text_base_attribute91,
      PAV.text_base_attribute92 = PAVDV.text_base_attribute92,
      PAV.text_base_attribute93 = PAVDV.text_base_attribute93,
      PAV.text_base_attribute94 = PAVDV.text_base_attribute94,
      PAV.text_base_attribute95 = PAVDV.text_base_attribute95,
      PAV.text_base_attribute96 = PAVDV.text_base_attribute96,
      PAV.text_base_attribute97 = PAVDV.text_base_attribute97,
      PAV.text_base_attribute98 = PAVDV.text_base_attribute98,
      PAV.text_base_attribute99 = PAVDV.text_base_attribute99,
      PAV.text_base_attribute100 = PAVDV.text_base_attribute100,
      PAV.num_base_attribute1 = PAVDV.num_base_attribute1,
      PAV.num_base_attribute2 = PAVDV.num_base_attribute2,
      PAV.num_base_attribute3 = PAVDV.num_base_attribute3,
      PAV.num_base_attribute4 = PAVDV.num_base_attribute4,
      PAV.num_base_attribute5 = PAVDV.num_base_attribute5,
      PAV.num_base_attribute6 = PAVDV.num_base_attribute6,
      PAV.num_base_attribute7 = PAVDV.num_base_attribute7,
      PAV.num_base_attribute8 = PAVDV.num_base_attribute8,
      PAV.num_base_attribute9 = PAVDV.num_base_attribute9,
      PAV.num_base_attribute10 = PAVDV.num_base_attribute10,
      PAV.num_base_attribute11 = PAVDV.num_base_attribute11,
      PAV.num_base_attribute12 = PAVDV.num_base_attribute12,
      PAV.num_base_attribute13 = PAVDV.num_base_attribute13,
      PAV.num_base_attribute14 = PAVDV.num_base_attribute14,
      PAV.num_base_attribute15 = PAVDV.num_base_attribute15,
      PAV.num_base_attribute16 = PAVDV.num_base_attribute16,
      PAV.num_base_attribute17 = PAVDV.num_base_attribute17,
      PAV.num_base_attribute18 = PAVDV.num_base_attribute18,
      PAV.num_base_attribute19 = PAVDV.num_base_attribute19,
      PAV.num_base_attribute20 = PAVDV.num_base_attribute20,
      PAV.num_base_attribute21 = PAVDV.num_base_attribute21,
      PAV.num_base_attribute22 = PAVDV.num_base_attribute22,
      PAV.num_base_attribute23 = PAVDV.num_base_attribute23,
      PAV.num_base_attribute24 = PAVDV.num_base_attribute24,
      PAV.num_base_attribute25 = PAVDV.num_base_attribute25,
      PAV.num_base_attribute26 = PAVDV.num_base_attribute26,
      PAV.num_base_attribute27 = PAVDV.num_base_attribute27,
      PAV.num_base_attribute28 = PAVDV.num_base_attribute28,
      PAV.num_base_attribute29 = PAVDV.num_base_attribute29,
      PAV.num_base_attribute30 = PAVDV.num_base_attribute30,
      PAV.num_base_attribute31 = PAVDV.num_base_attribute31,
      PAV.num_base_attribute32 = PAVDV.num_base_attribute32,
      PAV.num_base_attribute33 = PAVDV.num_base_attribute33,
      PAV.num_base_attribute34 = PAVDV.num_base_attribute34,
      PAV.num_base_attribute35 = PAVDV.num_base_attribute35,
      PAV.num_base_attribute36 = PAVDV.num_base_attribute36,
      PAV.num_base_attribute37 = PAVDV.num_base_attribute37,
      PAV.num_base_attribute38 = PAVDV.num_base_attribute38,
      PAV.num_base_attribute39 = PAVDV.num_base_attribute39,
      PAV.num_base_attribute40 = PAVDV.num_base_attribute40,
      PAV.num_base_attribute41 = PAVDV.num_base_attribute41,
      PAV.num_base_attribute42 = PAVDV.num_base_attribute42,
      PAV.num_base_attribute43 = PAVDV.num_base_attribute43,
      PAV.num_base_attribute44 = PAVDV.num_base_attribute44,
      PAV.num_base_attribute45 = PAVDV.num_base_attribute45,
      PAV.num_base_attribute46 = PAVDV.num_base_attribute46,
      PAV.num_base_attribute47 = PAVDV.num_base_attribute47,
      PAV.num_base_attribute48 = PAVDV.num_base_attribute48,
      PAV.num_base_attribute49 = PAVDV.num_base_attribute49,
      PAV.num_base_attribute50 = PAVDV.num_base_attribute50,
      PAV.num_base_attribute51 = PAVDV.num_base_attribute51,
      PAV.num_base_attribute52 = PAVDV.num_base_attribute52,
      PAV.num_base_attribute53 = PAVDV.num_base_attribute53,
      PAV.num_base_attribute54 = PAVDV.num_base_attribute54,
      PAV.num_base_attribute55 = PAVDV.num_base_attribute55,
      PAV.num_base_attribute56 = PAVDV.num_base_attribute56,
      PAV.num_base_attribute57 = PAVDV.num_base_attribute57,
      PAV.num_base_attribute58 = PAVDV.num_base_attribute58,
      PAV.num_base_attribute59 = PAVDV.num_base_attribute59,
      PAV.num_base_attribute60 = PAVDV.num_base_attribute60,
      PAV.num_base_attribute61 = PAVDV.num_base_attribute61,
      PAV.num_base_attribute62 = PAVDV.num_base_attribute62,
      PAV.num_base_attribute63 = PAVDV.num_base_attribute63,
      PAV.num_base_attribute64 = PAVDV.num_base_attribute64,
      PAV.num_base_attribute65 = PAVDV.num_base_attribute65,
      PAV.num_base_attribute66 = PAVDV.num_base_attribute66,
      PAV.num_base_attribute67 = PAVDV.num_base_attribute67,
      PAV.num_base_attribute68 = PAVDV.num_base_attribute68,
      PAV.num_base_attribute69 = PAVDV.num_base_attribute69,
      PAV.num_base_attribute70 = PAVDV.num_base_attribute70,
      PAV.num_base_attribute71 = PAVDV.num_base_attribute71,
      PAV.num_base_attribute72 = PAVDV.num_base_attribute72,
      PAV.num_base_attribute73 = PAVDV.num_base_attribute73,
      PAV.num_base_attribute74 = PAVDV.num_base_attribute74,
      PAV.num_base_attribute75 = PAVDV.num_base_attribute75,
      PAV.num_base_attribute76 = PAVDV.num_base_attribute76,
      PAV.num_base_attribute77 = PAVDV.num_base_attribute77,
      PAV.num_base_attribute78 = PAVDV.num_base_attribute78,
      PAV.num_base_attribute79 = PAVDV.num_base_attribute79,
      PAV.num_base_attribute80 = PAVDV.num_base_attribute80,
      PAV.num_base_attribute81 = PAVDV.num_base_attribute81,
      PAV.num_base_attribute82 = PAVDV.num_base_attribute82,
      PAV.num_base_attribute83 = PAVDV.num_base_attribute83,
      PAV.num_base_attribute84 = PAVDV.num_base_attribute84,
      PAV.num_base_attribute85 = PAVDV.num_base_attribute85,
      PAV.num_base_attribute86 = PAVDV.num_base_attribute86,
      PAV.num_base_attribute87 = PAVDV.num_base_attribute87,
      PAV.num_base_attribute88 = PAVDV.num_base_attribute88,
      PAV.num_base_attribute89 = PAVDV.num_base_attribute89,
      PAV.num_base_attribute90 = PAVDV.num_base_attribute90,
      PAV.num_base_attribute91 = PAVDV.num_base_attribute91,
      PAV.num_base_attribute92 = PAVDV.num_base_attribute92,
      PAV.num_base_attribute93 = PAVDV.num_base_attribute93,
      PAV.num_base_attribute94 = PAVDV.num_base_attribute94,
      PAV.num_base_attribute95 = PAVDV.num_base_attribute95,
      PAV.num_base_attribute96 = PAVDV.num_base_attribute96,
      PAV.num_base_attribute97 = PAVDV.num_base_attribute97,
      PAV.num_base_attribute98 = PAVDV.num_base_attribute98,
      PAV.num_base_attribute99 = PAVDV.num_base_attribute99,
      PAV.num_base_attribute100 = PAVDV.num_base_attribute100,
      PAV.text_cat_attribute1 = PAVDV.text_cat_attribute1,
      PAV.text_cat_attribute2 = PAVDV.text_cat_attribute2,
      PAV.text_cat_attribute3 = PAVDV.text_cat_attribute3,
      PAV.text_cat_attribute4 = PAVDV.text_cat_attribute4,
      PAV.text_cat_attribute5 = PAVDV.text_cat_attribute5,
      PAV.text_cat_attribute6 = PAVDV.text_cat_attribute6,
      PAV.text_cat_attribute7 = PAVDV.text_cat_attribute7,
      PAV.text_cat_attribute8 = PAVDV.text_cat_attribute8,
      PAV.text_cat_attribute9 = PAVDV.text_cat_attribute9,
      PAV.text_cat_attribute10 = PAVDV.text_cat_attribute10,
      PAV.text_cat_attribute11 = PAVDV.text_cat_attribute11,
      PAV.text_cat_attribute12 = PAVDV.text_cat_attribute12,
      PAV.text_cat_attribute13 = PAVDV.text_cat_attribute13,
      PAV.text_cat_attribute14 = PAVDV.text_cat_attribute14,
      PAV.text_cat_attribute15 = PAVDV.text_cat_attribute15,
      PAV.text_cat_attribute16 = PAVDV.text_cat_attribute16,
      PAV.text_cat_attribute17 = PAVDV.text_cat_attribute17,
      PAV.text_cat_attribute18 = PAVDV.text_cat_attribute18,
      PAV.text_cat_attribute19 = PAVDV.text_cat_attribute19,
      PAV.text_cat_attribute20 = PAVDV.text_cat_attribute20,
      PAV.text_cat_attribute21 = PAVDV.text_cat_attribute21,
      PAV.text_cat_attribute22 = PAVDV.text_cat_attribute22,
      PAV.text_cat_attribute23 = PAVDV.text_cat_attribute23,
      PAV.text_cat_attribute24 = PAVDV.text_cat_attribute24,
      PAV.text_cat_attribute25 = PAVDV.text_cat_attribute25,
      PAV.text_cat_attribute26 = PAVDV.text_cat_attribute26,
      PAV.text_cat_attribute27 = PAVDV.text_cat_attribute27,
      PAV.text_cat_attribute28 = PAVDV.text_cat_attribute28,
      PAV.text_cat_attribute29 = PAVDV.text_cat_attribute29,
      PAV.text_cat_attribute30 = PAVDV.text_cat_attribute30,
      PAV.text_cat_attribute31 = PAVDV.text_cat_attribute31,
      PAV.text_cat_attribute32 = PAVDV.text_cat_attribute32,
      PAV.text_cat_attribute33 = PAVDV.text_cat_attribute33,
      PAV.text_cat_attribute34 = PAVDV.text_cat_attribute34,
      PAV.text_cat_attribute35 = PAVDV.text_cat_attribute35,
      PAV.text_cat_attribute36 = PAVDV.text_cat_attribute36,
      PAV.text_cat_attribute37 = PAVDV.text_cat_attribute37,
      PAV.text_cat_attribute38 = PAVDV.text_cat_attribute38,
      PAV.text_cat_attribute39 = PAVDV.text_cat_attribute39,
      PAV.text_cat_attribute40 = PAVDV.text_cat_attribute40,
      PAV.text_cat_attribute41 = PAVDV.text_cat_attribute41,
      PAV.text_cat_attribute42 = PAVDV.text_cat_attribute42,
      PAV.text_cat_attribute43 = PAVDV.text_cat_attribute43,
      PAV.text_cat_attribute44 = PAVDV.text_cat_attribute44,
      PAV.text_cat_attribute45 = PAVDV.text_cat_attribute45,
      PAV.text_cat_attribute46 = PAVDV.text_cat_attribute46,
      PAV.text_cat_attribute47 = PAVDV.text_cat_attribute47,
      PAV.text_cat_attribute48 = PAVDV.text_cat_attribute48,
      PAV.text_cat_attribute49 = PAVDV.text_cat_attribute49,
      PAV.text_cat_attribute50 = PAVDV.text_cat_attribute50,
      PAV.num_cat_attribute1 = PAVDV.num_cat_attribute1,
      PAV.num_cat_attribute2 = PAVDV.num_cat_attribute2,
      PAV.num_cat_attribute3 = PAVDV.num_cat_attribute3,
      PAV.num_cat_attribute4 = PAVDV.num_cat_attribute4,
      PAV.num_cat_attribute5 = PAVDV.num_cat_attribute5,
      PAV.num_cat_attribute6 = PAVDV.num_cat_attribute6,
      PAV.num_cat_attribute7 = PAVDV.num_cat_attribute7,
      PAV.num_cat_attribute8 = PAVDV.num_cat_attribute8,
      PAV.num_cat_attribute9 = PAVDV.num_cat_attribute9,
      PAV.num_cat_attribute10 = PAVDV.num_cat_attribute10,
      PAV.num_cat_attribute11 = PAVDV.num_cat_attribute11,
      PAV.num_cat_attribute12 = PAVDV.num_cat_attribute12,
      PAV.num_cat_attribute13 = PAVDV.num_cat_attribute13,
      PAV.num_cat_attribute14 = PAVDV.num_cat_attribute14,
      PAV.num_cat_attribute15 = PAVDV.num_cat_attribute15,
      PAV.num_cat_attribute16 = PAVDV.num_cat_attribute16,
      PAV.num_cat_attribute17 = PAVDV.num_cat_attribute17,
      PAV.num_cat_attribute18 = PAVDV.num_cat_attribute18,
      PAV.num_cat_attribute19 = PAVDV.num_cat_attribute19,
      PAV.num_cat_attribute20 = PAVDV.num_cat_attribute20,
      PAV.num_cat_attribute21 = PAVDV.num_cat_attribute21,
      PAV.num_cat_attribute22 = PAVDV.num_cat_attribute22,
      PAV.num_cat_attribute23 = PAVDV.num_cat_attribute23,
      PAV.num_cat_attribute24 = PAVDV.num_cat_attribute24,
      PAV.num_cat_attribute25 = PAVDV.num_cat_attribute25,
      PAV.num_cat_attribute26 = PAVDV.num_cat_attribute26,
      PAV.num_cat_attribute27 = PAVDV.num_cat_attribute27,
      PAV.num_cat_attribute28 = PAVDV.num_cat_attribute28,
      PAV.num_cat_attribute29 = PAVDV.num_cat_attribute29,
      PAV.num_cat_attribute30 = PAVDV.num_cat_attribute30,
      PAV.num_cat_attribute31 = PAVDV.num_cat_attribute31,
      PAV.num_cat_attribute32 = PAVDV.num_cat_attribute32,
      PAV.num_cat_attribute33 = PAVDV.num_cat_attribute33,
      PAV.num_cat_attribute34 = PAVDV.num_cat_attribute34,
      PAV.num_cat_attribute35 = PAVDV.num_cat_attribute35,
      PAV.num_cat_attribute36 = PAVDV.num_cat_attribute36,
      PAV.num_cat_attribute37 = PAVDV.num_cat_attribute37,
      PAV.num_cat_attribute38 = PAVDV.num_cat_attribute38,
      PAV.num_cat_attribute39 = PAVDV.num_cat_attribute39,
      PAV.num_cat_attribute40 = PAVDV.num_cat_attribute40,
      PAV.num_cat_attribute41 = PAVDV.num_cat_attribute41,
      PAV.num_cat_attribute42 = PAVDV.num_cat_attribute42,
      PAV.num_cat_attribute43 = PAVDV.num_cat_attribute43,
      PAV.num_cat_attribute44 = PAVDV.num_cat_attribute44,
      PAV.num_cat_attribute45 = PAVDV.num_cat_attribute45,
      PAV.num_cat_attribute46 = PAVDV.num_cat_attribute46,
      PAV.num_cat_attribute47 = PAVDV.num_cat_attribute47,
      PAV.num_cat_attribute48 = PAVDV.num_cat_attribute48,
      PAV.num_cat_attribute49 = PAVDV.num_cat_attribute49,
      PAV.num_cat_attribute50 = PAVDV.num_cat_attribute50,
      PAV.last_update_login = PAVDV.last_update_login,
      PAV.last_updated_by = PAVDV.last_updated_by,
      PAV.last_update_date = PAVDV.last_update_date,
      PAV.request_id = PAVDV.request_id,
      PAV.program_application_id = PAVDV.program_application_id,
      PAV.program_id = PAVDV.program_id,
      PAV.program_update_date = PAVDV.program_update_date,
      PAV.rebuild_search_index_flag = 'Y'  -- rebuild index
  --  DELETE WHERE PAVDV.delete_flag = 'Y'
  WHEN NOT MATCHED THEN
    INSERT
    (
      PAV.attribute_values_id,
      PAV.po_line_id,
      PAV.req_template_name,
      PAV.req_template_line_num,
      PAV.ip_category_id,
      PAV.inventory_item_id,
      PAV.org_id,
      PAV.manufacturer_part_num,
      PAV.picture,
      PAV.thumbnail_image,
      PAV.supplier_url,
      PAV.manufacturer_url,
      PAV.attachment_url,
      PAV.unspsc,
      PAV.availability,
      PAV.lead_time,
      PAV.text_base_attribute1,
      PAV.text_base_attribute2,
      PAV.text_base_attribute3,
      PAV.text_base_attribute4,
      PAV.text_base_attribute5,
      PAV.text_base_attribute6,
      PAV.text_base_attribute7,
      PAV.text_base_attribute8,
      PAV.text_base_attribute9,
      PAV.text_base_attribute10,
      PAV.text_base_attribute11,
      PAV.text_base_attribute12,
      PAV.text_base_attribute13,
      PAV.text_base_attribute14,
      PAV.text_base_attribute15,
      PAV.text_base_attribute16,
      PAV.text_base_attribute17,
      PAV.text_base_attribute18,
      PAV.text_base_attribute19,
      PAV.text_base_attribute20,
      PAV.text_base_attribute21,
      PAV.text_base_attribute22,
      PAV.text_base_attribute23,
      PAV.text_base_attribute24,
      PAV.text_base_attribute25,
      PAV.text_base_attribute26,
      PAV.text_base_attribute27,
      PAV.text_base_attribute28,
      PAV.text_base_attribute29,
      PAV.text_base_attribute30,
      PAV.text_base_attribute31,
      PAV.text_base_attribute32,
      PAV.text_base_attribute33,
      PAV.text_base_attribute34,
      PAV.text_base_attribute35,
      PAV.text_base_attribute36,
      PAV.text_base_attribute37,
      PAV.text_base_attribute38,
      PAV.text_base_attribute39,
      PAV.text_base_attribute40,
      PAV.text_base_attribute41,
      PAV.text_base_attribute42,
      PAV.text_base_attribute43,
      PAV.text_base_attribute44,
      PAV.text_base_attribute45,
      PAV.text_base_attribute46,
      PAV.text_base_attribute47,
      PAV.text_base_attribute48,
      PAV.text_base_attribute49,
      PAV.text_base_attribute50,
      PAV.text_base_attribute51,
      PAV.text_base_attribute52,
      PAV.text_base_attribute53,
      PAV.text_base_attribute54,
      PAV.text_base_attribute55,
      PAV.text_base_attribute56,
      PAV.text_base_attribute57,
      PAV.text_base_attribute58,
      PAV.text_base_attribute59,
      PAV.text_base_attribute60,
      PAV.text_base_attribute61,
      PAV.text_base_attribute62,
      PAV.text_base_attribute63,
      PAV.text_base_attribute64,
      PAV.text_base_attribute65,
      PAV.text_base_attribute66,
      PAV.text_base_attribute67,
      PAV.text_base_attribute68,
      PAV.text_base_attribute69,
      PAV.text_base_attribute70,
      PAV.text_base_attribute71,
      PAV.text_base_attribute72,
      PAV.text_base_attribute73,
      PAV.text_base_attribute74,
      PAV.text_base_attribute75,
      PAV.text_base_attribute76,
      PAV.text_base_attribute77,
      PAV.text_base_attribute78,
      PAV.text_base_attribute79,
      PAV.text_base_attribute80,
      PAV.text_base_attribute81,
      PAV.text_base_attribute82,
      PAV.text_base_attribute83,
      PAV.text_base_attribute84,
      PAV.text_base_attribute85,
      PAV.text_base_attribute86,
      PAV.text_base_attribute87,
      PAV.text_base_attribute88,
      PAV.text_base_attribute89,
      PAV.text_base_attribute90,
      PAV.text_base_attribute91,
      PAV.text_base_attribute92,
      PAV.text_base_attribute93,
      PAV.text_base_attribute94,
      PAV.text_base_attribute95,
      PAV.text_base_attribute96,
      PAV.text_base_attribute97,
      PAV.text_base_attribute98,
      PAV.text_base_attribute99,
      PAV.text_base_attribute100,
      PAV.num_base_attribute1,
      PAV.num_base_attribute2,
      PAV.num_base_attribute3,
      PAV.num_base_attribute4,
      PAV.num_base_attribute5,
      PAV.num_base_attribute6,
      PAV.num_base_attribute7,
      PAV.num_base_attribute8,
      PAV.num_base_attribute9,
      PAV.num_base_attribute10,
      PAV.num_base_attribute11,
      PAV.num_base_attribute12,
      PAV.num_base_attribute13,
      PAV.num_base_attribute14,
      PAV.num_base_attribute15,
      PAV.num_base_attribute16,
      PAV.num_base_attribute17,
      PAV.num_base_attribute18,
      PAV.num_base_attribute19,
      PAV.num_base_attribute20,
      PAV.num_base_attribute21,
      PAV.num_base_attribute22,
      PAV.num_base_attribute23,
      PAV.num_base_attribute24,
      PAV.num_base_attribute25,
      PAV.num_base_attribute26,
      PAV.num_base_attribute27,
      PAV.num_base_attribute28,
      PAV.num_base_attribute29,
      PAV.num_base_attribute30,
      PAV.num_base_attribute31,
      PAV.num_base_attribute32,
      PAV.num_base_attribute33,
      PAV.num_base_attribute34,
      PAV.num_base_attribute35,
      PAV.num_base_attribute36,
      PAV.num_base_attribute37,
      PAV.num_base_attribute38,
      PAV.num_base_attribute39,
      PAV.num_base_attribute40,
      PAV.num_base_attribute41,
      PAV.num_base_attribute42,
      PAV.num_base_attribute43,
      PAV.num_base_attribute44,
      PAV.num_base_attribute45,
      PAV.num_base_attribute46,
      PAV.num_base_attribute47,
      PAV.num_base_attribute48,
      PAV.num_base_attribute49,
      PAV.num_base_attribute50,
      PAV.num_base_attribute51,
      PAV.num_base_attribute52,
      PAV.num_base_attribute53,
      PAV.num_base_attribute54,
      PAV.num_base_attribute55,
      PAV.num_base_attribute56,
      PAV.num_base_attribute57,
      PAV.num_base_attribute58,
      PAV.num_base_attribute59,
      PAV.num_base_attribute60,
      PAV.num_base_attribute61,
      PAV.num_base_attribute62,
      PAV.num_base_attribute63,
      PAV.num_base_attribute64,
      PAV.num_base_attribute65,
      PAV.num_base_attribute66,
      PAV.num_base_attribute67,
      PAV.num_base_attribute68,
      PAV.num_base_attribute69,
      PAV.num_base_attribute70,
      PAV.num_base_attribute71,
      PAV.num_base_attribute72,
      PAV.num_base_attribute73,
      PAV.num_base_attribute74,
      PAV.num_base_attribute75,
      PAV.num_base_attribute76,
      PAV.num_base_attribute77,
      PAV.num_base_attribute78,
      PAV.num_base_attribute79,
      PAV.num_base_attribute80,
      PAV.num_base_attribute81,
      PAV.num_base_attribute82,
      PAV.num_base_attribute83,
      PAV.num_base_attribute84,
      PAV.num_base_attribute85,
      PAV.num_base_attribute86,
      PAV.num_base_attribute87,
      PAV.num_base_attribute88,
      PAV.num_base_attribute89,
      PAV.num_base_attribute90,
      PAV.num_base_attribute91,
      PAV.num_base_attribute92,
      PAV.num_base_attribute93,
      PAV.num_base_attribute94,
      PAV.num_base_attribute95,
      PAV.num_base_attribute96,
      PAV.num_base_attribute97,
      PAV.num_base_attribute98,
      PAV.num_base_attribute99,
      PAV.num_base_attribute100,
      PAV.text_cat_attribute1,
      PAV.text_cat_attribute2,
      PAV.text_cat_attribute3,
      PAV.text_cat_attribute4,
      PAV.text_cat_attribute5,
      PAV.text_cat_attribute6,
      PAV.text_cat_attribute7,
      PAV.text_cat_attribute8,
      PAV.text_cat_attribute9,
      PAV.text_cat_attribute10,
      PAV.text_cat_attribute11,
      PAV.text_cat_attribute12,
      PAV.text_cat_attribute13,
      PAV.text_cat_attribute14,
      PAV.text_cat_attribute15,
      PAV.text_cat_attribute16,
      PAV.text_cat_attribute17,
      PAV.text_cat_attribute18,
      PAV.text_cat_attribute19,
      PAV.text_cat_attribute20,
      PAV.text_cat_attribute21,
      PAV.text_cat_attribute22,
      PAV.text_cat_attribute23,
      PAV.text_cat_attribute24,
      PAV.text_cat_attribute25,
      PAV.text_cat_attribute26,
      PAV.text_cat_attribute27,
      PAV.text_cat_attribute28,
      PAV.text_cat_attribute29,
      PAV.text_cat_attribute30,
      PAV.text_cat_attribute31,
      PAV.text_cat_attribute32,
      PAV.text_cat_attribute33,
      PAV.text_cat_attribute34,
      PAV.text_cat_attribute35,
      PAV.text_cat_attribute36,
      PAV.text_cat_attribute37,
      PAV.text_cat_attribute38,
      PAV.text_cat_attribute39,
      PAV.text_cat_attribute40,
      PAV.text_cat_attribute41,
      PAV.text_cat_attribute42,
      PAV.text_cat_attribute43,
      PAV.text_cat_attribute44,
      PAV.text_cat_attribute45,
      PAV.text_cat_attribute46,
      PAV.text_cat_attribute47,
      PAV.text_cat_attribute48,
      PAV.text_cat_attribute49,
      PAV.text_cat_attribute50,
      PAV.num_cat_attribute1,
      PAV.num_cat_attribute2,
      PAV.num_cat_attribute3,
      PAV.num_cat_attribute4,
      PAV.num_cat_attribute5,
      PAV.num_cat_attribute6,
      PAV.num_cat_attribute7,
      PAV.num_cat_attribute8,
      PAV.num_cat_attribute9,
      PAV.num_cat_attribute10,
      PAV.num_cat_attribute11,
      PAV.num_cat_attribute12,
      PAV.num_cat_attribute13,
      PAV.num_cat_attribute14,
      PAV.num_cat_attribute15,
      PAV.num_cat_attribute16,
      PAV.num_cat_attribute17,
      PAV.num_cat_attribute18,
      PAV.num_cat_attribute19,
      PAV.num_cat_attribute20,
      PAV.num_cat_attribute21,
      PAV.num_cat_attribute22,
      PAV.num_cat_attribute23,
      PAV.num_cat_attribute24,
      PAV.num_cat_attribute25,
      PAV.num_cat_attribute26,
      PAV.num_cat_attribute27,
      PAV.num_cat_attribute28,
      PAV.num_cat_attribute29,
      PAV.num_cat_attribute30,
      PAV.num_cat_attribute31,
      PAV.num_cat_attribute32,
      PAV.num_cat_attribute33,
      PAV.num_cat_attribute34,
      PAV.num_cat_attribute35,
      PAV.num_cat_attribute36,
      PAV.num_cat_attribute37,
      PAV.num_cat_attribute38,
      PAV.num_cat_attribute39,
      PAV.num_cat_attribute40,
      PAV.num_cat_attribute41,
      PAV.num_cat_attribute42,
      PAV.num_cat_attribute43,
      PAV.num_cat_attribute44,
      PAV.num_cat_attribute45,
      PAV.num_cat_attribute46,
      PAV.num_cat_attribute47,
      PAV.num_cat_attribute48,
      PAV.num_cat_attribute49,
      PAV.num_cat_attribute50,
      PAV.last_update_login,
      PAV.last_updated_by,
      PAV.last_update_date,
      PAV.created_by,
      PAV.creation_date,
      PAV.request_id,
      PAV.program_application_id,
      PAV.program_id,
      PAV.program_update_date,
      PAV.rebuild_search_index_flag
    )
    VALUES
    (
      PAVDV.attribute_values_id,
      PAVDV.po_line_id,
      PAVDV.req_template_name,
      PAVDV.req_template_line_num,
      PAVDV.ip_category_id,
      PAVDV.inventory_item_id,
      PAVDV.org_id,
      PAVDV.manufacturer_part_num,
      PAVDV.picture,
      PAVDV.thumbnail_image,
      PAVDV.supplier_url,
      PAVDV.manufacturer_url,
      PAVDV.attachment_url,
      PAVDV.unspsc,
      PAVDV.availability,
      PAVDV.lead_time,
      PAVDV.text_base_attribute1,
      PAVDV.text_base_attribute2,
      PAVDV.text_base_attribute3,
      PAVDV.text_base_attribute4,
      PAVDV.text_base_attribute5,
      PAVDV.text_base_attribute6,
      PAVDV.text_base_attribute7,
      PAVDV.text_base_attribute8,
      PAVDV.text_base_attribute9,
      PAVDV.text_base_attribute10,
      PAVDV.text_base_attribute11,
      PAVDV.text_base_attribute12,
      PAVDV.text_base_attribute13,
      PAVDV.text_base_attribute14,
      PAVDV.text_base_attribute15,
      PAVDV.text_base_attribute16,
      PAVDV.text_base_attribute17,
      PAVDV.text_base_attribute18,
      PAVDV.text_base_attribute19,
      PAVDV.text_base_attribute20,
      PAVDV.text_base_attribute21,
      PAVDV.text_base_attribute22,
      PAVDV.text_base_attribute23,
      PAVDV.text_base_attribute24,
      PAVDV.text_base_attribute25,
      PAVDV.text_base_attribute26,
      PAVDV.text_base_attribute27,
      PAVDV.text_base_attribute28,
      PAVDV.text_base_attribute29,
      PAVDV.text_base_attribute30,
      PAVDV.text_base_attribute31,
      PAVDV.text_base_attribute32,
      PAVDV.text_base_attribute33,
      PAVDV.text_base_attribute34,
      PAVDV.text_base_attribute35,
      PAVDV.text_base_attribute36,
      PAVDV.text_base_attribute37,
      PAVDV.text_base_attribute38,
      PAVDV.text_base_attribute39,
      PAVDV.text_base_attribute40,
      PAVDV.text_base_attribute41,
      PAVDV.text_base_attribute42,
      PAVDV.text_base_attribute43,
      PAVDV.text_base_attribute44,
      PAVDV.text_base_attribute45,
      PAVDV.text_base_attribute46,
      PAVDV.text_base_attribute47,
      PAVDV.text_base_attribute48,
      PAVDV.text_base_attribute49,
      PAVDV.text_base_attribute50,
      PAVDV.text_base_attribute51,
      PAVDV.text_base_attribute52,
      PAVDV.text_base_attribute53,
      PAVDV.text_base_attribute54,
      PAVDV.text_base_attribute55,
      PAVDV.text_base_attribute56,
      PAVDV.text_base_attribute57,
      PAVDV.text_base_attribute58,
      PAVDV.text_base_attribute59,
      PAVDV.text_base_attribute60,
      PAVDV.text_base_attribute61,
      PAVDV.text_base_attribute62,
      PAVDV.text_base_attribute63,
      PAVDV.text_base_attribute64,
      PAVDV.text_base_attribute65,
      PAVDV.text_base_attribute66,
      PAVDV.text_base_attribute67,
      PAVDV.text_base_attribute68,
      PAVDV.text_base_attribute69,
      PAVDV.text_base_attribute70,
      PAVDV.text_base_attribute71,
      PAVDV.text_base_attribute72,
      PAVDV.text_base_attribute73,
      PAVDV.text_base_attribute74,
      PAVDV.text_base_attribute75,
      PAVDV.text_base_attribute76,
      PAVDV.text_base_attribute77,
      PAVDV.text_base_attribute78,
      PAVDV.text_base_attribute79,
      PAVDV.text_base_attribute80,
      PAVDV.text_base_attribute81,
      PAVDV.text_base_attribute82,
      PAVDV.text_base_attribute83,
      PAVDV.text_base_attribute84,
      PAVDV.text_base_attribute85,
      PAVDV.text_base_attribute86,
      PAVDV.text_base_attribute87,
      PAVDV.text_base_attribute88,
      PAVDV.text_base_attribute89,
      PAVDV.text_base_attribute90,
      PAVDV.text_base_attribute91,
      PAVDV.text_base_attribute92,
      PAVDV.text_base_attribute93,
      PAVDV.text_base_attribute94,
      PAVDV.text_base_attribute95,
      PAVDV.text_base_attribute96,
      PAVDV.text_base_attribute97,
      PAVDV.text_base_attribute98,
      PAVDV.text_base_attribute99,
      PAVDV.text_base_attribute100,
      PAVDV.num_base_attribute1,
      PAVDV.num_base_attribute2,
      PAVDV.num_base_attribute3,
      PAVDV.num_base_attribute4,
      PAVDV.num_base_attribute5,
      PAVDV.num_base_attribute6,
      PAVDV.num_base_attribute7,
      PAVDV.num_base_attribute8,
      PAVDV.num_base_attribute9,
      PAVDV.num_base_attribute10,
      PAVDV.num_base_attribute11,
      PAVDV.num_base_attribute12,
      PAVDV.num_base_attribute13,
      PAVDV.num_base_attribute14,
      PAVDV.num_base_attribute15,
      PAVDV.num_base_attribute16,
      PAVDV.num_base_attribute17,
      PAVDV.num_base_attribute18,
      PAVDV.num_base_attribute19,
      PAVDV.num_base_attribute20,
      PAVDV.num_base_attribute21,
      PAVDV.num_base_attribute22,
      PAVDV.num_base_attribute23,
      PAVDV.num_base_attribute24,
      PAVDV.num_base_attribute25,
      PAVDV.num_base_attribute26,
      PAVDV.num_base_attribute27,
      PAVDV.num_base_attribute28,
      PAVDV.num_base_attribute29,
      PAVDV.num_base_attribute30,
      PAVDV.num_base_attribute31,
      PAVDV.num_base_attribute32,
      PAVDV.num_base_attribute33,
      PAVDV.num_base_attribute34,
      PAVDV.num_base_attribute35,
      PAVDV.num_base_attribute36,
      PAVDV.num_base_attribute37,
      PAVDV.num_base_attribute38,
      PAVDV.num_base_attribute39,
      PAVDV.num_base_attribute40,
      PAVDV.num_base_attribute41,
      PAVDV.num_base_attribute42,
      PAVDV.num_base_attribute43,
      PAVDV.num_base_attribute44,
      PAVDV.num_base_attribute45,
      PAVDV.num_base_attribute46,
      PAVDV.num_base_attribute47,
      PAVDV.num_base_attribute48,
      PAVDV.num_base_attribute49,
      PAVDV.num_base_attribute50,
      PAVDV.num_base_attribute51,
      PAVDV.num_base_attribute52,
      PAVDV.num_base_attribute53,
      PAVDV.num_base_attribute54,
      PAVDV.num_base_attribute55,
      PAVDV.num_base_attribute56,
      PAVDV.num_base_attribute57,
      PAVDV.num_base_attribute58,
      PAVDV.num_base_attribute59,
      PAVDV.num_base_attribute60,
      PAVDV.num_base_attribute61,
      PAVDV.num_base_attribute62,
      PAVDV.num_base_attribute63,
      PAVDV.num_base_attribute64,
      PAVDV.num_base_attribute65,
      PAVDV.num_base_attribute66,
      PAVDV.num_base_attribute67,
      PAVDV.num_base_attribute68,
      PAVDV.num_base_attribute69,
      PAVDV.num_base_attribute70,
      PAVDV.num_base_attribute71,
      PAVDV.num_base_attribute72,
      PAVDV.num_base_attribute73,
      PAVDV.num_base_attribute74,
      PAVDV.num_base_attribute75,
      PAVDV.num_base_attribute76,
      PAVDV.num_base_attribute77,
      PAVDV.num_base_attribute78,
      PAVDV.num_base_attribute79,
      PAVDV.num_base_attribute80,
      PAVDV.num_base_attribute81,
      PAVDV.num_base_attribute82,
      PAVDV.num_base_attribute83,
      PAVDV.num_base_attribute84,
      PAVDV.num_base_attribute85,
      PAVDV.num_base_attribute86,
      PAVDV.num_base_attribute87,
      PAVDV.num_base_attribute88,
      PAVDV.num_base_attribute89,
      PAVDV.num_base_attribute90,
      PAVDV.num_base_attribute91,
      PAVDV.num_base_attribute92,
      PAVDV.num_base_attribute93,
      PAVDV.num_base_attribute94,
      PAVDV.num_base_attribute95,
      PAVDV.num_base_attribute96,
      PAVDV.num_base_attribute97,
      PAVDV.num_base_attribute98,
      PAVDV.num_base_attribute99,
      PAVDV.num_base_attribute100,
      PAVDV.text_cat_attribute1,
      PAVDV.text_cat_attribute2,
      PAVDV.text_cat_attribute3,
      PAVDV.text_cat_attribute4,
      PAVDV.text_cat_attribute5,
      PAVDV.text_cat_attribute6,
      PAVDV.text_cat_attribute7,
      PAVDV.text_cat_attribute8,
      PAVDV.text_cat_attribute9,
      PAVDV.text_cat_attribute10,
      PAVDV.text_cat_attribute11,
      PAVDV.text_cat_attribute12,
      PAVDV.text_cat_attribute13,
      PAVDV.text_cat_attribute14,
      PAVDV.text_cat_attribute15,
      PAVDV.text_cat_attribute16,
      PAVDV.text_cat_attribute17,
      PAVDV.text_cat_attribute18,
      PAVDV.text_cat_attribute19,
      PAVDV.text_cat_attribute20,
      PAVDV.text_cat_attribute21,
      PAVDV.text_cat_attribute22,
      PAVDV.text_cat_attribute23,
      PAVDV.text_cat_attribute24,
      PAVDV.text_cat_attribute25,
      PAVDV.text_cat_attribute26,
      PAVDV.text_cat_attribute27,
      PAVDV.text_cat_attribute28,
      PAVDV.text_cat_attribute29,
      PAVDV.text_cat_attribute30,
      PAVDV.text_cat_attribute31,
      PAVDV.text_cat_attribute32,
      PAVDV.text_cat_attribute33,
      PAVDV.text_cat_attribute34,
      PAVDV.text_cat_attribute35,
      PAVDV.text_cat_attribute36,
      PAVDV.text_cat_attribute37,
      PAVDV.text_cat_attribute38,
      PAVDV.text_cat_attribute39,
      PAVDV.text_cat_attribute40,
      PAVDV.text_cat_attribute41,
      PAVDV.text_cat_attribute42,
      PAVDV.text_cat_attribute43,
      PAVDV.text_cat_attribute44,
      PAVDV.text_cat_attribute45,
      PAVDV.text_cat_attribute46,
      PAVDV.text_cat_attribute47,
      PAVDV.text_cat_attribute48,
      PAVDV.text_cat_attribute49,
      PAVDV.text_cat_attribute50,
      PAVDV.num_cat_attribute1,
      PAVDV.num_cat_attribute2,
      PAVDV.num_cat_attribute3,
      PAVDV.num_cat_attribute4,
      PAVDV.num_cat_attribute5,
      PAVDV.num_cat_attribute6,
      PAVDV.num_cat_attribute7,
      PAVDV.num_cat_attribute8,
      PAVDV.num_cat_attribute9,
      PAVDV.num_cat_attribute10,
      PAVDV.num_cat_attribute11,
      PAVDV.num_cat_attribute12,
      PAVDV.num_cat_attribute13,
      PAVDV.num_cat_attribute14,
      PAVDV.num_cat_attribute15,
      PAVDV.num_cat_attribute16,
      PAVDV.num_cat_attribute17,
      PAVDV.num_cat_attribute18,
      PAVDV.num_cat_attribute19,
      PAVDV.num_cat_attribute20,
      PAVDV.num_cat_attribute21,
      PAVDV.num_cat_attribute22,
      PAVDV.num_cat_attribute23,
      PAVDV.num_cat_attribute24,
      PAVDV.num_cat_attribute25,
      PAVDV.num_cat_attribute26,
      PAVDV.num_cat_attribute27,
      PAVDV.num_cat_attribute28,
      PAVDV.num_cat_attribute29,
      PAVDV.num_cat_attribute30,
      PAVDV.num_cat_attribute31,
      PAVDV.num_cat_attribute32,
      PAVDV.num_cat_attribute33,
      PAVDV.num_cat_attribute34,
      PAVDV.num_cat_attribute35,
      PAVDV.num_cat_attribute36,
      PAVDV.num_cat_attribute37,
      PAVDV.num_cat_attribute38,
      PAVDV.num_cat_attribute39,
      PAVDV.num_cat_attribute40,
      PAVDV.num_cat_attribute41,
      PAVDV.num_cat_attribute42,
      PAVDV.num_cat_attribute43,
      PAVDV.num_cat_attribute44,
      PAVDV.num_cat_attribute45,
      PAVDV.num_cat_attribute46,
      PAVDV.num_cat_attribute47,
      PAVDV.num_cat_attribute48,
      PAVDV.num_cat_attribute49,
      PAVDV.num_cat_attribute50,
      PAVDV.last_update_login,
      PAVDV.last_updated_by,
      PAVDV.last_update_date,
      PAVDV.created_by,
      PAVDV.creation_date,
      PAVDV.request_id,
      PAVDV.program_application_id,
      PAVDV.program_id,
      PAVDV.program_update_date,
      'Y'   -- rebuild index
    ) WHERE NVL(PAVDV.delete_flag, 'N') <> 'Y';


  d_position := 10;
EXCEPTION
  WHEN OTHERS THEN
    PO_MESSAGE_S.add_exc_msg
    ( p_pkg_name => d_pkg_name,
      p_procedure_name => d_api_name || '.' || d_position
    );
    RAISE FND_API.G_EXC_UNEXPECTED_ERROR;
END merge_changes;

-----------------------------------------------------------------------
--Start of Comments
--Name: lock_draft_record
--Function:
--  Obtain database lock for the record in draft table
--Parameters:
--IN:
--p_attribute_values_id
--  id for po attribute values record
--p_draft_id
--  draft unique identifier
--RETURN:
--End of Comments
------------------------------------------------------------------------
PROCEDURE lock_draft_record
( p_attribute_values_id IN NUMBER,
  p_draft_id        IN NUMBER
) IS

d_api_name CONSTANT VARCHAR2(30) := 'lock_draft_record';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

l_dummy NUMBER;

BEGIN
  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
  END IF;

  SELECT 1
  INTO l_dummy
  FROM po_attribute_values_draft
  WHERE attribute_values_id = p_attribute_values_id
  AND draft_id = p_draft_id
  FOR UPDATE NOWAIT;

  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_end(d_module);
  END IF;

EXCEPTION
WHEN NO_DATA_FOUND THEN
  NULL;
END lock_draft_record;

-----------------------------------------------------------------------
--Start of Comments
--Name: lock_transaction_record
--Function:
--  Obtain database lock for the record in transaction table
--Parameters:
--IN:
--p_attribute_values_id
--  id for attribute values record
--RETURN:
--End of Comments
------------------------------------------------------------------------
PROCEDURE lock_transaction_record
( p_attribute_values_id IN NUMBER
) IS

d_api_name CONSTANT VARCHAR2(30) := 'lock_transaction_record';
d_module CONSTANT VARCHAR2(2000) := d_pkg_name || d_api_name || '.';
d_position NUMBER;

l_dummy NUMBER;

BEGIN
  d_position := 0;
  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_begin(d_module);
  END IF;

  SELECT 1
  INTO l_dummy
  FROM po_attribute_values
  WHERE attribute_values_id = p_attribute_values_id
  FOR UPDATE NOWAIT;

  IF (PO_LOG.d_proc) THEN
    PO_LOG.proc_end(d_module);
  END IF;

EXCEPTION
WHEN NO_DATA_FOUND THEN
  NULL;
END lock_transaction_record;

END PO_ATTR_VALUES_DRAFT_PKG;

/
