--------------------------------------------------------
--  DDL for Package Body BIM_LEADS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."BIM_LEADS_PKG" AS
/* $Header: bimleadb.pls 115.4 2000/02/29 20:18:59 pkm ship  $ */

FUNCTION ORDERS_GENERATED(p_lead_id NUMBER) RETURN NUMBER AS
	LN_ORDERS_GENERATED PLS_INTEGER;
BEGIN

	SELECT COUNT(*) INTO LN_ORDERS_GENERATED
	FROM
	(
	SELECT ASO2.OBJECT_ID
	FROM
			ASO_QUOTE_RELATED_OBJECTS ASO1,
			ASO_QUOTE_RELATED_OBJECTS ASO2
	WHERE
			ASO1.OBJECT_TYPE_CODE = 'LEAD' AND
			ASO1.OBJECT_ID = p_lead_id AND
			ASO1.RELATIONSHIP_TYPE_CODE = 'LEAD_QUOTE' AND
			ASO1.QUOTE_OBJECT_ID = ASO2.QUOTE_OBJECT_ID AND
			ASO1.QUOTE_OBJECT_TYPE_CODE = ASO2.QUOTE_OBJECT_TYPE_CODE AND
			ASO2.RELATIONSHIP_TYPE_CODE = 'QUOTE_ORDER'
	UNION
	SELECT ASO2.OBJECT_ID
	FROM
			AS_SALES_LEAD_OPPORTUNITY ASLO,
			ASO_QUOTE_RELATED_OBJECTS ASO1,
			ASO_QUOTE_RELATED_OBJECTS ASO2
	WHERE
			ASLO.SALES_LEAD_ID = p_lead_id AND
			ASLO.OPPORTUNITY_ID = ASO1.OBJECT_ID AND
			ASO1.OBJECT_TYPE_CODE = 'OPPORTUNITY' AND
			ASO1.RELATIONSHIP_TYPE_CODE = 'OPP_QUOTE' AND
			ASO1.QUOTE_OBJECT_ID = ASO2.QUOTE_OBJECT_ID AND
			ASO1.QUOTE_OBJECT_TYPE_CODE = ASO2.QUOTE_OBJECT_TYPE_CODE AND
			ASO2.RELATIONSHIP_TYPE_CODE = 'QUOTE_ORDER'
	);

	RETURN LN_ORDERS_GENERATED;


END ORDERS_GENERATED;

END BIM_LEADS_PKG;

/
