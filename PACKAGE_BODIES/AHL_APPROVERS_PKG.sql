--------------------------------------------------------
--  DDL for Package Body AHL_APPROVERS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."AHL_APPROVERS_PKG" as
/*$Header: AHLLAPPB.pls 115.6 2002/12/04 01:21:55 ssurapan noship $*/

procedure INSERT_ROW
(
  X_ROWID in out NOCOPY VARCHAR2,
  X_APPROVAL_APPROVER_ID in NUMBER,
  X_OBJECT_VERSION_NUMBER in NUMBER,
  X_APPROVAL_RULE_ID in NUMBER,
  X_APPROVER_TYPE_CODE in VARCHAR2,
  X_APPROVER_SEQUENCE in NUMBER,
  X_APPROVER_ID in NUMBER,
  --X_ACTIVE_START_DATE IN DATE,
  --X_ACTIVE_END_DATE IN DATE,
  X_LAST_UPDATE_DATE IN DATE,
  X_LAST_UPDATED_BY IN NUMBER,
  X_CREATION_DATE IN DATE,
  X_CREATED_BY IN NUMBER,
  X_LAST_UPDATE_LOGIN IN NUMBER,
  X_ATTRIBUTE_CATEGORY IN VARCHAR2,
  X_ATTRIBUTE1 IN VARCHAR2,
  X_ATTRIBUTE2 IN VARCHAR2,
  X_ATTRIBUTE3 IN VARCHAR2,
  X_ATTRIBUTE4 IN VARCHAR2,
  X_ATTRIBUTE5 IN VARCHAR2,
  X_ATTRIBUTE6 IN VARCHAR2,
  X_ATTRIBUTE7 IN VARCHAR2,
  X_ATTRIBUTE8 IN VARCHAR2,
  X_ATTRIBUTE9 IN VARCHAR2,
  X_ATTRIBUTE10 IN VARCHAR2,
  X_ATTRIBUTE11 IN VARCHAR2,
  X_ATTRIBUTE12 IN VARCHAR2,
  X_ATTRIBUTE13 IN VARCHAR2,
  X_ATTRIBUTE14 IN VARCHAR2,
  X_ATTRIBUTE15 IN VARCHAR2
)
is
cursor C is select ROWID from AHL_APPROVERS where
            APPROVAL_APPROVER_ID = X_APPROVAL_APPROVER_ID;
begin
insert into AHL_APPROVERS
(
  APPROVAL_APPROVER_ID,
  OBJECT_VERSION_NUMBER,
  APPROVAL_RULE_ID,
  APPROVER_TYPE_CODE,
  APPROVER_SEQUENCE,
  APPROVER_ID,
  --ACTIVE_START_DATE,
  --ACTIVE_END_DATE,
  LAST_UPDATE_DATE,
  LAST_UPDATED_BY,
  CREATION_DATE,
  CREATED_BY,
  LAST_UPDATE_LOGIN,
  ATTRIBUTE_CATEGORY,
  ATTRIBUTE1,
  ATTRIBUTE2,
  ATTRIBUTE3,
  ATTRIBUTE4,
  ATTRIBUTE5,
  ATTRIBUTE6,
  ATTRIBUTE7,
  ATTRIBUTE8,
  ATTRIBUTE9,
  ATTRIBUTE10,
  ATTRIBUTE11,
  ATTRIBUTE12,
  ATTRIBUTE13,
  ATTRIBUTE14,
  ATTRIBUTE15
  )
 values
(
  X_APPROVAL_APPROVER_ID,
  X_OBJECT_VERSION_NUMBER,
  X_APPROVAL_RULE_ID,
  X_APPROVER_TYPE_CODE,
  X_APPROVER_SEQUENCE,
  X_APPROVER_ID,
  --X_ACTIVE_START_DATE,
  --X_ACTIVE_END_DATE,
  X_LAST_UPDATE_DATE,
  X_LAST_UPDATED_BY,
  X_CREATION_DATE,
  X_CREATED_BY,
  X_LAST_UPDATE_LOGIN,
  X_ATTRIBUTE_CATEGORY,
  X_ATTRIBUTE1,
  X_ATTRIBUTE2,
  X_ATTRIBUTE3,
  X_ATTRIBUTE4,
  X_ATTRIBUTE5,
  X_ATTRIBUTE6,
  X_ATTRIBUTE7,
  X_ATTRIBUTE8,
  X_ATTRIBUTE9,
  X_ATTRIBUTE10,
  X_ATTRIBUTE11,
  X_ATTRIBUTE12,
  X_ATTRIBUTE13,
  X_ATTRIBUTE14,
  X_ATTRIBUTE15
  );

 open c;
 fetch c into X_ROWID;
 if (c%notfound) then
    close c;
 end if;
 close c;
end INSERT_ROW;

procedure UPDATE_ROW
(
  X_APPROVAL_APPROVER_ID in NUMBER,
  X_OBJECT_VERSION_NUMBER in NUMBER,
  X_APPROVAL_RULE_ID in NUMBER,
  X_APPROVER_TYPE_CODE in VARCHAR2,
  X_APPROVER_SEQUENCE in NUMBER,
  X_APPROVER_ID in NUMBER,
  --X_ACTIVE_START_DATE IN DATE,
  --X_ACTIVE_END_DATE IN DATE,
  X_LAST_UPDATE_DATE IN DATE,
  X_LAST_UPDATED_BY IN NUMBER,
  X_LAST_UPDATE_LOGIN IN NUMBER,
  X_ATTRIBUTE_CATEGORY IN VARCHAR2,
  X_ATTRIBUTE1 IN VARCHAR2,
  X_ATTRIBUTE2 IN VARCHAR2,
  X_ATTRIBUTE3 IN VARCHAR2,
  X_ATTRIBUTE4 IN VARCHAR2,
  X_ATTRIBUTE5 IN VARCHAR2,
  X_ATTRIBUTE6 IN VARCHAR2,
  X_ATTRIBUTE7 IN VARCHAR2,
  X_ATTRIBUTE8 IN VARCHAR2,
  X_ATTRIBUTE9 IN VARCHAR2,
  X_ATTRIBUTE10 IN VARCHAR2,
  X_ATTRIBUTE11 IN VARCHAR2,
  X_ATTRIBUTE12 IN VARCHAR2,
  X_ATTRIBUTE13 IN VARCHAR2,
  X_ATTRIBUTE14 IN VARCHAR2,
  X_ATTRIBUTE15 IN VARCHAR2
  ) is
begin
  update AHL_APPROVERS set
  OBJECT_VERSION_NUMBER =  X_OBJECT_VERSION_NUMBER,
  APPROVAL_RULE_ID =  X_APPROVAL_RULE_ID,
  APPROVER_TYPE_CODE =  X_APPROVER_TYPE_CODE,
  APPROVER_SEQUENCE = X_APPROVER_SEQUENCE,
  APPROVER_ID = X_APPROVER_ID,
  --ACTIVE_START_DATE =  X_ACTIVE_START_DATE,
  --ACTIVE_END_DATE =  X_ACTIVE_END_DATE,
  LAST_UPDATE_DATE =  X_LAST_UPDATE_DATE,
  LAST_UPDATED_BY =  X_LAST_UPDATED_BY,
  LAST_UPDATE_LOGIN =  X_LAST_UPDATE_LOGIN,
  ATTRIBUTE_CATEGORY =  X_ATTRIBUTE_CATEGORY,
  ATTRIBUTE1 =  X_ATTRIBUTE1,
  ATTRIBUTE2 =  X_ATTRIBUTE2,
  ATTRIBUTE3 =  X_ATTRIBUTE3,
  ATTRIBUTE4 =  X_ATTRIBUTE4,
  ATTRIBUTE5 =  X_ATTRIBUTE5,
  ATTRIBUTE6 =  X_ATTRIBUTE6,
  ATTRIBUTE7 =  X_ATTRIBUTE7,
  ATTRIBUTE8 =  X_ATTRIBUTE8,
  ATTRIBUTE9 =  X_ATTRIBUTE9,
  ATTRIBUTE10 =  X_ATTRIBUTE10,
  ATTRIBUTE11 =  X_ATTRIBUTE11,
  ATTRIBUTE12 =  X_ATTRIBUTE12,
  ATTRIBUTE13 =  X_ATTRIBUTE13,
  ATTRIBUTE14 =  X_ATTRIBUTE14,
  ATTRIBUTE15 =  X_ATTRIBUTE15
  where APPROVAL_APPROVER_ID = X_APPROVAL_APPROVER_ID;

if (sql%notfound) then
  raise no_data_found;
end if;

end UPDATE_ROW;

procedure DELETE_ROW
(
  X_APPROVAL_APPROVER_ID in NUMBER
)
is
begin
  delete from AHL_APPROVERS
  where APPROVAL_APPROVER_ID = X_APPROVAL_APPROVER_ID;

  if (sql%notfound) then
    raise no_data_found;
  end if;

end DELETE_ROW;


PROCEDURE LOAD_ROW (
  X_APPROVER_ID IN NUMBER,
  X_APPROVAL_RULE_ID IN NUMBER,
  X_APPROVAL_APPROVER_ID IN NUMBER,
  X_APPROVER_TYPE_CODE IN VARCHAR2,
  X_APPROVER_SEQUENCE IN VARCHAR2,
  X_OWNER       IN    VARCHAR2,
  X_ATTRIBUTE_CATEGORY IN VARCHAR2,
  X_ATTRIBUTE1 IN VARCHAR2,
  X_ATTRIBUTE2 IN VARCHAR2,
  X_ATTRIBUTE3 IN VARCHAR2,
  X_ATTRIBUTE4 IN VARCHAR2,
  X_ATTRIBUTE5 IN VARCHAR2,
  X_ATTRIBUTE6 IN VARCHAR2,
  X_ATTRIBUTE7 IN VARCHAR2,
  X_ATTRIBUTE8 IN VARCHAR2,
  X_ATTRIBUTE9 IN VARCHAR2,
  X_ATTRIBUTE10 IN VARCHAR2,
  X_ATTRIBUTE11 IN VARCHAR2,
  X_ATTRIBUTE12 IN VARCHAR2,
  X_ATTRIBUTE13 IN VARCHAR2,
  X_ATTRIBUTE14 IN VARCHAR2,
  X_ATTRIBUTE15 IN VARCHAR2
  )

IS
  l_user_id     NUMBER := 0;
  l_obj_verno   NUMBER;
  l_dummy_char  VARCHAR2(1);
  l_row_id      VARCHAR2(100);
  l_approval_approver_id      NUMBER;



CURSOR  c_obj_verno IS
  SELECT  object_version_number
  FROM    AHL_APPROVERS
  WHERE   approval_approver_id =  X_APPROVAL_APPROVER_ID;

CURSOR c_chk_approver_exists IS
  SELECT 'x'
  FROM   AHL_APPROVERS
  WHERE  approval_approver_id = X_APPROVAL_APPROVER_ID;

CURSOR c_get_approver_id IS
   SELECT ahl_approvers_s.NEXTVAL
   FROM dual;


BEGIN

  IF X_OWNER = 'SEED' THEN
     l_user_id := 1;
 END IF;

 OPEN c_chk_approver_exists;
 FETCH c_chk_approver_exists INTO l_dummy_char;
 IF c_chk_approver_exists%NOTFOUND
 THEN
    CLOSE c_chk_approver_exists;

    IF X_APPROVAL_APPROVER_ID IS NULL THEN
        OPEN c_get_approver_id;
        FETCH c_get_approver_id INTO l_approval_approver_id;
        CLOSE c_get_approver_id;
    ELSE
       l_approval_approver_id := X_APPROVAL_APPROVER_ID;
    END IF ;

    l_obj_verno := 1;

AHL_APPROVERS_PKG.INSERT_ROW (
  X_ROWID                       => l_row_id,
  X_APPROVER_ID 		=> X_APPROVER_ID,
  X_OBJECT_VERSION_NUMBER 	=> l_obj_verno,
  X_APPROVAL_RULE_ID 		=> X_APPROVAL_RULE_ID ,
  X_APPROVAL_APPROVER_ID 	=> l_approval_approver_id ,
  X_APPROVER_TYPE_CODE 		=> X_APPROVER_TYPE_CODE ,
  X_APPROVER_SEQUENCE 		=> X_APPROVER_SEQUENCE ,
  X_ATTRIBUTE_CATEGORY 		=> X_ATTRIBUTE_CATEGORY,
  X_ATTRIBUTE1			=>  X_ATTRIBUTE1,
  X_ATTRIBUTE2			=>  X_ATTRIBUTE2,
  X_ATTRIBUTE3			=>  X_ATTRIBUTE3,
  X_ATTRIBUTE4			=>  X_ATTRIBUTE4,
  X_ATTRIBUTE5			=>  X_ATTRIBUTE5,
  X_ATTRIBUTE6			=>  X_ATTRIBUTE6,
  X_ATTRIBUTE7			=>  X_ATTRIBUTE7,
  X_ATTRIBUTE8			=>  X_ATTRIBUTE8,
  X_ATTRIBUTE9			=>  X_ATTRIBUTE9,
  X_ATTRIBUTE10			=>  X_ATTRIBUTE10,
  X_ATTRIBUTE11			=>  X_ATTRIBUTE11,
  X_ATTRIBUTE12			=>  X_ATTRIBUTE12,
  X_ATTRIBUTE13			=>  X_ATTRIBUTE13,
  X_ATTRIBUTE14			=>  X_ATTRIBUTE14,
  X_ATTRIBUTE15			=>  X_ATTRIBUTE15,
  X_CREATION_DATE 		=> SYSDATE,
  X_CREATED_BY                  => l_user_id,
  X_LAST_UPDATE_DATE            => SYSDATE,
  X_LAST_UPDATED_BY             => l_user_id,
  X_LAST_UPDATE_LOGIN           => 0

);


ELSE
   CLOSE c_chk_approver_exists;
   OPEN c_obj_verno;
   FETCH c_obj_verno INTO l_obj_verno;
   CLOSE c_obj_verno;




AHL_APPROVERS_PKG.UPDATE_ROW (
  X_APPROVER_ID 		=> X_APPROVER_ID,
  X_OBJECT_VERSION_NUMBER 	=> l_obj_verno + 1,
  X_APPROVAL_RULE_ID 		=> X_APPROVAL_RULE_ID ,
  X_APPROVAL_APPROVER_ID 	=> X_APPROVAL_APPROVER_ID ,
  X_APPROVER_TYPE_CODE 		=> X_APPROVER_TYPE_CODE ,
  X_APPROVER_SEQUENCE 		=> X_APPROVER_SEQUENCE ,
  X_ATTRIBUTE_CATEGORY 		=> X_ATTRIBUTE_CATEGORY,
  X_ATTRIBUTE1			=>  X_ATTRIBUTE1,
  X_ATTRIBUTE2			=>  X_ATTRIBUTE2,
  X_ATTRIBUTE3			=>  X_ATTRIBUTE3,
  X_ATTRIBUTE4			=>  X_ATTRIBUTE4,
  X_ATTRIBUTE5			=>  X_ATTRIBUTE5,
  X_ATTRIBUTE6			=>  X_ATTRIBUTE6,
  X_ATTRIBUTE7			=>  X_ATTRIBUTE7,
  X_ATTRIBUTE8			=>  X_ATTRIBUTE8,
  X_ATTRIBUTE9			=>  X_ATTRIBUTE9,
  X_ATTRIBUTE10			=>  X_ATTRIBUTE10,
  X_ATTRIBUTE11			=>  X_ATTRIBUTE11,
  X_ATTRIBUTE12			=>  X_ATTRIBUTE12,
  X_ATTRIBUTE13			=>  X_ATTRIBUTE13,
  X_ATTRIBUTE14			=>  X_ATTRIBUTE14,
  X_ATTRIBUTE15			=>  X_ATTRIBUTE15,
  X_LAST_UPDATE_DATE            => SYSDATE,
  X_LAST_UPDATED_BY             => l_user_id,
  X_LAST_UPDATE_LOGIN           => 0

);



END IF;

END LOAD_ROW ;


end AHL_APPROVERS_PKG;

/
