--------------------------------------------------------
--  DDL for Package Body GMS_AWARDS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."GMS_AWARDS_PKG" as
/* $Header: gmsawawb.pls 120.2.12010000.2 2008/10/30 09:09:17 rrambati ship $ */
procedure INSERT_ROW (
  X_ROWID in out NOCOPY VARCHAR2,
  X_AWARD_ID in NUMBER,
  X_AWARD_NUMBER in VARCHAR2,
  X_AWARD_SHORT_NAME in VARCHAR2,
  X_AWARD_FULL_NAME in VARCHAR2,
  X_FUNDING_SOURCE_ID in NUMBER,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_CLOSE_DATE in DATE,
  X_FUNDING_SOURCE_AWARD_NUMBER in VARCHAR2,
  X_AWARD_PURPOSE_CODE in VARCHAR2,
  X_STATUS in VARCHAR2,
  X_ALLOWABLE_SCHEDULE_ID in NUMBER,
  X_IDC_SCHEDULE_ID in NUMBER,
  X_REVENUE_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FREQUENCY in VARCHAR2,
  X_BILLING_CYCLE_ID  IN NUMBER,
  X_BILLING_OFFSET    IN NUMBER,
  X_BILLING_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FORMAT in VARCHAR2,
  X_BILLING_TERM in NUMBER,
  X_AWARD_PROJECT_ID in NUMBER,
  X_AGREEMENT_ID in NUMBER,
  X_AWARD_TEMPLATE_FLAG in VARCHAR2,
  X_PREAWARD_DATE in DATE,
  X_AGENCY_SPECIFIC_FORM in VARCHAR2,
  X_BILL_TO_CUSTOMER_ID in NUMBER,
  X_TRANSACTION_NUMBER in VARCHAR2,
  X_AMOUNT_TYPE in VARCHAR2,
  X_BOUNDARY_CODE in VARCHAR2,
  X_FUND_CONTROL_LEVEL_AWARD in VARCHAR2,
  X_FUND_CONTROL_LEVEL_TASK in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES_GRP in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES in VARCHAR2,
  X_ATTRIBUTE_CATEGORY in VARCHAR2,
  X_ATTRIBUTE1 in VARCHAR2,
  X_ATTRIBUTE2 in VARCHAR2,
  X_ATTRIBUTE3 in VARCHAR2,
  X_ATTRIBUTE4 in VARCHAR2,
  X_ATTRIBUTE5 in VARCHAR2,
  X_ATTRIBUTE6 in VARCHAR2,
  X_ATTRIBUTE7 in VARCHAR2,
  X_ATTRIBUTE8 in VARCHAR2,
  X_ATTRIBUTE9 in VARCHAR2,
  X_ATTRIBUTE10 in VARCHAR2,
  X_ATTRIBUTE11 in VARCHAR2,
  X_ATTRIBUTE12 in VARCHAR2,
  X_ATTRIBUTE13 in VARCHAR2,
  X_ATTRIBUTE14 in VARCHAR2,
  X_ATTRIBUTE15 in VARCHAR2,
  X_ATTRIBUTE16 in VARCHAR2,
  X_ATTRIBUTE17 in VARCHAR2,
  X_ATTRIBUTE18 in VARCHAR2,
  X_ATTRIBUTE19 in VARCHAR2,
  X_ATTRIBUTE20 in VARCHAR2,
  X_ATTRIBUTE21 in VARCHAR2,
  X_ATTRIBUTE22 in VARCHAR2,
  X_ATTRIBUTE23 in VARCHAR2,
  X_ATTRIBUTE24 in VARCHAR2,
  X_ATTRIBUTE25 in VARCHAR2,
  X_TEMPLATE_START_DATE_ACTIVE in DATE,
  X_TEMPLATE_END_DATE_ACTIVE in DATE,
  X_ORG_ID in NUMBER, /* award_organization_id is created as org_id is now used due to multi- org */
  X_TYPE in VARCHAR2,
  X_COST_IND_SCH_FIXED_DATE in DATE,
  X_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_NON_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_MODE in VARCHAR2 default 'R',
  X_BILL_TO_ADDRESS_ID in NUMBER,
  X_SHIP_TO_ADDRESS_ID in NUMBER,
  X_LOC_BILL_TO_ADDRESS_ID in NUMBER,
  X_LOC_SHIP_TO_ADDRESS_ID in NUMBER,
  X_AWARD_ORGANIZATION_ID in NUMBER,
  X_HARD_LIMIT_FLAG in VARCHAR2 ,
  X_INVOICE_LIMIT_FLAG in VARCHAR2 , /*Bug 6642901 */
  X_PROPOSAL_ID IN NUMBER DEFAULT NULL,
  X_BUDGET_WF_ENABLED_FLAG in VARCHAR2
  ) is
    cursor C is select ROWID from GMS_AWARDS
      where AWARD_ID = X_AWARD_ID;
    X_LAST_UPDATE_DATE DATE;
    X_LAST_UPDATED_BY NUMBER;
    X_LAST_UPDATE_LOGIN NUMBER;

/* Adding the x_org_id for populating the org_id of multi-org*/

--    X_ORG_ID NUMBER := to_number(substrb(userenv('CLIENT_INFO'),1,10));
/* Commented above line as the single-org customers are having trouble as the returned value was not null and doesn't have any value i.e blank spaces?
*/
--      X_ORG_ID NUMBER := fnd_profile.value('ORG_ID');
begin
  X_LAST_UPDATE_DATE := SYSDATE;
  if(X_MODE = 'I') then
    X_LAST_UPDATED_BY := 1;
    X_LAST_UPDATE_LOGIN := 0;
  elsif (X_MODE = 'R') then
    X_LAST_UPDATED_BY := FND_GLOBAL.USER_ID;
    if X_LAST_UPDATED_BY is NULL then
      X_LAST_UPDATED_BY := -1;
    end if;
    X_LAST_UPDATE_LOGIN :=FND_GLOBAL.LOGIN_ID;
    if X_LAST_UPDATE_LOGIN is NULL then
      X_LAST_UPDATE_LOGIN := -1;
    end if;
  else
    FND_MESSAGE.SET_NAME( 'FND', 'SYSTEM-INVALID ARGS');
    app_exception.raise_exception;
  end if;
  insert into GMS_AWARDS (
    AWARD_ID,
    AWARD_NUMBER,
    AWARD_SHORT_NAME,
    AWARD_FULL_NAME,
    FUNDING_SOURCE_ID,
    START_DATE_ACTIVE,
    END_DATE_ACTIVE,
    CLOSE_DATE,
    FUNDING_SOURCE_AWARD_NUMBER,
    AWARD_PURPOSE_CODE,
    STATUS,
    ALLOWABLE_SCHEDULE_ID,
    IDC_SCHEDULE_ID,
    REVENUE_DISTRIBUTION_RULE,
    BILLING_FREQUENCY,
    BILLING_CYCLE_ID,
    BILLING_OFFSET,
    BILLING_DISTRIBUTION_RULE,
    BILLING_FORMAT,
    BILLING_TERM,
    AWARD_PROJECT_ID,
    AGREEMENT_ID,
    AWARD_TEMPLATE_FLAG,
    PREAWARD_DATE,
    AGENCY_SPECIFIC_FORM,
    BILL_TO_CUSTOMER_ID,
    TRANSACTION_NUMBER,
    AMOUNT_TYPE,
    BOUNDARY_CODE,
    FUND_CONTROL_LEVEL_AWARD,
    FUND_CONTROL_LEVEL_TASK,
    FUND_CONTROL_LEVEL_RES_GRP,
    FUND_CONTROL_LEVEL_RES,
    ATTRIBUTE_CATEGORY,
    ATTRIBUTE1,
    ATTRIBUTE2,
    ATTRIBUTE3,
    ATTRIBUTE4,
    ATTRIBUTE5,
    ATTRIBUTE6,
    ATTRIBUTE7,
    ATTRIBUTE8,
    ATTRIBUTE9,
    ATTRIBUTE10,
    ATTRIBUTE11,
    ATTRIBUTE12,
    ATTRIBUTE13,
    ATTRIBUTE14,
    ATTRIBUTE15,
    ATTRIBUTE16,
    ATTRIBUTE17,
    ATTRIBUTE18,
    ATTRIBUTE19,
    ATTRIBUTE20,
    ATTRIBUTE21,
    ATTRIBUTE22,
    ATTRIBUTE23,
    ATTRIBUTE24,
    ATTRIBUTE25,
    TEMPLATE_START_DATE_ACTIVE,
    TEMPLATE_END_DATE_ACTIVE,
    ORG_ID,
    TYPE,
    COST_IND_SCH_FIXED_DATE,
    LABOR_INVOICE_FORMAT_ID,
    NON_LABOR_INVOICE_FORMAT_ID,
    CREATION_DATE,
    CREATED_BY,
    LAST_UPDATE_DATE,
    LAST_UPDATED_BY,
    LAST_UPDATE_LOGIN,
    BILL_TO_ADDRESS_ID,
    SHIP_TO_ADDRESS_ID,
    LOC_BILL_TO_ADDRESS_ID,
    LOC_SHIP_TO_ADDRESS_ID,
    AWARD_ORGANIZATION_ID,
    HARD_LIMIT_FLAG ,
    INVOICE_LIMIT_FLAG , /*Bug 6642901 */
    PROPOSAL_ID ,
    BUDGET_WF_ENABLED_FLAG

  ) values (
    X_AWARD_ID,
    X_AWARD_NUMBER,
    X_AWARD_SHORT_NAME,
    X_AWARD_FULL_NAME,
    X_FUNDING_SOURCE_ID,
    X_START_DATE_ACTIVE,
    X_END_DATE_ACTIVE,
    X_CLOSE_DATE,
    X_FUNDING_SOURCE_AWARD_NUMBER,
    X_AWARD_PURPOSE_CODE,
    X_STATUS,
    X_ALLOWABLE_SCHEDULE_ID,
    X_IDC_SCHEDULE_ID,
    X_REVENUE_DISTRIBUTION_RULE,
    X_BILLING_FREQUENCY,
    X_BILLING_CYCLE_ID,
    X_BILLING_OFFSET,
    X_BILLING_DISTRIBUTION_RULE,
    X_BILLING_FORMAT,
    X_BILLING_TERM,
    X_AWARD_PROJECT_ID,
    X_AGREEMENT_ID,
    X_AWARD_TEMPLATE_FLAG,
    X_PREAWARD_DATE,
    X_AGENCY_SPECIFIC_FORM,
    X_BILL_TO_CUSTOMER_ID,
    X_TRANSACTION_NUMBER,
    X_AMOUNT_TYPE,
    X_BOUNDARY_CODE,
    X_FUND_CONTROL_LEVEL_AWARD,
    X_FUND_CONTROL_LEVEL_TASK,
    X_FUND_CONTROL_LEVEL_RES_GRP,
    X_FUND_CONTROL_LEVEL_RES,
    X_ATTRIBUTE_CATEGORY,
    X_ATTRIBUTE1,
    X_ATTRIBUTE2,
    X_ATTRIBUTE3,
    X_ATTRIBUTE4,
    X_ATTRIBUTE5,
    X_ATTRIBUTE6,
    X_ATTRIBUTE7,
    X_ATTRIBUTE8,
    X_ATTRIBUTE9,
    X_ATTRIBUTE10,
    X_ATTRIBUTE11,
    X_ATTRIBUTE12,
    X_ATTRIBUTE13,
    X_ATTRIBUTE14,
    X_ATTRIBUTE15,
    X_ATTRIBUTE16,
    X_ATTRIBUTE17,
    X_ATTRIBUTE18,
    X_ATTRIBUTE19,
    X_ATTRIBUTE20,
    X_ATTRIBUTE21,
    X_ATTRIBUTE22,
    X_ATTRIBUTE23,
    X_ATTRIBUTE24,
    X_ATTRIBUTE25,
    X_TEMPLATE_START_DATE_ACTIVE,
    X_TEMPLATE_END_DATE_ACTIVE,
    X_ORG_ID,
    X_TYPE,
    X_COST_IND_SCH_FIXED_DATE,
    X_LABOR_INVOICE_FORMAT_ID,
    X_NON_LABOR_INVOICE_FORMAT_ID,
    X_LAST_UPDATE_DATE,
    X_LAST_UPDATED_BY,
    X_LAST_UPDATE_DATE,
    X_LAST_UPDATED_BY,
    X_LAST_UPDATE_LOGIN,
    X_BILL_TO_ADDRESS_ID,
    X_SHIP_TO_ADDRESS_ID,
    X_LOC_BILL_TO_ADDRESS_ID,
    X_LOC_SHIP_TO_ADDRESS_ID,
    X_AWARD_ORGANIZATION_ID,
    X_HARD_LIMIT_FLAG ,
    X_INVOICE_LIMIT_FLAG , /*Bug 6642901 */
    X_PROPOSAL_ID,
   X_BUDGET_WF_ENABLED_FLAG
  );

  open c;
  fetch c into X_ROWID;
  if (c%notfound) then
    close c;
    raise no_data_found;
  end if;
  close c;

end INSERT_ROW;

procedure LOCK_ROW (
  X_AWARD_ID in NUMBER,
  X_AWARD_NUMBER in VARCHAR2,
  X_AWARD_SHORT_NAME in VARCHAR2,
  X_AWARD_FULL_NAME in VARCHAR2,
  X_FUNDING_SOURCE_ID in NUMBER,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_CLOSE_DATE in DATE,
  X_FUNDING_SOURCE_AWARD_NUMBER in VARCHAR2,
  X_AWARD_PURPOSE_CODE in VARCHAR2,
  X_STATUS in VARCHAR2,
  X_ALLOWABLE_SCHEDULE_ID in NUMBER,
  X_IDC_SCHEDULE_ID in NUMBER,
  X_REVENUE_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FREQUENCY in VARCHAR2,
  X_BILLING_CYCLE_ID  IN NUMBER,
  X_BILLING_OFFSET    IN NUMBER,
  X_BILLING_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FORMAT in VARCHAR2,
  X_BILLING_TERM in NUMBER,
  X_AWARD_PROJECT_ID in NUMBER,
  X_AGREEMENT_ID in NUMBER,
  X_AWARD_TEMPLATE_FLAG in VARCHAR2,
  X_PREAWARD_DATE in DATE,
  X_AGENCY_SPECIFIC_FORM in VARCHAR2,
  X_BILL_TO_CUSTOMER_ID in NUMBER,
  X_TRANSACTION_NUMBER in VARCHAR2,
  X_AMOUNT_TYPE in VARCHAR2,
  X_BOUNDARY_CODE in VARCHAR2,
  X_FUND_CONTROL_LEVEL_AWARD in VARCHAR2,
  X_FUND_CONTROL_LEVEL_TASK in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES_GRP in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES in VARCHAR2,
  X_ATTRIBUTE_CATEGORY in VARCHAR2,
  X_ATTRIBUTE1 in VARCHAR2,
  X_ATTRIBUTE2 in VARCHAR2,
  X_ATTRIBUTE3 in VARCHAR2,
  X_ATTRIBUTE4 in VARCHAR2,
  X_ATTRIBUTE5 in VARCHAR2,
  X_ATTRIBUTE6 in VARCHAR2,
  X_ATTRIBUTE7 in VARCHAR2,
  X_ATTRIBUTE8 in VARCHAR2,
  X_ATTRIBUTE9 in VARCHAR2,
  X_ATTRIBUTE10 in VARCHAR2,
  X_ATTRIBUTE11 in VARCHAR2,
  X_ATTRIBUTE12 in VARCHAR2,
  X_ATTRIBUTE13 in VARCHAR2,
  X_ATTRIBUTE14 in VARCHAR2,
  X_ATTRIBUTE15 in VARCHAR2,
  X_ATTRIBUTE16 in VARCHAR2,
  X_ATTRIBUTE17 in VARCHAR2,
  X_ATTRIBUTE18 in VARCHAR2,
  X_ATTRIBUTE19 in VARCHAR2,
  X_ATTRIBUTE20 in VARCHAR2,
  X_ATTRIBUTE21 in VARCHAR2,
  X_ATTRIBUTE22 in VARCHAR2,
  X_ATTRIBUTE23 in VARCHAR2,
  X_ATTRIBUTE24 in VARCHAR2,
  X_ATTRIBUTE25 in VARCHAR2,
  X_TEMPLATE_START_DATE_ACTIVE in DATE,
  X_TEMPLATE_END_DATE_ACTIVE in DATE,
  X_ORG_ID in NUMBER,
  X_TYPE in VARCHAR2,
  X_COST_IND_SCH_FIXED_DATE in DATE,
  X_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_NON_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_BILL_TO_ADDRESS_ID in NUMBER,
  X_SHIP_TO_ADDRESS_ID in NUMBER,
  X_LOC_BILL_TO_ADDRESS_ID in NUMBER,
  X_LOC_SHIP_TO_ADDRESS_ID in NUMBER,
  X_AWARD_ORGANIZATION_ID in NUMBER,
  X_HARD_LIMIT_FLAG in VARCHAR2,
  X_INVOICE_LIMIT_FLAG in VARCHAR2 /*Bug 6642901 */
) is
  cursor c1 is select
      AWARD_NUMBER,
      AWARD_SHORT_NAME,
      AWARD_FULL_NAME,
      FUNDING_SOURCE_ID,
      START_DATE_ACTIVE,
      END_DATE_ACTIVE,
      CLOSE_DATE,
      FUNDING_SOURCE_AWARD_NUMBER,
      AWARD_PURPOSE_CODE,
      STATUS,
      ALLOWABLE_SCHEDULE_ID,
      IDC_SCHEDULE_ID,
      REVENUE_DISTRIBUTION_RULE,
      BILLING_FREQUENCY,
      BILLING_CYCLE_ID,
      BILLING_OFFSET,
      BILLING_DISTRIBUTION_RULE,
      BILLING_FORMAT,
      BILLING_TERM,
      AWARD_PROJECT_ID,
      AGREEMENT_ID,
      AWARD_TEMPLATE_FLAG,
      PREAWARD_DATE,
      AGENCY_SPECIFIC_FORM,
      BILL_TO_CUSTOMER_ID,
      TRANSACTION_NUMBER,
      AMOUNT_TYPE,
      BOUNDARY_CODE,
      FUND_CONTROL_LEVEL_AWARD,
      FUND_CONTROL_LEVEL_TASK,
      FUND_CONTROL_LEVEL_RES_GRP,
      FUND_CONTROL_LEVEL_RES,
      ATTRIBUTE_CATEGORY,
      ATTRIBUTE1,
      ATTRIBUTE2,
      ATTRIBUTE3,
      ATTRIBUTE4,
      ATTRIBUTE5,
      ATTRIBUTE6,
      ATTRIBUTE7,
      ATTRIBUTE8,
      ATTRIBUTE9,
      ATTRIBUTE10,
      ATTRIBUTE11,
      ATTRIBUTE12,
      ATTRIBUTE13,
      ATTRIBUTE14,
      ATTRIBUTE15,
      ATTRIBUTE16,
      ATTRIBUTE17,
      ATTRIBUTE18,
      ATTRIBUTE19,
      ATTRIBUTE20,
      ATTRIBUTE21,
      ATTRIBUTE22,
      ATTRIBUTE23,
      ATTRIBUTE24,
      ATTRIBUTE25,
      TEMPLATE_START_DATE_ACTIVE,
      TEMPLATE_END_DATE_ACTIVE,
      ORG_ID,
      TYPE,
      COST_IND_SCH_FIXED_DATE,
      LABOR_INVOICE_FORMAT_ID,
      NON_LABOR_INVOICE_FORMAT_ID,
      BILL_TO_ADDRESS_ID,
      SHIP_TO_ADDRESS_ID,
      lOC_BILL_TO_ADDRESS_ID,
      LOC_SHIP_TO_ADDRESS_ID,
      AWARD_ORGANIZATION_ID,
      HARD_LIMIT_FLAG,
      INVOICE_LIMIT_FLAG /*Bug6642901 */
    from GMS_AWARDS
    where AWARD_ID = X_AWARD_ID
    for update of AWARD_ID nowait;
  tlinfo c1%rowtype;

begin
  open c1;
  fetch c1 into tlinfo;
  if (c1%notfound) then
    fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
    app_exception.raise_exception;
    close c1;
    return;
  end if;
  close c1;

  if ( (tlinfo.AWARD_NUMBER = X_AWARD_NUMBER)
      AND (tlinfo.AWARD_SHORT_NAME = X_AWARD_SHORT_NAME)
      AND ((tlinfo.AWARD_FULL_NAME = X_AWARD_FULL_NAME)
           OR ((tlinfo.AWARD_FULL_NAME is null)
               AND (X_AWARD_FULL_NAME is null)))
      AND ((tlinfo.FUNDING_SOURCE_ID = X_FUNDING_SOURCE_ID)
           OR ((tlinfo.FUNDING_SOURCE_ID is null)
               AND (X_FUNDING_SOURCE_ID is null)))
      AND ((tlinfo.START_DATE_ACTIVE = X_START_DATE_ACTIVE)
           OR ((tlinfo.START_DATE_ACTIVE is null)
               AND (X_START_DATE_ACTIVE is null)))
      AND ((tlinfo.END_DATE_ACTIVE = X_END_DATE_ACTIVE)
           OR ((tlinfo.END_DATE_ACTIVE is null)
               AND (X_END_DATE_ACTIVE is null)))
      AND ((tlinfo.CLOSE_DATE = X_CLOSE_DATE)
           OR ((tlinfo.CLOSE_DATE is null)
               AND (X_CLOSE_DATE is null)))
      AND ((tlinfo.FUNDING_SOURCE_AWARD_NUMBER = X_FUNDING_SOURCE_AWARD_NUMBER)
           OR ((tlinfo.FUNDING_SOURCE_AWARD_NUMBER is null)
               AND (X_FUNDING_SOURCE_AWARD_NUMBER is null)))
      AND ((tlinfo.AWARD_PURPOSE_CODE = X_AWARD_PURPOSE_CODE)
           OR ((tlinfo.AWARD_PURPOSE_CODE is null)
               AND (X_AWARD_PURPOSE_CODE is null)))
      AND ((tlinfo.STATUS = X_STATUS)
           OR ((tlinfo.STATUS is null)
               AND (X_STATUS is null)))
      AND ((tlinfo.ALLOWABLE_SCHEDULE_ID = X_ALLOWABLE_SCHEDULE_ID)
           OR ((tlinfo.ALLOWABLE_SCHEDULE_ID is null)
               AND (X_ALLOWABLE_SCHEDULE_ID is null)))
      AND ((tlinfo.IDC_SCHEDULE_ID = X_IDC_SCHEDULE_ID)
           OR ((tlinfo.IDC_SCHEDULE_ID is null)
               AND (X_IDC_SCHEDULE_ID is null)))
      AND ((tlinfo.REVENUE_DISTRIBUTION_RULE = X_REVENUE_DISTRIBUTION_RULE)
           OR ((tlinfo.REVENUE_DISTRIBUTION_RULE is null)
               AND (X_REVENUE_DISTRIBUTION_RULE is null)))
--    AND ((tlinfo.BILLING_FREQUENCY = X_BILLING_FREQUENCY)
--         OR ((tlinfo.BILLING_FREQUENCY is null)
--             AND (X_BILLING_FREQUENCY is null)))
      AND ((tlinfo.BILLING_CYCLE_ID = X_BILLING_CYCLE_ID)
           OR ((tlinfo.BILLING_CYCLE_ID is null)
               AND (X_BILLING_CYCLE_ID is null)))
      AND ((tlinfo.BILLING_OFFSET = X_BILLING_OFFSET)
           OR ((tlinfo.BILLING_OFFSET is null)
               AND (X_BILLING_OFFSET is null)))
      AND ((tlinfo.BILLING_DISTRIBUTION_RULE = X_BILLING_DISTRIBUTION_RULE)
           OR ((tlinfo.BILLING_DISTRIBUTION_RULE is null)
               AND (X_BILLING_DISTRIBUTION_RULE is null)))
      AND ((tlinfo.BILLING_FORMAT = X_BILLING_FORMAT)
           OR ((tlinfo.BILLING_FORMAT is null)
               AND (X_BILLING_FORMAT is null)))
      AND ((tlinfo.BILLING_TERM = X_BILLING_TERM)
           OR ((tlinfo.BILLING_TERM is null)
               AND (X_BILLING_TERM is null)))
      AND ((tlinfo.AWARD_PROJECT_ID = X_AWARD_PROJECT_ID)
           OR ((tlinfo.AWARD_PROJECT_ID is null)
               AND (X_AWARD_PROJECT_ID is null)))
      AND ((tlinfo.AGREEMENT_ID = X_AGREEMENT_ID)
           OR ((tlinfo.AGREEMENT_ID is null)
               AND (X_AGREEMENT_ID is null)))
      AND ((tlinfo.AWARD_TEMPLATE_FLAG = X_AWARD_TEMPLATE_FLAG)
           OR ((tlinfo.AWARD_TEMPLATE_FLAG is null)
               AND (X_AWARD_TEMPLATE_FLAG is null)))
      AND ((tlinfo.PREAWARD_DATE = X_PREAWARD_DATE)
           OR ((tlinfo.PREAWARD_DATE is null)
               AND (X_PREAWARD_DATE is null)))
      AND ((tlinfo.AGENCY_SPECIFIC_FORM = X_AGENCY_SPECIFIC_FORM)
           OR ((tlinfo.AGENCY_SPECIFIC_FORM is null)
               AND (X_AGENCY_SPECIFIC_FORM is null)))
      AND ((tlinfo.BILL_TO_CUSTOMER_ID = X_BILL_TO_CUSTOMER_ID)
           OR ((tlinfo.BILL_TO_CUSTOMER_ID is null)
               AND (X_BILL_TO_CUSTOMER_ID is null)))
      AND ((tlinfo.TRANSACTION_NUMBER = X_TRANSACTION_NUMBER)
           OR ((tlinfo.TRANSACTION_NUMBER is null)
               AND (X_TRANSACTION_NUMBER is null)))
      AND ((tlinfo.AMOUNT_TYPE = X_AMOUNT_TYPE)
           OR ((tlinfo.AMOUNT_TYPE is null)
               AND (X_AMOUNT_TYPE is null)))
      AND ((tlinfo.BOUNDARY_CODE = X_BOUNDARY_CODE)
           OR ((tlinfo.BOUNDARY_CODE is null)
               AND (X_BOUNDARY_CODE is null)))
      AND ((tlinfo.FUND_CONTROL_LEVEL_AWARD = X_FUND_CONTROL_LEVEL_AWARD)
           OR ((tlinfo.FUND_CONTROL_LEVEL_AWARD is null)
               AND (X_FUND_CONTROL_LEVEL_AWARD is null)))
      AND ((tlinfo.FUND_CONTROL_LEVEL_TASK = X_FUND_CONTROL_LEVEL_TASK)
           OR ((tlinfo.FUND_CONTROL_LEVEL_TASK is null)
               AND (X_FUND_CONTROL_LEVEL_TASK is null)))
      AND ((tlinfo.FUND_CONTROL_LEVEL_RES_GRP = X_FUND_CONTROL_LEVEL_RES_GRP)
           OR ((tlinfo.FUND_CONTROL_LEVEL_RES_GRP is null)
               AND (X_FUND_CONTROL_LEVEL_RES_GRP is null)))
      AND ((tlinfo.FUND_CONTROL_LEVEL_RES = X_FUND_CONTROL_LEVEL_RES)
           OR ((tlinfo.FUND_CONTROL_LEVEL_RES is null)
               AND (X_FUND_CONTROL_LEVEL_RES is null)))
      AND ((tlinfo.ATTRIBUTE_CATEGORY = X_ATTRIBUTE_CATEGORY)
           OR ((tlinfo.ATTRIBUTE_CATEGORY is null)
               AND (X_ATTRIBUTE_CATEGORY is null)))
      AND ((tlinfo.ATTRIBUTE1 = X_ATTRIBUTE1)
           OR ((tlinfo.ATTRIBUTE1 is null)
               AND (X_ATTRIBUTE1 is null)))
      AND ((tlinfo.ATTRIBUTE2 = X_ATTRIBUTE2)
           OR ((tlinfo.ATTRIBUTE2 is null)
               AND (X_ATTRIBUTE2 is null)))
      AND ((tlinfo.ATTRIBUTE3 = X_ATTRIBUTE3)
           OR ((tlinfo.ATTRIBUTE3 is null)
               AND (X_ATTRIBUTE3 is null)))
      AND ((tlinfo.ATTRIBUTE4 = X_ATTRIBUTE4)
           OR ((tlinfo.ATTRIBUTE4 is null)
               AND (X_ATTRIBUTE4 is null)))
      AND ((tlinfo.ATTRIBUTE5 = X_ATTRIBUTE5)
           OR ((tlinfo.ATTRIBUTE5 is null)
               AND (X_ATTRIBUTE5 is null)))
      AND ((tlinfo.ATTRIBUTE6 = X_ATTRIBUTE6)
           OR ((tlinfo.ATTRIBUTE6 is null)
               AND (X_ATTRIBUTE6 is null)))
      AND ((tlinfo.ATTRIBUTE7 = X_ATTRIBUTE7)
           OR ((tlinfo.ATTRIBUTE7 is null)
               AND (X_ATTRIBUTE7 is null)))
      AND ((tlinfo.ATTRIBUTE8 = X_ATTRIBUTE8)
           OR ((tlinfo.ATTRIBUTE8 is null)
               AND (X_ATTRIBUTE8 is null)))
      AND ((tlinfo.ATTRIBUTE9 = X_ATTRIBUTE9)
           OR ((tlinfo.ATTRIBUTE9 is null)
               AND (X_ATTRIBUTE9 is null)))
      AND ((tlinfo.ATTRIBUTE10 = X_ATTRIBUTE10)
           OR ((tlinfo.ATTRIBUTE10 is null)
               AND (X_ATTRIBUTE10 is null)))
      AND ((tlinfo.ATTRIBUTE11 = X_ATTRIBUTE11)
           OR ((tlinfo.ATTRIBUTE11 is null)
               AND (X_ATTRIBUTE11 is null)))
      AND ((tlinfo.ATTRIBUTE12 = X_ATTRIBUTE12)
           OR ((tlinfo.ATTRIBUTE12 is null)
               AND (X_ATTRIBUTE12 is null)))
      AND ((tlinfo.ATTRIBUTE13 = X_ATTRIBUTE13)
           OR ((tlinfo.ATTRIBUTE13 is null)
               AND (X_ATTRIBUTE13 is null)))
      AND ((tlinfo.ATTRIBUTE14 = X_ATTRIBUTE14)
           OR ((tlinfo.ATTRIBUTE14 is null)
               AND (X_ATTRIBUTE14 is null)))
      AND ((tlinfo.ATTRIBUTE15 = X_ATTRIBUTE15)
           OR ((tlinfo.ATTRIBUTE15 is null)
               AND (X_ATTRIBUTE15 is null)))
    AND ((tlinfo.ATTRIBUTE16 = X_ATTRIBUTE16)
           OR ((tlinfo.ATTRIBUTE16 is null)
               AND (X_ATTRIBUTE16 is null)))
      AND ((tlinfo.ATTRIBUTE17 = X_ATTRIBUTE17)
           OR ((tlinfo.ATTRIBUTE17 is null)
               AND (X_ATTRIBUTE17 is null)))
      AND ((tlinfo.ATTRIBUTE18 = X_ATTRIBUTE18)
           OR ((tlinfo.ATTRIBUTE18 is null)
               AND (X_ATTRIBUTE18 is null)))
      AND ((tlinfo.ATTRIBUTE19 = X_ATTRIBUTE19)
           OR ((tlinfo.ATTRIBUTE19 is null)
               AND (X_ATTRIBUTE19 is null)))
      AND ((tlinfo.ATTRIBUTE20 = X_ATTRIBUTE20)
           OR ((tlinfo.ATTRIBUTE20 is null)
               AND (X_ATTRIBUTE20 is null)))
      AND ((tlinfo.ATTRIBUTE21 = X_ATTRIBUTE21)
           OR ((tlinfo.ATTRIBUTE21 is null)
               AND (X_ATTRIBUTE21 is null)))
      AND ((tlinfo.ATTRIBUTE22 = X_ATTRIBUTE22)
           OR ((tlinfo.ATTRIBUTE22 is null)
               AND (X_ATTRIBUTE22 is null)))
      AND ((tlinfo.ATTRIBUTE23 = X_ATTRIBUTE23)
           OR ((tlinfo.ATTRIBUTE23 is null)
               AND (X_ATTRIBUTE23 is null)))
      AND ((tlinfo.ATTRIBUTE24 = X_ATTRIBUTE24)
           OR ((tlinfo.ATTRIBUTE24 is null)
               AND (X_ATTRIBUTE24 is null)))
      AND ((tlinfo.ATTRIBUTE25 = X_ATTRIBUTE25)
           OR ((tlinfo.ATTRIBUTE25 is null)
               AND (X_ATTRIBUTE25 is null)))
      AND ((tlinfo.TEMPLATE_START_DATE_ACTIVE = X_TEMPLATE_START_DATE_ACTIVE)
           OR ((tlinfo.TEMPLATE_START_DATE_ACTIVE  is null)
               AND (X_TEMPLATE_START_DATE_ACTIVE is null)))
      AND ((tlinfo.TEMPLATE_END_DATE_ACTIVE = X_TEMPLATE_END_DATE_ACTIVE)
           OR ((tlinfo.TEMPLATE_END_DATE_ACTIVE  is null)
               AND (X_TEMPLATE_END_DATE_ACTIVE is null)))
      AND ((tlinfo.AWARD_ORGANIZATION_ID =   X_AWARD_ORGANIZATION_ID )
           OR ((tlinfo.AWARD_ORGANIZATION_ID is null)
               AND (  X_AWARD_ORGANIZATION_ID is null)))
      AND ((tlinfo.TYPE = X_TYPE)
           OR ((tlinfo.TYPE is null)
               AND (X_TYPE is null)))
      AND ((tlinfo.COST_IND_SCH_FIXED_DATE = X_COST_IND_SCH_FIXED_DATE)
           OR ((tlinfo.COST_IND_SCH_FIXED_DATE is null)
               AND (X_COST_IND_SCH_FIXED_DATE is null)))
      AND ((tlinfo.LABOR_INVOICE_FORMAT_ID = X_LABOR_INVOICE_FORMAT_ID)
           OR ((tlinfo.LABOR_INVOICE_FORMAT_ID is null)
               AND (X_LABOR_INVOICE_FORMAT_ID is null)))
      AND ((tlinfo.NON_LABOR_INVOICE_FORMAT_ID = X_NON_LABOR_INVOICE_FORMAT_ID)
           OR ((tlinfo.NON_LABOR_INVOICE_FORMAT_ID is null)
               AND (X_NON_LABOR_INVOICE_FORMAT_ID is null)))
      AND ((tlinfo.BILL_TO_ADDRESS_ID = X_BILL_TO_ADDRESS_ID)
           OR ((tlinfo.BILL_TO_ADDRESS_ID is null)
               AND (X_BILL_TO_ADDRESS_ID is null)))
      AND ((tlinfo.SHIP_TO_ADDRESS_ID = X_SHIP_TO_ADDRESS_ID)
           OR ((tlinfo.SHIP_TO_ADDRESS_ID is null)
               AND (X_SHIP_TO_ADDRESS_ID is null)))
      AND ((tlinfo.LOC_BILL_TO_ADDRESS_ID = X_LOC_BILL_TO_ADDRESS_ID)
           OR ((tlinfo.LOC_BILL_TO_ADDRESS_ID is null)
               AND (X_LOC_BILL_TO_ADDRESS_ID is null)))
      AND ((tlinfo.LOC_SHIP_TO_ADDRESS_ID = X_LOC_SHIP_TO_ADDRESS_ID)
           OR ((tlinfo.LOC_SHIP_TO_ADDRESS_ID is null)
               AND (X_LOC_SHIP_TO_ADDRESS_ID is null)))
      AND (tlinfo.ORG_ID = X_ORG_ID)
/*
   AND ((tlinfo.HARD_LIMIT_FLAG = X_HARD_LIMIT_FLAG
           OR ((tlinfo.HARD_LIMIT_FLAG is null)
             AND (X_HARD_LIMIT_FLAG is null)))
*/
  ) then
    null;
  else
    fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
    app_exception.raise_exception;
  end if;
  return;
end LOCK_ROW;

procedure UPDATE_ROW (
  X_AWARD_ID in NUMBER,
  X_AWARD_NUMBER in VARCHAR2,
  X_AWARD_SHORT_NAME in VARCHAR2,
  X_AWARD_FULL_NAME in VARCHAR2,
  X_FUNDING_SOURCE_ID in NUMBER,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_CLOSE_DATE in DATE,
  X_FUNDING_SOURCE_AWARD_NUMBER in VARCHAR2,
  X_AWARD_PURPOSE_CODE in VARCHAR2,
  X_STATUS in VARCHAR2,
  X_ALLOWABLE_SCHEDULE_ID in NUMBER,
  X_IDC_SCHEDULE_ID in NUMBER,
  X_REVENUE_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FREQUENCY in VARCHAR2,
  X_BILLING_CYCLE_ID  IN NUMBER,
  X_BILLING_OFFSET    IN NUMBER,
  X_BILLING_DISTRIBUTION_RULE in VARCHAR2,
  X_BILLING_FORMAT in VARCHAR2,
  X_BILLING_TERM in NUMBER,
  X_AWARD_PROJECT_ID in NUMBER,
  X_AGREEMENT_ID in NUMBER,
  X_AWARD_TEMPLATE_FLAG in VARCHAR2,
  X_PREAWARD_DATE in DATE,
  X_AGENCY_SPECIFIC_FORM in VARCHAR2,
  X_BILL_TO_CUSTOMER_ID in NUMBER,
  X_TRANSACTION_NUMBER in VARCHAR2,
  X_AMOUNT_TYPE in VARCHAR2,
  X_BOUNDARY_CODE in VARCHAR2,
  X_FUND_CONTROL_LEVEL_AWARD in VARCHAR2,
  X_FUND_CONTROL_LEVEL_TASK in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES_GRP in VARCHAR2,
  X_FUND_CONTROL_LEVEL_RES in VARCHAR2,
  X_ATTRIBUTE_CATEGORY in VARCHAR2,
  X_ATTRIBUTE1 in VARCHAR2,
  X_ATTRIBUTE2 in VARCHAR2,
  X_ATTRIBUTE3 in VARCHAR2,
  X_ATTRIBUTE4 in VARCHAR2,
  X_ATTRIBUTE5 in VARCHAR2,
  X_ATTRIBUTE6 in VARCHAR2,
  X_ATTRIBUTE7 in VARCHAR2,
  X_ATTRIBUTE8 in VARCHAR2,
  X_ATTRIBUTE9 in VARCHAR2,
  X_ATTRIBUTE10 in VARCHAR2,
  X_ATTRIBUTE11 in VARCHAR2,
  X_ATTRIBUTE12 in VARCHAR2,
  X_ATTRIBUTE13 in VARCHAR2,
  X_ATTRIBUTE14 in VARCHAR2,
  X_ATTRIBUTE15 in VARCHAR2,
 X_ATTRIBUTE16 in VARCHAR2,
  X_ATTRIBUTE17 in VARCHAR2,
  X_ATTRIBUTE18 in VARCHAR2,
  X_ATTRIBUTE19 in VARCHAR2,
  X_ATTRIBUTE20 in VARCHAR2,
  X_ATTRIBUTE21 in VARCHAR2,
  X_ATTRIBUTE22 in VARCHAR2,
  X_ATTRIBUTE23 in VARCHAR2,
  X_ATTRIBUTE24 in VARCHAR2,
  X_ATTRIBUTE25 in VARCHAR2,
  X_TEMPLATE_START_DATE_ACTIVE in DATE,
  X_TEMPLATE_END_DATE_ACTIVE in DATE,
 -- X_ORG_ID in NUMBER,
  X_TYPE in VARCHAR2,
  X_COST_IND_SCH_FIXED_DATE in DATE,
  X_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_NON_LABOR_INVOICE_FORMAT_ID in NUMBER,
  X_MODE in VARCHAR2 default 'R',
  X_BILL_TO_ADDRESS_ID in NUMBER,
  X_SHIP_TO_ADDRESS_ID in NUMBER,
  X_LOC_BILL_TO_ADDRESS_ID in NUMBER,
  X_LOC_SHIP_TO_ADDRESS_ID in NUMBER,
  X_AWARD_ORGANIZATION_ID in NUMBER,
  X_HARD_LIMIT_FLAG in VARCHAR2  ,
  X_INVOICE_LIMIT_FLAG in VARCHAR2 , /*Bug 6445688 */
  X_BUDGET_WF_ENABLED_FLAG in VARCHAR2
  ) is
    X_LAST_UPDATE_DATE DATE;
    X_LAST_UPDATED_BY NUMBER;
    X_LAST_UPDATE_LOGIN NUMBER;
begin
  X_LAST_UPDATE_DATE := SYSDATE;
  if(X_MODE = 'I') then
    X_LAST_UPDATED_BY := 1;
    X_LAST_UPDATE_LOGIN := 0;
  elsif (X_MODE = 'R') then
    X_LAST_UPDATED_BY := FND_GLOBAL.USER_ID;
    if X_LAST_UPDATED_BY is NULL then
      X_LAST_UPDATED_BY := -1;
    end if;
    X_LAST_UPDATE_LOGIN :=FND_GLOBAL.LOGIN_ID;
    if X_LAST_UPDATE_LOGIN is NULL then
      X_LAST_UPDATE_LOGIN := -1;
    end if;
  else
    FND_MESSAGE.SET_NAME('FND', 'SYSTEM-INVALID ARGS');
    app_exception.raise_exception;
  end if;
  update GMS_AWARDS set
    AWARD_NUMBER = X_AWARD_NUMBER,
    AWARD_SHORT_NAME = X_AWARD_SHORT_NAME,
    AWARD_FULL_NAME = X_AWARD_FULL_NAME,
    FUNDING_SOURCE_ID = X_FUNDING_SOURCE_ID,
    START_DATE_ACTIVE = X_START_DATE_ACTIVE,
    END_DATE_ACTIVE = X_END_DATE_ACTIVE,
    CLOSE_DATE = X_CLOSE_DATE,
    FUNDING_SOURCE_AWARD_NUMBER = X_FUNDING_SOURCE_AWARD_NUMBER,
    AWARD_PURPOSE_CODE = X_AWARD_PURPOSE_CODE,
    STATUS = X_STATUS,
    ALLOWABLE_SCHEDULE_ID = X_ALLOWABLE_SCHEDULE_ID,
    IDC_SCHEDULE_ID = X_IDC_SCHEDULE_ID,
    REVENUE_DISTRIBUTION_RULE = X_REVENUE_DISTRIBUTION_RULE,
    BILLING_FREQUENCY = X_BILLING_FREQUENCY,
    BILLING_CYCLE_ID  = X_BILLING_CYCLE_ID,
    BILLING_OFFSET    = X_BILLING_OFFSET,
    BILLING_DISTRIBUTION_RULE = X_BILLING_DISTRIBUTION_RULE,
    BILLING_FORMAT = X_BILLING_FORMAT,
    BILLING_TERM = X_BILLING_TERM,
    AWARD_PROJECT_ID = X_AWARD_PROJECT_ID,
    AGREEMENT_ID = X_AGREEMENT_ID,
    AWARD_TEMPLATE_FLAG = X_AWARD_TEMPLATE_FLAG,
    PREAWARD_DATE = X_PREAWARD_DATE,
    AGENCY_SPECIFIC_FORM = X_AGENCY_SPECIFIC_FORM,
    BILL_TO_CUSTOMER_ID = X_BILL_TO_CUSTOMER_ID,
    TRANSACTION_NUMBER = X_TRANSACTION_NUMBER,
    AMOUNT_TYPE = X_AMOUNT_TYPE,
    BOUNDARY_CODE = X_BOUNDARY_CODE,
    FUND_CONTROL_LEVEL_AWARD = X_FUND_CONTROL_LEVEL_AWARD,
    FUND_CONTROL_LEVEL_TASK = X_FUND_CONTROL_LEVEL_TASK,
    FUND_CONTROL_LEVEL_RES_GRP = X_FUND_CONTROL_LEVEL_RES_GRP,
    FUND_CONTROL_LEVEL_RES = X_FUND_CONTROL_LEVEL_RES,
    ATTRIBUTE_CATEGORY = X_ATTRIBUTE_CATEGORY,
    ATTRIBUTE1 = X_ATTRIBUTE1,
    ATTRIBUTE2 = X_ATTRIBUTE2,
    ATTRIBUTE3 = X_ATTRIBUTE3,
    ATTRIBUTE4 = X_ATTRIBUTE4,
    ATTRIBUTE5 = X_ATTRIBUTE5,
    ATTRIBUTE6 = X_ATTRIBUTE6,
    ATTRIBUTE7 = X_ATTRIBUTE7,
    ATTRIBUTE8 = X_ATTRIBUTE8,
    ATTRIBUTE9 = X_ATTRIBUTE9,
    ATTRIBUTE10 = X_ATTRIBUTE10,
    ATTRIBUTE11 = X_ATTRIBUTE11,
    ATTRIBUTE12 = X_ATTRIBUTE12,
    ATTRIBUTE13 = X_ATTRIBUTE13,
    ATTRIBUTE14 = X_ATTRIBUTE14,
    ATTRIBUTE15 = X_ATTRIBUTE15,
   ATTRIBUTE16 = X_ATTRIBUTE16,
    ATTRIBUTE17 = X_ATTRIBUTE17,
    ATTRIBUTE18 = X_ATTRIBUTE18,
    ATTRIBUTE19 = X_ATTRIBUTE19,
    ATTRIBUTE20 = X_ATTRIBUTE20,
    ATTRIBUTE21 = X_ATTRIBUTE21,
    ATTRIBUTE22 = X_ATTRIBUTE22,
    ATTRIBUTE23 = X_ATTRIBUTE23,
    ATTRIBUTE24 = X_ATTRIBUTE24,
    ATTRIBUTE25 = X_ATTRIBUTE25,
    TEMPLATE_START_DATE_ACTIVE = X_TEMPLATE_START_DATE_ACTIVE,
    TEMPLATE_END_DATE_ACTIVE   = X_TEMPLATE_END_DATE_ACTIVE,
   -- ORG_ID = X_ORG_ID,
    TYPE = X_TYPE,
    COST_IND_SCH_FIXED_DATE = X_COST_IND_SCH_FIXED_DATE,
    LABOR_INVOICE_FORMAT_ID = X_LABOR_INVOICE_FORMAT_ID,
    NON_LABOR_INVOICE_FORMAT_ID = X_NON_LABOR_INVOICE_FORMAT_ID,
    LAST_UPDATE_DATE = X_LAST_UPDATE_DATE,
    LAST_UPDATED_BY = X_LAST_UPDATED_BY,
    LAST_UPDATE_LOGIN = X_LAST_UPDATE_LOGIN,
    BILL_TO_ADDRESS_ID = X_BILL_TO_ADDRESS_ID,
    SHIP_TO_ADDRESS_ID = X_SHIP_TO_ADDRESS_ID,
    LOC_BILL_TO_ADDRESS_ID = X_LOC_BILL_TO_ADDRESS_ID,
    LOC_SHIP_TO_ADDRESS_ID = X_LOC_SHIP_TO_ADDRESS_ID,
    AWARD_ORGANIZATION_ID =  X_AWARD_ORGANIZATION_ID,
    HARD_LIMIT_FLAG =   X_HARD_LIMIT_FLAG ,
    INVOICE_LIMIT_FLAG =  X_INVOICE_LIMIT_FLAG , /*Bug 6445688 */
    BUDGET_WF_ENABLED_FLAG = X_BUDGET_WF_ENABLED_FLAG
  where AWARD_ID = X_AWARD_ID
  ;
  if (sql%notfound) then
    raise no_data_found;
  end if;
end UPDATE_ROW;

procedure DELETE_ROW (
  X_AWARD_ID            IN  NUMBER,
  x_award_project_id    IN  NUMBER,
  x_agreement_id        IN  NUMBER,
  x_Award_Template_flag IN  VARCHAR2,
  x_msg_count           OUT NOCOPY NUMBER,
  RETCODE               OUT NOCOPY VARCHAR2,
  ERRBUFF               OUT NOCOPY VARCHAR2
) is
begin
     -- Added call to below API to fix bug 2355648
           GMS_AWARD_DELETE_PKG.DELETE_AWARD_DETAIL(
  				p_award_id 	      =>x_award_id ,
				p_award_project_id    =>x_award_project_id  ,
                                p_agreement_id        =>x_agreement_id   ,
                               	p_Award_Template_flag =>x_Award_Template_flag,
				p_msg_count           =>x_msg_count,
                                RETCODE	              =>RETCODE,
                                ERRBUFF	              =>ERRBUFF);


          IF RETCODE <>'S' THEN
	         RETURN;
          END IF;

  delete from GMS_AWARDS
  where AWARD_ID = X_AWARD_ID;
  if (sql%notfound) then
    raise no_data_found;
  end if;
Exception

WHEN OTHERS THEN
            --'S' for success, 'E' form exception for , and 'U' for Undefine Exception
             retcode :='U';
    	     errbuff := 'Error :'||substr(sqlerrm,1,200);
             FND_MESSAGE.SET_NAME('GMS','GMS_UNEXPECTED_ERROR');
             FND_MESSAGE.SET_TOKEN('PROGRAM_NAME','GMS_AWARDS_PKG: DELETE_ROW');
             FND_MESSAGE.SET_TOKEN('OERRNO',SQLCODE);
             FND_MESSAGE.SET_TOKEN('OERRM',SQLERRM);
             FND_MSG_PUB.add;
             FND_MSG_PUB.Count_And_Get(p_count => x_msg_count,
                                   p_data => errbuff );
end DELETE_ROW;

/* Added for Bug 2107671 - whenever Award Status is changed to "CLOSED" or "AT RISK"
   Project Status Code corresponding to award_project should also be changed to
   "CLOSED". This will ensure that these Awards are no considered during billing/revenue generation
   process. For other Award Statuses award_project status will be "APPROVED"
*/

Procedure UPDATE_AWARD_PROJECT_STATUS(
  X_award_project_id IN NUMBER,
  X_Status IN VARCHAR2
) is
begin
  update pa_projects
     set project_status_code = nvl(X_Status,'CLOSED')
   where project_id = X_award_project_id;
end UPDATE_AWARD_PROJECT_STATUS;

end GMS_AWARDS_PKG;

/
