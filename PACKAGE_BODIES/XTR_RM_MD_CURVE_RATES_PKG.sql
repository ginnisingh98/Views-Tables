--------------------------------------------------------
--  DDL for Package Body XTR_RM_MD_CURVE_RATES_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."XTR_RM_MD_CURVE_RATES_PKG" as
/* $Header: xtrmdcrb.pls 120.1 2005/06/29 10:33:15 csutaria ship $ */

PROCEDURE INSERT_ROW(
		     X_ROWID IN out nocopy VARCHAR2,
		     X_RATE_CODE VARCHAR2,
		     X_CURVE_CODE VARCHAR2,
		     X_CREATED_BY NUMBER,
		     X_CREATION_DATE DATE,
		     X_LAST_UPDATED_BY NUMBER,
		     X_LAST_UPDATE_DATE DATE,
		     X_LAST_UPDATE_LOGIN NUMBER) IS

	CURSOR C IS SELECT ROWID FROM XTR_RM_MD_CURVE_RATES
		WHERE RATE_CODE = X_RATE_CODE AND CURVE_CODE = X_CURVE_CODE;

	CURSOR CHECK_UNIQUE IS SELECT RATE_CODE, CURVE_CODE FROM XTR_RM_MD_CURVE_RATES
		WHERE RATE_CODE = X_RATE_CODE AND CURVE_CODE = X_CURVE_CODE;

	V_RATE_CODE VARCHAR2(20);
	V_CURVE_CODE VARCHAR2(20);

BEGIN
  OPEN CHECK_UNIQUE;
  FETCH CHECK_UNIQUE INTO V_RATE_CODE, V_CURVE_CODE;
  -- ONLY INSERT IF NO DUPLICATE ROWS FOUND, ELSE DO NOTHING
  IF (CHECK_UNIQUE%NOTFOUND) THEN
	INSERT INTO XTR_RM_MD_CURVE_RATES
		(
		RATE_CODE,
		CURVE_CODE,
		CREATED_BY,
		CREATION_DATE,
		LAST_UPDATED_BY,
		LAST_UPDATE_DATE,
		LAST_UPDATE_LOGIN)
	VALUES (X_RATE_CODE,
		X_CURVE_CODE,
		X_CREATED_BY,
		X_CREATION_DATE,
		X_LAST_UPDATED_BY,
		X_LAST_UPDATE_DATE,
		X_LAST_UPDATE_LOGIN);
	OPEN C;
	FETCH C INTO X_ROWID;
	IF (C%NOTFOUND) THEN
		CLOSE C;
		RAISE NO_DATA_FOUND;
	END IF;
	CLOSE C;
 END IF;
END INSERT_ROW;


PROCEDURE DELETE_ROW (X_ROWID VARCHAR2) IS
BEGIN
	-- Perform delete
	DELETE FROM XTR_RM_MD_CURVE_RATES
		WHERE ROWID = X_ROWID;
	IF (SQL%NOTFOUND) THEN
		RAISE NO_DATA_FOUND;
	END IF;
END DELETE_ROW;


PROCEDURE UPDATE_ROW (
		     X_ROWID VARCHAR2,
		     X_RATE_CODE VARCHAR2,
		     X_CURVE_CODE VARCHAR2,
		     X_LAST_UPDATED_BY NUMBER,
		     X_LAST_UPDATE_DATE DATE,
		     X_LAST_UPDATE_LOGIN NUMBER) IS
BEGIN
	UPDATE XTR_RM_MD_CURVE_RATES
	SET	RATE_CODE	=	X_RATE_CODE,
		CURVE_CODE	=	X_CURVE_CODE,
		LAST_UPDATED_BY	=	X_LAST_UPDATED_BY,
		LAST_UPDATE_DATE=	X_LAST_UPDATE_DATE,
		LAST_UPDATE_LOGIN=	X_LAST_UPDATE_LOGIN
	WHERE ROWID = X_ROWID;

	IF (SQL%NOTFOUND) THEN
		RAISE NO_DATA_FOUND;
	END IF;
END UPDATE_ROW;

PROCEDURE LOCK_ROW(
		     X_ROWID VARCHAR2,
		     X_RATE_CODE VARCHAR2,
		     X_CURVE_CODE VARCHAR2) IS

	CURSOR C IS
		SELECT *
		FROM XTR_RM_MD_CURVE_RATES
		WHERE ROWID = X_ROWID
		FOR UPDATE OF RATE_CODE, CURVE_CODE NOWAIT;

	RECINFO C%ROWTYPE;

BEGIN
	OPEN C;
	FETCH C INTO RECINFO;
	IF (C%NOTFOUND) THEN
		CLOSE C;
		FND_MESSAGE.SET_NAME('FND', 'FORM_RECORD_DELETED');
		APP_EXCEPTION.RAISE_EXCEPTION;
	END IF;
	CLOSE C;

	IF (
		(RECINFO.RATE_CODE = X_RATE_CODE)
	  AND   (RECINFO.CURVE_CODE = X_CURVE_CODE)) THEN
		RETURN;
	ELSE
		FND_MESSAGE.SET_NAME('FND', 'FORM_RECORD_CHANGED');
		APP_EXCEPTION.RAISE_EXCEPTION;
	END IF;
END LOCK_ROW;


END XTR_RM_MD_CURVE_RATES_PKG;


/
