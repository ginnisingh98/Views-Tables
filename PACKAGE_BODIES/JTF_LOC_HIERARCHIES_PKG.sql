--------------------------------------------------------
--  DDL for Package Body JTF_LOC_HIERARCHIES_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."JTF_LOC_HIERARCHIES_PKG" as
/* $Header: jtfllohb.pls 120.2 2005/11/07 14:04:33 cmehta ship $ */
procedure INSERT_ROW (
  X_ROWID in out nocopy VARCHAR2,
  X_LOCATION_HIERARCHY_ID in NUMBER,
  X_OBJECT_VERSION_NUMBER in NUMBER,
  X_REQUEST_ID in NUMBER,
  X_PROGRAM_APPLICATION_ID in NUMBER,
  X_PROGRAM_ID in NUMBER,
  X_PROGRAM_UPDATE_DATE in DATE,
  X_CREATED_BY_APPLICATION_ID in NUMBER,
  X_LOCATION_TYPE_CODE in VARCHAR2,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_AREA1_ID in NUMBER,
  X_AREA1_CODE in VARCHAR2,
  X_AREA2_ID in NUMBER,
  X_AREA2_CODE in VARCHAR2,
  X_COUNTRY_ID in NUMBER,
  X_COUNTRY_CODE in VARCHAR2,
  X_COUNTRY_REGION_ID in NUMBER,
  X_COUNTRY_REGION_CODE in VARCHAR2,
  X_STATE_ID in NUMBER,
  X_STATE_CODE in VARCHAR2,
  X_STATE_REGION_ID in NUMBER,
  X_STATE_REGION_CODE in VARCHAR2,
  X_CITY_ID in NUMBER,
  X_CITY_CODE in VARCHAR2,
  X_POSTAL_CODE_ID in NUMBER,
  X_CREATION_DATE in DATE,
  X_CREATED_BY in NUMBER,
  X_LAST_UPDATE_DATE in DATE,
  X_LAST_UPDATED_BY in NUMBER,
  X_LAST_UPDATE_LOGIN in NUMBER) is
  cursor c is select ROWID from JTF_LOC_HIERARCHIES_B
    where LOCATION_HIERARCHY_ID = X_LOCATION_HIERARCHY_ID
    ;
begin
  insert into JTF_LOC_HIERARCHIES_B (
    LOCATION_HIERARCHY_ID,
    OBJECT_VERSION_NUMBER,
    REQUEST_ID,
    PROGRAM_APPLICATION_ID,
    PROGRAM_ID,
    PROGRAM_UPDATE_DATE,
    CREATED_BY_APPLICATION_ID,
    LOCATION_TYPE_CODE,
    START_DATE_ACTIVE,
    END_DATE_ACTIVE,
    AREA1_ID,
    AREA1_CODE,
    AREA2_ID,
    AREA2_CODE,
    COUNTRY_ID,
    COUNTRY_CODE,
    COUNTRY_REGION_ID,
    COUNTRY_REGION_CODE,
    STATE_ID,
    STATE_CODE,
    STATE_REGION_ID,
    STATE_REGION_CODE,
    CITY_ID,
    CITY_CODE,
    POSTAL_CODE_ID,
    CREATION_DATE,
    CREATED_BY,
    LAST_UPDATE_DATE,
    LAST_UPDATED_BY,
    LAST_UPDATE_LOGIN
  ) values (
    X_LOCATION_HIERARCHY_ID,
    X_OBJECT_VERSION_NUMBER,
    X_REQUEST_ID,
    X_PROGRAM_APPLICATION_ID,
    X_PROGRAM_ID,
    X_PROGRAM_UPDATE_DATE,
    X_CREATED_BY_APPLICATION_ID,
    X_LOCATION_TYPE_CODE,
    X_START_DATE_ACTIVE,
    X_END_DATE_ACTIVE,
    X_AREA1_ID,
    X_AREA1_CODE,
    X_AREA2_ID,
    X_AREA2_CODE,
    X_COUNTRY_ID,
    X_COUNTRY_CODE,
    X_COUNTRY_REGION_ID,
    X_COUNTRY_REGION_CODE,
    X_STATE_ID,
    X_STATE_CODE,
    X_STATE_REGION_ID,
    X_STATE_REGION_CODE,
    X_CITY_ID,
    X_CITY_CODE,
    X_POSTAL_CODE_ID,
    X_CREATION_DATE,
    X_CREATED_BY,
    X_LAST_UPDATE_DATE,
    X_LAST_UPDATED_BY,
    X_LAST_UPDATE_LOGIN
  );

  open c;
  fetch c into X_ROWID;
  if (c%notfound) then
    close c;
    raise no_data_found;
  end if;
  close c;
end INSERT_ROW;

procedure UPDATE_ROW (
  X_LOCATION_HIERARCHY_ID in NUMBER,
  X_OBJECT_VERSION_NUMBER in NUMBER,
  X_REQUEST_ID in NUMBER,
  X_PROGRAM_APPLICATION_ID in NUMBER,
  X_PROGRAM_ID in NUMBER,
  X_PROGRAM_UPDATE_DATE in DATE,
  X_CREATED_BY_APPLICATION_ID in NUMBER,
  X_LOCATION_TYPE_CODE in VARCHAR2,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_AREA1_ID in NUMBER,
  X_AREA1_CODE in VARCHAR2,
  X_AREA2_ID in NUMBER,
  X_AREA2_CODE in VARCHAR2,
  X_COUNTRY_ID in NUMBER,
  X_COUNTRY_CODE in VARCHAR2,
  X_COUNTRY_REGION_ID in NUMBER,
  X_COUNTRY_REGION_CODE in VARCHAR2,
  X_STATE_ID in NUMBER,
  X_STATE_CODE in VARCHAR2,
  X_STATE_REGION_ID in NUMBER,
  X_STATE_REGION_CODE in VARCHAR2,
  X_CITY_ID in NUMBER,
  X_CITY_CODE in VARCHAR2,
  X_POSTAL_CODE_ID in NUMBER,
  X_LAST_UPDATE_DATE in DATE,
  X_LAST_UPDATED_BY in NUMBER,
  X_LAST_UPDATE_LOGIN in NUMBER
) is
begin
  update JTF_LOC_HIERARCHIES_B set
    OBJECT_VERSION_NUMBER = X_OBJECT_VERSION_NUMBER,
    REQUEST_ID = X_REQUEST_ID,
    PROGRAM_APPLICATION_ID = X_PROGRAM_APPLICATION_ID,
    PROGRAM_ID = X_PROGRAM_ID,
    PROGRAM_UPDATE_DATE = X_PROGRAM_UPDATE_DATE,
    CREATED_BY_APPLICATION_ID = X_CREATED_BY_APPLICATION_ID,
    LOCATION_TYPE_CODE = X_LOCATION_TYPE_CODE,
    START_DATE_ACTIVE = X_START_DATE_ACTIVE,
    END_DATE_ACTIVE = X_END_DATE_ACTIVE,
    AREA1_ID = X_AREA1_ID,
    AREA1_CODE = X_AREA1_CODE,
    AREA2_ID = X_AREA2_ID,
    AREA2_CODE = X_AREA2_CODE,
    COUNTRY_ID = X_COUNTRY_ID,
    COUNTRY_CODE = X_COUNTRY_CODE,
    COUNTRY_REGION_ID = X_COUNTRY_REGION_ID,
    COUNTRY_REGION_CODE = X_COUNTRY_REGION_CODE,
    STATE_ID = X_STATE_ID,
    STATE_CODE = X_STATE_CODE,
    STATE_REGION_ID = X_STATE_REGION_ID,
    STATE_REGION_CODE = X_STATE_REGION_CODE,
    CITY_ID = X_CITY_ID,
    CITY_CODE = X_CITY_CODE,
    POSTAL_CODE_ID = X_POSTAL_CODE_ID,
    LAST_UPDATE_DATE = X_LAST_UPDATE_DATE,
    LAST_UPDATED_BY = X_LAST_UPDATED_BY,
    LAST_UPDATE_LOGIN = X_LAST_UPDATE_LOGIN
  where LOCATION_HIERARCHY_ID = X_LOCATION_HIERARCHY_ID;

  if (sql%notfound) then
    raise no_data_found;
  end if;
end UPDATE_ROW;

procedure DELETE_ROW (
  X_LOCATION_HIERARCHY_ID in NUMBER
) is
begin
  delete from JTF_LOC_HIERARCHIES_B
  where LOCATION_HIERARCHY_ID = X_LOCATION_HIERARCHY_ID;

  if (sql%notfound) then
    raise no_data_found;
  end if;
end DELETE_ROW;

procedure  LOAD_ROW(
  X_LOCATION_HIERARCHY_ID in NUMBER,
  X_REQUEST_ID in NUMBER,
  X_PROGRAM_APPLICATION_ID in NUMBER,
  X_PROGRAM_ID in NUMBER,
  X_PROGRAM_UPDATE_DATE in DATE,
  X_CREATED_BY_APPLICATION_ID in NUMBER,
  X_LOCATION_TYPE_CODE in VARCHAR2,
  X_START_DATE_ACTIVE in DATE,
  X_END_DATE_ACTIVE in DATE,
  X_AREA1_ID in NUMBER,
  X_AREA1_CODE in VARCHAR2,
  X_AREA2_ID in NUMBER,
  X_AREA2_CODE in VARCHAR2,
  X_COUNTRY_ID in NUMBER,
  X_COUNTRY_CODE in VARCHAR2,
  X_COUNTRY_REGION_ID in NUMBER,
  X_COUNTRY_REGION_CODE in VARCHAR2,
  X_STATE_ID in NUMBER,
  X_STATE_CODE in VARCHAR2,
  X_STATE_REGION_ID in NUMBER,
  X_STATE_REGION_CODE in VARCHAR2,
  X_CITY_ID in NUMBER,
  X_CITY_CODE in VARCHAR2,
  X_POSTAL_CODE_ID in NUMBER,
  X_OWNER in VARCHAR2
) is

l_user_id   number := 0;
l_obj_verno  number;
l_dummy_char  varchar2(1);
l_row_id    varchar2(100);
l_hier_id   number;

cursor  c_obj_verno is
  select object_version_number
  from    JTF_LOC_HIERARCHIES_B
  where  LOCATION_HIERARCHY_ID =  X_LOCATION_HIERARCHY_ID;

cursor c_chk_hier_exists is
  select 'x'
  from   JTF_LOC_HIERARCHIES_B
  where  LOCATION_HIERARCHY_ID = X_LOCATION_HIERARCHY_ID;

cursor c_get_hierid is
   select JTF_LOC_HIERARCHIES_B_S.nextval
   from dual;

BEGIN

  if X_OWNER = 'SEED' then
     l_user_id := 1;
 end if;

 open c_chk_hier_exists;
 fetch c_chk_hier_exists into l_dummy_char;
 if c_chk_hier_exists%notfound
 then
    close c_chk_hier_exists;
    if X_LOCATION_HIERARCHY_ID is null
    then
      open c_get_hierid;
      fetch c_get_hierid into l_hier_id;
      close c_get_hierid;
    else
       l_hier_id := X_LOCATION_HIERARCHY_ID;
    end if;
    l_obj_verno := 1;
    JTF_LOC_HIERARCHIES_PKG.INSERT_ROW(
    X_ROWID		=>   l_row_id,
    X_LOCATION_HIERARCHY_ID	 =>  l_hier_id,
    X_OBJECT_VERSION_NUMBER  => l_obj_verno,
    X_REQUEST_ID => X_REQUEST_ID,
    X_PROGRAM_APPLICATION_ID => X_PROGRAM_APPLICATION_ID,
    X_PROGRAM_ID => X_PROGRAM_ID,
    X_PROGRAM_UPDATE_DATE => X_PROGRAM_UPDATE_DATE,
    X_CREATED_BY_APPLICATION_ID => X_CREATED_BY_APPLICATION_ID,
    X_LOCATION_TYPE_CODE => X_LOCATION_TYPE_CODE,
    X_START_DATE_ACTIVE => X_START_DATE_ACTIVE,
    X_END_DATE_ACTIVE => X_END_DATE_ACTIVE,
    X_AREA1_ID => X_AREA1_ID,
    X_AREA1_CODE => X_AREA1_CODE,
    X_AREA2_ID => X_AREA2_ID,
    X_AREA2_CODE => X_AREA2_CODE,
    X_COUNTRY_ID => X_COUNTRY_ID,
    X_COUNTRY_CODE => X_COUNTRY_CODE,
    X_COUNTRY_REGION_ID => X_COUNTRY_REGION_ID,
    X_COUNTRY_REGION_CODE => X_COUNTRY_REGION_CODE,
    X_STATE_ID => X_STATE_ID,
    X_STATE_CODE => X_STATE_CODE,
    X_STATE_REGION_ID => X_STATE_REGION_ID,
    X_STATE_REGION_CODE => X_STATE_REGION_CODE,
    X_CITY_ID => X_CITY_ID,
    X_CITY_CODE => X_CITY_CODE,
    X_POSTAL_CODE_ID => X_POSTAL_CODE_ID,
    X_CREATION_DATE	=>  SYSDATE,
    X_CREATED_BY	=>  l_user_id,
    X_LAST_UPDATE_DATE	=>  SYSDATE,
    X_LAST_UPDATED_BY	=>  l_user_id,
    X_LAST_UPDATE_LOGIN	=>  0
  );
else
   close c_chk_hier_exists;
   open c_obj_verno;
   fetch c_obj_verno into l_obj_verno;
   close c_obj_verno;
    JTF_LOC_HIERARCHIES_PKG.UPDATE_ROW(
    X_LOCATION_HIERARCHY_ID =>  X_LOCATION_HIERARCHY_ID,
    X_OBJECT_VERSION_NUMBER  => l_obj_verno + 1,
    X_REQUEST_ID => X_REQUEST_ID,
    X_PROGRAM_APPLICATION_ID => X_PROGRAM_APPLICATION_ID,
    X_PROGRAM_ID => X_PROGRAM_ID,
    X_PROGRAM_UPDATE_DATE => X_PROGRAM_UPDATE_DATE,
    X_CREATED_BY_APPLICATION_ID => X_CREATED_BY_APPLICATION_ID,
    X_LOCATION_TYPE_CODE => X_LOCATION_TYPE_CODE,
    X_START_DATE_ACTIVE => X_START_DATE_ACTIVE,
    X_END_DATE_ACTIVE => X_END_DATE_ACTIVE,
    X_AREA1_ID => X_AREA1_ID,
    X_AREA1_CODE => X_AREA1_CODE,
    X_AREA2_ID => X_AREA2_ID,
    X_AREA2_CODE => X_AREA2_CODE,
    X_COUNTRY_ID => X_COUNTRY_ID,
    X_COUNTRY_CODE => X_COUNTRY_CODE,
    X_COUNTRY_REGION_ID => X_COUNTRY_REGION_ID,
    X_COUNTRY_REGION_CODE => X_COUNTRY_REGION_CODE,
    X_STATE_ID => X_STATE_ID,
    X_STATE_CODE => X_STATE_CODE,
    X_STATE_REGION_ID => X_STATE_REGION_ID,
    X_STATE_REGION_CODE => X_STATE_REGION_CODE,
    X_CITY_ID => X_CITY_ID,
    X_CITY_CODE => X_CITY_CODE,
    X_POSTAL_CODE_ID => X_POSTAL_CODE_ID,
    X_LAST_UPDATE_DATE	=>  SYSDATE,
    X_LAST_UPDATED_BY	=>  l_user_id,
    X_LAST_UPDATE_LOGIN	=>  0
  );
end if;
END LOAD_ROW;

end JTF_LOC_HIERARCHIES_PKG;

/
