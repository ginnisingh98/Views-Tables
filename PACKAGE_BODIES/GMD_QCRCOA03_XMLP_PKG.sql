--------------------------------------------------------
--  DDL for Package Body GMD_QCRCOA03_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."GMD_QCRCOA03_XMLP_PKG" AS
/* $Header: QCRCOA03B.pls 120.0 2007/12/24 13:10:38 krreddy noship $ */
  FUNCTION CF_REPORT_NAMEFORMULA(REPORT_TITLE IN VARCHAR2) RETURN CHAR IS
    COA_REPORT_TITLE VARCHAR2(80);
  BEGIN
    SELECT
      MEANING
    INTO COA_REPORT_TITLE
    FROM
      GEM_LOOKUPS
    WHERE LOOKUP_TYPE = 'GMD_COA_REPORT_TITLE'
      AND LOOKUP_CODE = REPORT_TITLE;
    RETURN (COA_REPORT_TITLE);
  END CF_REPORT_NAMEFORMULA;

  PROCEDURE QCRCOA01_HEADER IS
  BEGIN
    NULL;
  END QCRCOA01_HEADER;

  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  BEGIN
    P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
    /*SRW.USER_EXIT('FND SRWINIT')*/NULL;
    RETURN (TRUE);
  END BEFOREREPORT;

  FUNCTION BEFOREPFORM RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END BEFOREPFORM;

  FUNCTION AFTERPFORM RETURN BOOLEAN IS
    CURSOR GET_REPORT_TITLE IS
      SELECT
        C.REPORT_TITLE,
        MEANING
      FROM
        GEM_LOOKUPS L,
        GMD_COA_HEADERS C
      WHERE L.LOOKUP_TYPE = 'GMD_COA_REPORT_TITLE'
        AND L.LOOKUP_CODE = C.REPORT_TITLE;
    CURSOR GET_REPORT_TITLE_BLANK IS
      SELECT
        MEANING
      FROM
        GEM_LOOKUPS L
      WHERE L.LOOKUP_TYPE = 'GMD_COA_REPORT_TITLE'
        AND L.LOOKUP_CODE = 'BLK';
    PARAM_REC GMD_COA_DATA_OM_NEW.T_COA_PARAMETERS;
    X_STATUS BOOLEAN;
    X_CONC_ID NUMBER;
    X_WHICH_REPORT VARCHAR2(80);
    X_REPORT_TITLE VARCHAR2(30);
    X_RETURN_STATUS VARCHAR2(1);
    X_MSG_COUNT NUMBER;
    X_MSG_DATA VARCHAR2(2200);
    P_INIT_MSG_LIST VARCHAR2(1);
    P_COMMIT VARCHAR2(1);
    P_VALIDATION_LEVEL NUMBER;
    P_API_VERSION CONSTANT NUMBER DEFAULT 1.5;
    P_MSG VARCHAR2(4000);
    TBL_NDX BINARY_INTEGER := 1;
    CURSOR C_COA_DATA IS
      SELECT
        count(*)
      FROM
        GMD_COA_HEADERS;
    CURSOR C_COA_DETAILS IS
      SELECT
        count(*)
      FROM
        GMD_COA_DETAILS;
    CURSOR C_COA_SPEC_TEXT IS
      SELECT
        count(*)
      FROM
        GMD_COA_SPEC_TEXT;
    CURSOR C_COA_RSLT_TEXT IS
      SELECT
        count(*)
      FROM
        GMD_COA_RSLT_TEXT;
    CURSOR C_COA_SPEC_HDR_TEXT IS
      SELECT
        count(*)
      FROM
        GMD_COA_SPEC_HDR_TEXT;
    L_COUNT NUMBER;
  BEGIN
    OPEN C_COA_DATA;
    FETCH C_COA_DATA
     INTO L_COUNT;
    CLOSE C_COA_DATA;
    IF (L_COUNT > 0) THEN
      DELETE FROM GMD_COA_HEADERS;
    END IF;
    OPEN C_COA_DETAILS;
    FETCH C_COA_DETAILS
     INTO L_COUNT;
    CLOSE C_COA_DETAILS;
    IF (L_COUNT > 0) THEN
      DELETE FROM GMD_COA_DETAILS;
    END IF;
    OPEN C_COA_SPEC_TEXT;
    FETCH C_COA_SPEC_TEXT
     INTO L_COUNT;
    CLOSE C_COA_SPEC_TEXT;
    IF (L_COUNT > 0) THEN
      DELETE FROM GMD_COA_SPEC_TEXT;
    END IF;
    OPEN C_COA_RSLT_TEXT;
    FETCH C_COA_RSLT_TEXT
     INTO L_COUNT;
    CLOSE C_COA_RSLT_TEXT;
    IF (L_COUNT > 0) THEN
      DELETE FROM GMD_COA_RSLT_TEXT;
    END IF;
    OPEN C_COA_SPEC_HDR_TEXT;
    FETCH C_COA_SPEC_HDR_TEXT
     INTO L_COUNT;
    CLOSE C_COA_SPEC_HDR_TEXT;
    IF (L_COUNT > 0) THEN
      DELETE FROM GMD_COA_SPEC_HDR_TEXT;
    END IF;
    PARAM_REC.ORGANIZATION_ID := P_ORGANIZATION_ID;
    PARAM_REC.INVENTORY_ITEM_ID := P_INVENTORY_ITEM_ID;
    PARAM_REC.REVISION := P_REVISION;
    PARAM_REC.LOT_NUMBER := P_LOT_NUMBER;
    PARAM_REC.SUBINVENTORY := P_SUBINVENTORY;
    PARAM_REC.ORG_ID := P_ORG_ID;
    PARAM_REC.ORDER_ID := P_ORDER_ID;
    PARAM_REC.CUST_ID := P_CUST_ID;
    PARAM_REC.DELIVERY_ID := P_DELIVERY_ID;
    PARAM_REC.SHIP_TO_SITE_ID := P_SHIP_TO_SITE_ID;
    P_INIT_MSG_LIST := 'T';
    P_COMMIT := 'F';
    P_VALIDATION_LEVEL := 0;
    /*SRW.MESSAGE(2000
               ,'==============================================================')*/NULL;
    GMD_COA_DATA_OM_NEW.POPULATE_COA_DATA(P_API_VERSION
                                         ,P_INIT_MSG_LIST
                                         ,P_COMMIT
                                         ,P_VALIDATION_LEVEL
                                         ,X_RETURN_STATUS
                                         ,X_MSG_COUNT
                                         ,X_MSG_DATA
                                         ,PARAM_REC);
    FOR I IN 1 .. NVL(X_MSG_COUNT
       ,0) LOOP
      X_MSG_DATA := SUBSTRB(FND_MSG_PUB.GET(I
                                           ,'F')
                           ,1
                           ,2200);
      /*SRW.MESSAGE(I
                 ,SUBSTRB(X_MSG_DATA
                        ,1
                        ,2200))*/NULL;
    END LOOP;
    /*SRW.MESSAGE(2001
               ,'==============================================================')*/NULL;
    IF X_RETURN_STATUS = 'S' THEN
      OPEN GET_REPORT_TITLE;
      FETCH GET_REPORT_TITLE
       INTO X_REPORT_TITLE,X_WHICH_REPORT;
      CLOSE GET_REPORT_TITLE;
    END IF;
    RETURN (TRUE);
  END AFTERPFORM;

  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    ROLLBACK;
    /*SRW.USER_EXIT('FND SRWEXIT')*/NULL;
    RETURN (TRUE);
  END AFTERREPORT;

  FUNCTION PRINT_TEXT_FLAG_P RETURN NUMBER IS
  BEGIN
    RETURN PRINT_TEXT_FLAG;
  END PRINT_TEXT_FLAG_P;

END GMD_QCRCOA03_XMLP_PKG;


/
