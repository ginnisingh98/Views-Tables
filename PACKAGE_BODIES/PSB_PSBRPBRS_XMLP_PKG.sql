--------------------------------------------------------
--  DDL for Package Body PSB_PSBRPBRS_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PSB_PSBRPBRS_XMLP_PKG" AS
/* $Header: PSBRPBRSB.pls 120.0 2008/01/07 10:33:06 vijranga noship $ */
  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  BEGIN
    FND_MESSAGE.SET_NAME('PSB'
                        ,'PSB_NO_DATA_FOUND');
    CP_NO_DATA_FOUND := FND_MESSAGE.GET;
    FND_MESSAGE.SET_NAME('PSB'
                        ,'PSB_END_OF_REPORT');
    CP_END_OF_REPORT := FND_MESSAGE.GET;
    P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
    /*SRW.USER_EXIT('FND SRWINIT')*/NULL;
    RETURN (TRUE);
  END BEFOREREPORT;

  FUNCTION CP_ORIGINAL_BUDGETFORMULA(CF_ORIGINAL_BUDGET IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN CF_ORIGINAL_BUDGET;
  END CP_ORIGINAL_BUDGETFORMULA;

  FUNCTION CF_ORIGINAL_BUDGETFORMULA(CODE_COMBINATION_ID IN NUMBER
                                    ,BUDGET_GROUP_ID IN NUMBER
                                    ,START_PERIOD IN VARCHAR2
                                    ,GL_BUDGET_VERSION_ID IN NUMBER
                                    ,SET_OF_BOOKS_ID IN NUMBER
                                    ,END_PERIOD IN VARCHAR2
                                    ,CURRENCY_CODE IN VARCHAR2) RETURN NUMBER IS
    L_ORIGINAL_BUDGET NUMBER;
  BEGIN
    L_ORIGINAL_BUDGET := 0;
    L_ORIGINAL_BUDGET := PSB_BUDGET_REVISIONS_PVT.FIND_ORIGINAL_BUDGET_BALANCE(P_CODE_COMBINATION_ID => CODE_COMBINATION_ID
                                                                              ,P_BUDGET_GROUP_ID => BUDGET_GROUP_ID
                                                                              ,P_GL_PERIOD => START_PERIOD
                                                                              ,P_GL_BUDGET_VERSION_ID => GL_BUDGET_VERSION_ID
                                                                              ,P_SET_OF_BOOKS_ID => SET_OF_BOOKS_ID
                                                                              ,P_END_GL_PERIOD => END_PERIOD
                                                                              ,P_CURRENCY_CODE => CURRENCY_CODE);
    RETURN (NVL(L_ORIGINAL_BUDGET
              ,0));
  END CF_ORIGINAL_BUDGETFORMULA;

  FUNCTION CF_PERCENT_CHANGEFORMULA(BUDGET_BALANCE IN NUMBER
                                   ,REVISION_AMOUNT IN NUMBER) RETURN NUMBER IS
    L_CURRENCY_CODE VARCHAR2(15);
    L_PERCENT_CHANGE NUMBER;
  BEGIN
    SELECT
      DISTINCT
      CURRENCY_CODE
    INTO L_CURRENCY_CODE
    FROM
      PSB_BUDGET_REVISION_ACCOUNTS_V
    WHERE BUDGET_REVISION_ID = P_BUDGET_REVISION_ID;
    IF (NVL(BUDGET_BALANCE
       ,0) <> 0) THEN
      L_PERCENT_CHANGE := PSB_BUDGET_REVISIONS_PVT.GET_ROUNDED_AMOUNT(L_CURRENCY_CODE
                                                                     ,(REVISION_AMOUNT / BUDGET_BALANCE) * 100);
    ELSE
      IF (REVISION_AMOUNT = 0) THEN
        L_PERCENT_CHANGE := 0;
      ELSE
        L_PERCENT_CHANGE := 100;
      END IF;
    END IF;
    RETURN L_PERCENT_CHANGE;
  END CF_PERCENT_CHANGEFORMULA;

  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    /*SRW.USER_EXIT('FND SRWEXIT')*/NULL;
    RETURN (TRUE);
  END AFTERREPORT;

  FUNCTION CF_ACCT_FLEX_DESCFORMULA(CHART_OF_ACCOUNTS_ID IN NUMBER
                                   ,CODE_COMBINATION_ID IN NUMBER) RETURN CHAR IS
    L_DESCRIPTION VARCHAR2(2000);
  BEGIN
    L_DESCRIPTION := NULL;
    IF FND_FLEX_KEYVAL.VALIDATE_CCID(APPL_SHORT_NAME => 'SQLGL'
                                 ,KEY_FLEX_CODE => 'GL#'
                                 ,STRUCTURE_NUMBER => CHART_OF_ACCOUNTS_ID
                                 ,COMBINATION_ID => CODE_COMBINATION_ID) THEN
      L_DESCRIPTION := FND_FLEX_KEYVAL.CONCATENATED_DESCRIPTIONS;
    END IF;
    RETURN (L_DESCRIPTION);
  END CF_ACCT_FLEX_DESCFORMULA;

  FUNCTION CF_CURRENCY_CODEFORMULA RETURN CHAR IS
    L_CURRENCY_CODE VARCHAR2(15);
  BEGIN
    SELECT
      CURRENCY_CODE
    INTO L_CURRENCY_CODE
    FROM
      PSB_BUDGET_REVISIONS
    WHERE BUDGET_REVISION_ID = P_BUDGET_REVISION_ID;
    RETURN L_CURRENCY_CODE;
  END CF_CURRENCY_CODEFORMULA;

  FUNCTION CF_DOCUMENT_POSTING_STATUSFORM(CURRENCY_CODE IN VARCHAR2) RETURN NUMBER IS
    L_RETURN_STATUS VARCHAR2(1);
    L_DOCUMENT_POSTED_FLAG VARCHAR2(1);
    L_DOCUMENT_TYPE VARCHAR2(5);
  BEGIN
    IF CURRENCY_CODE = 'STAT' THEN
      L_DOCUMENT_TYPE := 'SR';
    ELSE
      L_DOCUMENT_TYPE := 'BR';
    END IF;
    PSB_GL_INTERFACE_PVT.FIND_DOCUMENT_POSTING_STATUS(L_RETURN_STATUS
                                                     ,L_DOCUMENT_POSTED_FLAG
                                                     ,L_DOCUMENT_TYPE
                                                     ,P_BUDGET_REVISION_ID);
    IF L_DOCUMENT_POSTED_FLAG = 'N' THEN
      RETURN 0;
    ELSE
      RETURN 1;
    END IF;
  END CF_DOCUMENT_POSTING_STATUSFORM;

  FUNCTION CP_ORIGINAL_BUDGET_P RETURN NUMBER IS
  BEGIN
    RETURN CP_ORIGINAL_BUDGET;
  END CP_ORIGINAL_BUDGET_P;

  FUNCTION CP_END_OF_REPORT_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_END_OF_REPORT;
  END CP_END_OF_REPORT_P;

  FUNCTION CP_NO_DATA_FOUND_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_NO_DATA_FOUND;
  END CP_NO_DATA_FOUND_P;

END PSB_PSBRPBRS_XMLP_PKG;






/
