--------------------------------------------------------
--  DDL for Package Body PA_PAXMGPSD_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PA_PAXMGPSD_XMLP_PKG" AS
/* $Header: PAXMGPSDB.pls 120.2 2008/01/03 12:12:39 krreddy noship $ */
  FUNCTION GET_COVER_PAGE_VALUES RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (FALSE);
  END GET_COVER_PAGE_VALUES;

  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  BEGIN
    DECLARE
      INIT_FAILURE EXCEPTION;
      P_ORG HR_ORGANIZATION_UNITS.NAME%TYPE;
      P_MGR VARCHAR2(30);
      P_NUMBER VARCHAR2(30);
      P_NAME VARCHAR2(30);
      TSK_NUM VARCHAR2(30);
      TSK_NAME VARCHAR2(30);
      P_COST_BGT_CODE VARCHAR2(30);
      P_COST_BGT_TYPE VARCHAR2(30);
      P_REV_BGT_CODE VARCHAR2(30);
      P_REV_BGT_TYPE VARCHAR2(30);
    BEGIN
      P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
      /*SRW.USER_EXIT('FND SRWINIT')*/NULL;
      /*SRW.USER_EXIT('FND GETPROFILE
                    NAME="PA_RULE_BASED_OPTIMIZER"
                    FIELD=":p_rule_optimizer"
                    PRINT_ERROR="N"')*/NULL;
      P_DEBUG_MODE := FND_PROFILE.VALUE('PA_DEBUG_MODE');
      IF ORG_ID IS NOT NULL THEN
        SELECT
          SUBSTR(NAME
                ,1
                ,60)
        INTO P_ORG
        FROM
          HR_ORGANIZATION_UNITS
        WHERE ORG_ID = ORGANIZATION_ID;
      END IF;
      C_ORG := P_ORG;
      IF PROJECT_MANAGER_ID IS NOT NULL THEN
        SELECT
          FULL_NAME
        INTO P_MGR
        FROM
          PER_PEOPLE_F
        WHERE PROJECT_MANAGER_ID = PERSON_ID
          AND sysdate between EFFECTIVE_START_DATE
          AND NVL(EFFECTIVE_END_DATE
           ,SYSDATE + 1)
          AND ( CURRENT_NPW_FLAG = 'Y'
        OR CURRENT_EMPLOYEE_FLAG = 'Y' )
          AND DECODE(CURRENT_NPW_FLAG
              ,'Y'
              ,NPW_NUMBER
              ,EMPLOYEE_NUMBER) IS NOT NULL;
      END IF;
      C_MGR := P_MGR;
      IF PROJ IS NOT NULL THEN
        SELECT
          SEGMENT1,
          NAME
        INTO P_NUMBER,P_NAME
        FROM
          PA_PROJECTS
        WHERE PROJ = PROJECT_ID;
      END IF;
      C_PROJ_NUM := P_NUMBER;
      C_PROJ_NAME := P_NAME;
      IF (GET_COMPANY_NAME <> TRUE) THEN
        RAISE INIT_FAILURE;
      END IF;
      IF (NO_DATA_FOUND_FUNC <> TRUE) THEN
        RAISE INIT_FAILURE;
      END IF;
      IF (COST_BGT_CODE IS NULL) THEN
        SELECT
          BUDGET_TYPE_CODE,
          BUDGET_TYPE
        INTO P_COST_BGT_CODE,P_COST_BGT_TYPE
        FROM
          PA_BUDGET_TYPES
        WHERE BUDGET_AMOUNT_CODE = 'C'
          AND PREDEFINED_FLAG = 'Y'
          AND BUDGET_TYPE_CODE = 'AC';
        C_COST_BGT_CODE := P_COST_BGT_CODE;
        C_COST_BGT_NAME := P_COST_BGT_TYPE;
      ELSE
        SELECT
          BUDGET_TYPE
        INTO P_COST_BGT_TYPE
        FROM
          PA_BUDGET_TYPES
        WHERE BUDGET_TYPE_CODE = COST_BGT_CODE;
        C_COST_BGT_CODE := COST_BGT_CODE;
        C_COST_BGT_NAME := P_COST_BGT_TYPE;
      END IF;
      IF (REV_BGT_CODE IS NULL) THEN
        SELECT
          BUDGET_TYPE_CODE,
          BUDGET_TYPE
        INTO P_REV_BGT_CODE,P_REV_BGT_TYPE
        FROM
          PA_BUDGET_TYPES
        WHERE BUDGET_AMOUNT_CODE = 'R'
          AND PREDEFINED_FLAG = 'Y'
          AND BUDGET_TYPE_CODE = 'AR';
        C_REV_BGT_CODE := P_REV_BGT_CODE;
        C_REV_BGT_NAME := P_REV_BGT_TYPE;
      ELSE
        SELECT
          BUDGET_TYPE
        INTO P_REV_BGT_TYPE
        FROM
          PA_BUDGET_TYPES
        WHERE BUDGET_TYPE_CODE = REV_BGT_CODE;
        C_REV_BGT_CODE := REV_BGT_CODE;
        C_REV_BGT_NAME := P_REV_BGT_TYPE;
      END IF;
    EXCEPTION
      WHEN OTHERS THEN
        /*RAISE SRW.PROGRAM_ABORT*/RAISE_APPLICATION_ERROR(-20101,null);
    END;
    RETURN (TRUE);
  END BEFOREREPORT;

  FUNCTION GET_COMPANY_NAME RETURN BOOLEAN IS
    L_NAME GL_SETS_OF_BOOKS.NAME%TYPE;
  BEGIN
    SELECT
      GL.NAME
    INTO L_NAME
    FROM
      GL_SETS_OF_BOOKS GL,
      PA_IMPLEMENTATIONS PI
    WHERE GL.SET_OF_BOOKS_ID = PI.SET_OF_BOOKS_ID;
    C_COMPANY_NAME_HEADER := L_NAME;
    RETURN (TRUE);
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (FALSE);
  END GET_COMPANY_NAME;

  FUNCTION NO_DATA_FOUND_FUNC RETURN BOOLEAN IS
    MESSAGE_NAME VARCHAR2(80);
  BEGIN
    SELECT
      MEANING
    INTO MESSAGE_NAME
    FROM
      PA_LOOKUPS
    WHERE LOOKUP_TYPE = 'MESSAGE'
      AND LOOKUP_CODE = 'NO_DATA_FOUND';
    C_NO_DATA_FOUND := MESSAGE_NAME;
    RETURN (TRUE);
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (FALSE);
  END NO_DATA_FOUND_FUNC;

  FUNCTION GET_PERIOD(SD IN DATE) RETURN VARCHAR2 IS
    PERNAME VARCHAR2(30);
    ST_DATE DATE;
    E_DATE DATE;
  BEGIN
    IF (PA_PERIOD IS NULL) THEN
      SELECT
        PERIOD_NAME,
        START_DATE,
        END_DATE
      INTO PERNAME,ST_DATE,E_DATE
      FROM
        PA_PERIODS
      WHERE TRUNC(SYSDATE) between TRUNC(START_DATE)
        AND TRUNC(END_DATE);
    ELSE
      SELECT
        PERIOD_NAME,
        START_DATE,
        END_DATE
      INTO PERNAME,ST_DATE,E_DATE
      FROM
        PA_PERIODS
      WHERE PERIOD_NAME = PA_PERIOD;
    END IF;
    C_START_DATE := ST_DATE;
    C_END_DATE := E_DATE;
    RETURN (PERNAME);
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (NULL);
  END GET_PERIOD;

  FUNCTION PERIOD_NAMEFORMULA RETURN VARCHAR2 IS
  BEGIN
    RETURN (GET_PERIOD(SYSDATE));
  END PERIOD_NAMEFORMULA;

  FUNCTION UNBILLED_RECEIVABLESFORMULA(RETN_ACCOUNTING_FLAG IN VARCHAR2
                                      ,TOTAL_REVENUE_AMOUNT IN NUMBER
                                      ,PFC_TOTAL_INVOICE_AMOUNT IN NUMBER
                                      ,UNBILLED_RETENTION IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF (RETN_ACCOUNTING_FLAG = 'Y') THEN
      RETURN (GREATEST((TOTAL_REVENUE_AMOUNT - PFC_TOTAL_INVOICE_AMOUNT)
                     ,0));
    ELSE
      RETURN (GREATEST((TOTAL_REVENUE_AMOUNT - PFC_TOTAL_INVOICE_AMOUNT - UNBILLED_RETENTION)
                     ,0));
    END IF;
  END UNBILLED_RECEIVABLESFORMULA;

  FUNCTION UNEARNED_REVENUEFORMULA(RETN_ACCOUNTING_FLAG IN VARCHAR2
                                  ,PFC_TOTAL_INVOICE_AMOUNT IN NUMBER
                                  ,TOTAL_REVENUE_AMOUNT IN NUMBER
                                  ,UNBILLED_RETENTION IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF (RETN_ACCOUNTING_FLAG = 'Y') THEN
      RETURN (GREATEST((PFC_TOTAL_INVOICE_AMOUNT - TOTAL_REVENUE_AMOUNT)
                     ,0));
    ELSE
      RETURN (GREATEST((PFC_TOTAL_INVOICE_AMOUNT + UNBILLED_RETENTION - TOTAL_REVENUE_AMOUNT)
                     ,0));
    END IF;
  END UNEARNED_REVENUEFORMULA;

  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    BEGIN
      /*SRW.USER_EXIT('FND SRWEXIT')*/NULL;
    END;
    RETURN (TRUE);
  END AFTERREPORT;

  FUNCTION C_PROJECT_ACTUAL_COSTFORMULA RETURN NUMBER IS
  BEGIN
    RETURN NULL;
  END C_PROJECT_ACTUAL_COSTFORMULA;

  FUNCTION C_ACT_PER_REVFORMULA(RESOURCE_LIST_MEMBER_ID IN NUMBER
                               ,PERIOD_NAME IN VARCHAR2
                               ,PROJECT_ID7 IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (GET_PERIOD_AMT('REVENUE'
                         ,resource_list_member_id
                         ,PROJECT_ID7
                         ,PERIOD_NAME));
  END C_ACT_PER_REVFORMULA;

  FUNCTION GET_PERIOD_AMT(X_TYPE IN VARCHAR2
                         ,X_RSRC_LIST_MEMBER_ID IN NUMBER,project_id7 IN NUMBER,PERIOD_NAME IN VARCHAR2) RETURN NUMBER IS
    X_REVENUE NUMBER;
    X_RAW_COST NUMBER;
    X_BURDENED_COST NUMBER;
    X_QUANTITY NUMBER;
    X_LABOR_HOURS NUMBER;
    X_BILLABLE_RAW_COST NUMBER;
    X_BILLABLE_BURDENED_COST NUMBER;
    X_BILLABLE_QUANTITY NUMBER;
    X_BILLABLE_LABOR_HOURS NUMBER;
    X_CMT_RAW_COST NUMBER;
    X_CMT_BURDENED_COST NUMBER;
    X_UNIT_OF_MEASURE VARCHAR2(100);
    X_ERR_STAGE VARCHAR2(100);
    X_ERR_CODE NUMBER;
    L_PRD_START_DATE DATE;
    L_PRD_END_DATE DATE;
  BEGIN
    X_REVENUE := 0;
    X_RAW_COST := 0;
    X_BURDENED_COST := 0;
    X_QUANTITY := 0;
    X_LABOR_HOURS := 0;
    X_BILLABLE_RAW_COST := 0;
    X_BILLABLE_BURDENED_COST := 0;
    X_BILLABLE_QUANTITY := 0;
    X_BILLABLE_LABOR_HOURS := 0;
    X_CMT_RAW_COST := 0;
    X_CMT_BURDENED_COST := 0;
    X_UNIT_OF_MEASURE := NULL;
    X_ERR_STAGE := NULL;
    X_ERR_CODE := 0;
    L_PRD_START_DATE := C_START_DATE;
    L_PRD_END_DATE := C_END_DATE;
    PA_ACCUM_API.GET_PROJ_ACCUM_ACTUALS(PROJECT_ID7
                                       ,NULL
                                       ,X_RSRC_LIST_MEMBER_ID
                                       ,'P'
                                       ,PERIOD_NAME
                                       ,L_PRD_START_DATE
                                       ,L_PRD_END_DATE
                                       ,X_REVENUE
                                       ,X_RAW_COST
                                       ,X_BURDENED_COST
                                       ,X_QUANTITY
                                       ,X_LABOR_HOURS
                                       ,X_BILLABLE_RAW_COST
                                       ,X_BILLABLE_BURDENED_COST
                                       ,X_BILLABLE_QUANTITY
                                       ,X_BILLABLE_LABOR_HOURS
                                       ,X_CMT_RAW_COST
                                       ,X_CMT_BURDENED_COST
                                       ,X_UNIT_OF_MEASURE
                                       ,X_ERR_STAGE
                                       ,X_ERR_CODE);
    IF (X_ERR_CODE = 0) THEN
      IF (X_TYPE = 'REVENUE') THEN
        RETURN (X_REVENUE);
      ELSE
        RETURN (X_BURDENED_COST);
      END IF;
    ELSE
      RETURN (-1);
    END IF;
  EXCEPTION
    WHEN OTHERS THEN
      RETURN (NULL);
  END GET_PERIOD_AMT;

  FUNCTION C_ACT_PER_COSTFORMULA(RESOURCE_LIST_MEMBER_ID1 IN NUMBER
                                ,PERIOD_NAME IN VARCHAR2
                                ,PROJECT_ID7 IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (GET_PERIOD_AMT('COST'
                         ,resource_list_member_id1
                         ,PROJECT_ID7
                         ,PERIOD_NAME));
  END C_ACT_PER_COSTFORMULA;

  FUNCTION C_ACT_PER_REV_SUMFORMULA(C_ACT_PER_REV IN NUMBER
                                   ,MEMBER_LEVEL2 IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (GET_PERIOD_AMT_SUM(C_ACT_PER_REV
                             ,MEMBER_LEVEL2));
  END C_ACT_PER_REV_SUMFORMULA;

  FUNCTION GET_RSRC_NAME_DISP(X_ALIAS IN VARCHAR2
                             ,X_LEVEL IN NUMBER) RETURN VARCHAR2 IS
    LNAME VARCHAR2(30);
  BEGIN
    LNAME := NULL;
    LNAME := (LPAD(' '
                 ,2 * (X_LEVEL - 1)) || X_ALIAS);
    RETURN (LNAME);
  END GET_RSRC_NAME_DISP;

  FUNCTION C_ACT_PER_COST_SUMFORMULA(C_ACT_PER_COST IN NUMBER
                                    ,MEMBER_LEVEL1 IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (GET_PERIOD_AMT_SUM(C_ACT_PER_COST
                             ,MEMBER_LEVEL1));
  END C_ACT_PER_COST_SUMFORMULA;

  FUNCTION GET_PERIOD_AMT_SUM(X_AMT IN NUMBER
                             ,X_LEVEL IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF (X_LEVEL = 1) THEN
      RETURN (X_AMT);
    ELSE
      RETURN (0);
    END IF;
  END GET_PERIOD_AMT_SUM;

  FUNCTION CF_CURRENCY_CODEFORMULA RETURN VARCHAR2 IS
  BEGIN
    RETURN (PA_MULTI_CURRENCY.GET_ACCT_CURRENCY_CODE);
  END CF_CURRENCY_CODEFORMULA;

  FUNCTION UNBILLED_RETNFORMULA(RETN_ACCOUNTING_FLAG IN VARCHAR2
                               ,UNBILLED_RETENTION IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF (RETN_ACCOUNTING_FLAG = 'Y') THEN
      RETURN (-UNBILLED_RETENTION);
    ELSE
      RETURN (0);
    END IF;
  END UNBILLED_RETNFORMULA;

  FUNCTION AFTERPFORM RETURN BOOLEAN IS
  BEGIN
    IF PROJ IS NOT NULL THEN
      P_PROJECT := 'AND  p.project_id = :proj ';
    ELSE
      P_PROJECT := ' AND 1=1';
    END IF;
    IF PROJ_TYPE IS NOT NULL THEN
      P_PROJECT_TYPE := 'AND p.project_type = :proj_type';
    ELSE
      P_PROJECT_TYPE := 'AND 1=1';
    END IF;
    IF PROJECT_MANAGER_ID IS NOT NULL THEN
      P_PROJECT_MANAGER := 'AND NVL(p.manager_person_id,-999) =:project_manager_id';
    ELSE
      P_PROJECT_MANAGER := 'AND 1=1 ';
    END IF;
    RETURN (TRUE);
  END AFTERPFORM;

  FUNCTION C_COMPANY_NAME_HEADER_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_COMPANY_NAME_HEADER;
  END C_COMPANY_NAME_HEADER_P;

  FUNCTION C_NO_DATA_FOUND_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_NO_DATA_FOUND;
  END C_NO_DATA_FOUND_P;

  FUNCTION C_ORG_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_ORG;
  END C_ORG_P;

  FUNCTION C_PROJ_NUM_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_PROJ_NUM;
  END C_PROJ_NUM_P;

  FUNCTION C_PROJ_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_PROJ_NAME;
  END C_PROJ_NAME_P;

  FUNCTION C_MGR_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_MGR;
  END C_MGR_P;

  FUNCTION C_START_DATE_P RETURN DATE IS
  BEGIN
    RETURN C_START_DATE;
  END C_START_DATE_P;

  FUNCTION C_END_DATE_P RETURN DATE IS
  BEGIN
    RETURN C_END_DATE;
  END C_END_DATE_P;

  FUNCTION C_COST_BGT_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_COST_BGT_NAME;
  END C_COST_BGT_NAME_P;

  FUNCTION C_REV_BGT_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_REV_BGT_NAME;
  END C_REV_BGT_NAME_P;

  FUNCTION C_COST_BGT_CODE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_COST_BGT_CODE;
  END C_COST_BGT_CODE_P;

  FUNCTION C_REV_BGT_CODE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_REV_BGT_CODE;
  END C_REV_BGT_CODE_P;

END PA_PAXMGPSD_XMLP_PKG;


/
