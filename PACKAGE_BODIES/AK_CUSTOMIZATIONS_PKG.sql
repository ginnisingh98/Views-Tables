--------------------------------------------------------
--  DDL for Package Body AK_CUSTOMIZATIONS_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."AK_CUSTOMIZATIONS_PKG" as
/* $Header: AKDCUSTB.pls 120.3 2006/01/25 15:56:42 tshort noship $ */

procedure INSERT_ROW (
X_ROWID                        in out NOCOPY VARCHAR2,
X_CUSTOMIZATION_APPLICATION_ID in     NUMBER,
X_CUSTOMIZATION_CODE           in     VARCHAR2,
X_REGION_APPLICATION_ID        in     NUMBER,
X_REGION_CODE                  in     VARCHAR2,
X_NAME                         in     VARCHAR2,
X_DESCRIPTION                  in     VARCHAR2,
X_VERTICALIZATION_ID           in     VARCHAR2,
X_LOCALIZATION_CODE            in     VARCHAR2,
X_ORG_ID                       in     NUMBER,
X_SITE_ID                      in     NUMBER,
X_RESPONSIBILITY_ID            in     NUMBER,
X_WEB_USER_ID                  in     NUMBER,
X_DEFAULT_CUSTOMIZATION_FLAG   in     VARCHAR2,
X_CUSTOMIZATION_LEVEL_ID       in     NUMBER,
X_CREATED_BY                   in     NUMBER,
X_CREATION_DATE                in     DATE,
X_LAST_UPDATED_BY              in     NUMBER,
X_LAST_UPDATE_DATE             in     DATE,
X_LAST_UPDATE_LOGIN            in     NUMBER,
X_START_DATE_ACTIVE            in     DATE,
X_END_DATE_ACTIVE              in     DATE
) is
cursor C is select ROWID from AK_CUSTOMIZATIONS
where CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID
and   REGION_CODE                  = X_REGION_CODE;
begin
insert into AK_CUSTOMIZATIONS (
CUSTOMIZATION_APPLICATION_ID,
CUSTOMIZATION_CODE,
REGION_APPLICATION_ID,
REGION_CODE,
VERTICALIZATION_ID,
LOCALIZATION_CODE,
ORG_ID,
SITE_ID,
RESPONSIBILITY_ID,
WEB_USER_ID,
DEFAULT_CUSTOMIZATION_FLAG,
CUSTOMIZATION_LEVEL_ID,
CREATED_BY,
CREATION_DATE,
LAST_UPDATED_BY,
LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN,
START_DATE_ACTIVE,
END_DATE_ACTIVE
) values (
X_CUSTOMIZATION_APPLICATION_ID,
X_CUSTOMIZATION_CODE,
X_REGION_APPLICATION_ID,
X_REGION_CODE,
X_VERTICALIZATION_ID,
X_LOCALIZATION_CODE,
X_ORG_ID,
X_SITE_ID,
X_RESPONSIBILITY_ID,
X_WEB_USER_ID,
X_DEFAULT_CUSTOMIZATION_FLAG,
X_CUSTOMIZATION_LEVEL_ID,
X_CREATED_BY,
X_CREATION_DATE,
X_LAST_UPDATED_BY,
X_LAST_UPDATE_DATE,
X_LAST_UPDATE_LOGIN,
X_START_DATE_ACTIVE,
X_END_DATE_ACTIVE
);

open C;
fetch C into X_ROWID;
if (C%notfound) then
close C;
raise no_data_found;
end if;
close C;

insert into AK_CUSTOMIZATIONS_TL (
CUSTOMIZATION_APPLICATION_ID,
CUSTOMIZATION_CODE,
REGION_APPLICATION_ID,
REGION_CODE,
NAME,
DESCRIPTION,
LANGUAGE,
SOURCE_LANG,
CREATED_BY,
CREATION_DATE,
LAST_UPDATED_BY,
LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN
) select
X_CUSTOMIZATION_APPLICATION_ID,
X_CUSTOMIZATION_CODE,
X_REGION_APPLICATION_ID,
X_REGION_CODE,
X_NAME,
X_DESCRIPTION,
L.LANGUAGE_CODE,
userenv('LANG'),
X_CREATED_BY,
X_CREATION_DATE,
X_LAST_UPDATED_BY,
X_LAST_UPDATE_DATE,
X_LAST_UPDATE_LOGIN
from FND_LANGUAGES L
where L.INSTALLED_FLAG in ('I', 'B')
and   not exists
(select NULL
from AK_CUSTOMIZATIONS_TL T
where T.CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID
and   T.CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE
and   T.REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID
and   T.REGION_CODE                  = X_REGION_CODE
and   T.LANGUAGE                     = L.LANGUAGE_CODE);
end INSERT_ROW;

procedure LOCK_ROW (
X_CUSTOMIZATION_APPLICATION_ID in     NUMBER,
X_CUSTOMIZATION_CODE           in     VARCHAR2,
X_REGION_APPLICATION_ID        in     NUMBER,
X_REGION_CODE                  in     VARCHAR2,
X_NAME                         in     VARCHAR2,
X_DESCRIPTION                  in     VARCHAR2,
X_VERTICALIZATION_ID           in     VARCHAR2,
X_LOCALIZATION_CODE            in     VARCHAR2,
X_ORG_ID                       in     NUMBER,
X_SITE_ID                      in     NUMBER,
X_RESPONSIBILITY_ID            in     NUMBER,
X_WEB_USER_ID                  in     NUMBER,
X_DEFAULT_CUSTOMIZATION_FLAG   in     VARCHAR2,
X_CUSTOMIZATION_LEVEL_ID       in     NUMBER,
X_CREATED_BY                   in     NUMBER,
X_CREATION_DATE                in     DATE,
X_LAST_UPDATED_BY              in     NUMBER,
X_LAST_UPDATE_DATE             in     DATE,
X_LAST_UPDATE_LOGIN            in     NUMBER,
X_START_DATE_ACTIVE            in     DATE,
X_END_DATE_ACTIVE              in     DATE
) is
cursor C is select
CUSTOMIZATION_APPLICATION_ID,
CUSTOMIZATION_CODE,
REGION_APPLICATION_ID,
REGION_CODE,
VERTICALIZATION_ID,
LOCALIZATION_CODE,
ORG_ID,
SITE_ID,
RESPONSIBILITY_ID,
WEB_USER_ID,
DEFAULT_CUSTOMIZATION_FLAG,
CUSTOMIZATION_LEVEL_ID,
CREATED_BY,
CREATION_DATE,
LAST_UPDATED_BY,
LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN,
START_DATE_ACTIVE,
END_DATE_ACTIVE
from AK_CUSTOMIZATIONS
where CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID
and   REGION_CODE                  = X_REGION_CODE
for update of CUSTOMIZATION_APPLICATION_ID nowait;
recinfo C%rowtype;

cursor C1 is select
NAME,
DESCRIPTION
from AK_CUSTOMIZATIONS_TL
where CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID
and   REGION_CODE                  = X_REGION_CODE
and   LANGUAGE                     = userenv('LANG')
for update of CUSTOMIZATION_CODE nowait;
tlinfo C1%rowtype;
begin
open C;
fetch C into recinfo;
if (C%notfound) then
close C;
fnd_message.set_name('FND', 'FORM_RECORD_DELETED');
app_exception.raise_exception;
end if;
close C;

if (((recinfo.CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID)
OR ((recinfo.CUSTOMIZATION_APPLICATION_ID is null)
AND (X_CUSTOMIZATION_APPLICATION_ID is null)))
AND ((recinfo.CUSTOMIZATION_CODE = X_CUSTOMIZATION_CODE)
OR ((recinfo.CUSTOMIZATION_CODE is null)
AND (X_CUSTOMIZATION_CODE is null)))
AND ((recinfo.REGION_APPLICATION_ID = X_REGION_APPLICATION_ID)
OR ((recinfo.REGION_APPLICATION_ID is null)
AND (X_REGION_APPLICATION_ID is null)))
AND ((recinfo.REGION_CODE = X_REGION_CODE)
OR ((recinfo.REGION_CODE is null)
AND (X_REGION_CODE is null)))
AND ((recinfo.VERTICALIZATION_ID = X_VERTICALIZATION_ID)
OR ((recinfo.VERTICALIZATION_ID is null)
AND (X_VERTICALIZATION_ID is null)))
AND ((recinfo.LOCALIZATION_CODE = X_LOCALIZATION_CODE)
OR ((recinfo.LOCALIZATION_CODE is null)
AND (X_LOCALIZATION_CODE is null)))
AND ((recinfo.ORG_ID = X_ORG_ID)
OR ((recinfo.ORG_ID is null)
AND (X_ORG_ID is null)))
AND ((recinfo.SITE_ID = X_SITE_ID)
OR ((recinfo.SITE_ID is null)
AND (X_SITE_ID is null)))
AND ((recinfo.RESPONSIBILITY_ID = X_RESPONSIBILITY_ID)
OR ((recinfo.RESPONSIBILITY_ID is null)
AND (X_RESPONSIBILITY_ID is null)))
AND ((recinfo.WEB_USER_ID = X_WEB_USER_ID)
OR ((recinfo.WEB_USER_ID is null)
AND (X_WEB_USER_ID is null)))
AND ((recinfo.DEFAULT_CUSTOMIZATION_FLAG = X_DEFAULT_CUSTOMIZATION_FLAG)
OR ((recinfo.DEFAULT_CUSTOMIZATION_FLAG is null)
AND (X_DEFAULT_CUSTOMIZATION_FLAG is null)))
AND ((recinfo.CUSTOMIZATION_LEVEL_ID = X_CUSTOMIZATION_LEVEL_ID)
OR ((recinfo.CUSTOMIZATION_LEVEL_ID is null)
AND (X_CUSTOMIZATION_LEVEL_ID is null)))
) then
null;
else
fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
app_exception.raise_exception;
end if;

open C1;
fetch C1 into tlinfo;
if (C1%notfound) then
close C1;
return;
end if;
close C1;
if ((tlinfo.NAME = X_NAME)
AND ((tlinfo.DESCRIPTION = X_DESCRIPTION)
OR((tlinfo.DESCRIPTION is null)
AND (X_DESCRIPTION is null)))
) then
null;
else
fnd_message.set_name('FND', 'FORM_RECORD_CHANGED');
app_exception.raise_exception;
end if;
return;
end LOCK_ROW;

procedure UPDATE_ROW (
X_CUSTOMIZATION_APPLICATION_ID in NUMBER,
X_CUSTOMIZATION_CODE           in VARCHAR2,
X_REGION_APPLICATION_ID        in NUMBER,
X_REGION_CODE                  in VARCHAR2,
X_NAME                         in VARCHAR2,
X_DESCRIPTION                  in VARCHAR2,
X_VERTICALIZATION_ID           in VARCHAR2,
X_LOCALIZATION_CODE            in VARCHAR2,
X_ORG_ID                       in NUMBER,
X_SITE_ID                      in NUMBER,
X_RESPONSIBILITY_ID            in NUMBER,
X_WEB_USER_ID                  in NUMBER,
X_DEFAULT_CUSTOMIZATION_FLAG   in VARCHAR2,
X_CUSTOMIZATION_LEVEL_ID       in NUMBER,
X_LAST_UPDATED_BY              in NUMBER,
X_LAST_UPDATE_DATE             in DATE,
X_LAST_UPDATE_LOGIN            in NUMBER,
X_START_DATE_ACTIVE            in DATE,
X_END_DATE_ACTIVE              in DATE
) is
begin
update AK_CUSTOMIZATIONS set
CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID,
CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE,
REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID,
REGION_CODE                  = X_REGION_CODE,
VERTICALIZATION_ID           = X_VERTICALIZATION_ID,
LOCALIZATION_CODE            = X_LOCALIZATION_CODE,
ORG_ID                       = X_ORG_ID,
SITE_ID                      = X_SITE_ID,
RESPONSIBILITY_ID            = X_RESPONSIBILITY_ID,
WEB_USER_ID                  = X_WEB_USER_ID,
DEFAULT_CUSTOMIZATION_FLAG   = X_DEFAULT_CUSTOMIZATION_FLAG,
CUSTOMIZATION_LEVEL_ID       = X_CUSTOMIZATION_LEVEL_ID,
LAST_UPDATED_BY              = X_LAST_UPDATED_BY,
LAST_UPDATE_DATE             = X_LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN            = X_LAST_UPDATE_LOGIN,
START_DATE_ACTIVE            = X_START_DATE_ACTIVE,
END_DATE_ACTIVE              = X_END_DATE_ACTIVE
where CUSTOMIZATION_APPLICATION_ID = X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           = X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        = X_REGION_APPLICATION_ID
and   REGION_CODE                  = X_REGION_CODE;

if (sql%notfound) then
raise no_data_found;
end if;

update AK_CUSTOMIZATIONS_TL set
NAME              = X_NAME,
DESCRIPTION       = X_DESCRIPTION,
LAST_UPDATED_BY   = X_LAST_UPDATED_BY,
LAST_UPDATE_DATE  = X_LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN = X_LAST_UPDATE_LOGIN,
SOURCE_LANG       = userenv('LANG')
where CUSTOMIZATION_APPLICATION_ID =  X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           =  X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        =  X_REGION_APPLICATION_ID
and   REGION_CODE                  =  X_REGION_CODE
and   userenv('LANG')              in (LANGUAGE, SOURCE_LANG);

if (sql%notfound) then
raise no_data_found;
end if;
end UPDATE_ROW;

procedure DELETE_ROW (
X_CUSTOMIZATION_APPLICATION_ID in NUMBER,
X_CUSTOMIZATION_CODE           in VARCHAR2,
X_REGION_APPLICATION_ID        in NUMBER,
X_REGION_CODE                  in VARCHAR2
) is
begin
delete from AK_CUSTOMIZATIONS
where CUSTOMIZATION_APPLICATION_ID =  X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           =  X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        =  X_REGION_APPLICATION_ID
and   REGION_CODE                  =  X_REGION_CODE;

if (sql%notfound) then
raise no_data_found;
end if;

delete from AK_CUSTOMIZATIONS_TL
where CUSTOMIZATION_APPLICATION_ID =  X_CUSTOMIZATION_APPLICATION_ID
and   CUSTOMIZATION_CODE           =  X_CUSTOMIZATION_CODE
and   REGION_APPLICATION_ID        =  X_REGION_APPLICATION_ID
and   REGION_CODE                  =  X_REGION_CODE;

if (sql%notfound) then
raise no_data_found;
end if;
end DELETE_ROW;

procedure ADD_LANGUAGE
is
begin
/* Mar/19/03 requested by Ric Ginsberg */
/* The following delete and update statements are commented out */
/* as a quick workaround to fix the time-consuming table handler issue */
/* Eventually we'll need to turn them into a separate fix_language procedure */
/*

delete from AK_CUSTOMIZATIONS_TL T
where not exists
(select NULL
from AK_CUSTOMIZATIONS B
where B.CUSTOMIZATION_APPLICATION_ID = T.CUSTOMIZATION_APPLICATION_ID
and   B.CUSTOMIZATION_CODE           = T.CUSTOMIZATION_CODE
and   B.REGION_APPLICATION_ID        = T.REGION_APPLICATION_ID
and   B.REGION_CODE                  = T.REGION_CODE
);

update AK_CUSTOMIZATIONS_TL T set (
NAME,
DESCRIPTION
) = (select B.NAME,
B.DESCRIPTION
from AK_CUSTOMIZATIONS_TL B
where B.CUSTOMIZATION_APPLICATION_ID = T.CUSTOMIZATION_APPLICATION_ID
and   B.CUSTOMIZATION_CODE           = T.CUSTOMIZATION_CODE
and   B.REGION_APPLICATION_ID        = T.REGION_APPLICATION_ID
and   B.REGION_CODE                  = T.REGION_CODE
and   B.LANGUAGE                     = T.SOURCE_LANG)
where (
T.CUSTOMIZATION_APPLICATION_ID,
T.CUSTOMIZATION_CODE,
T.REGION_APPLICATION_ID,
T.REGION_CODE,
T.LANGUAGE
) in (select SUBT.CUSTOMIZATION_APPLICATION_ID,
SUBT.CUSTOMIZATION_CODE,
SUBT.REGION_APPLICATION_ID,
SUBT.REGION_CODE,
SUBT.LANGUAGE
from AK_CUSTOMIZATIONS_TL SUBB,
AK_CUSTOMIZATIONS_TL SUBT
where SUBB.CUSTOMIZATION_APPLICATION_ID = SUBT.CUSTOMIZATION_APPLICATION_ID
and   SUBB.CUSTOMIZATION_CODE           = SUBT.CUSTOMIZATION_CODE
and   SUBB.REGION_APPLICATION_ID        = SUBT.REGION_APPLICATION_ID
and   SUBB.REGION_CODE                  = SUBT.REGION_CODE
and   SUBB.LANGUAGE                     = SUBT.SOURCE_LANG
and   (SUBB.NAME <> SUBT.NAME
or (SUBB.NAME is null and SUBT.NAME is not null)
or (SUBB.NAME is not null and SUBT.NAME is null))
and   (SUBB.DESCRIPTION <> SUBT.DESCRIPTION
or (SUBB.DESCRIPTION is null and SUBT.DESCRIPTION is not null)
or (SUBB.DESCRIPTION is not null and SUBT.DESCRIPTION is null))
);

*/

insert /*+ append parallel(tt) */ into AK_CUSTOMIZATIONS_TL tt (
CUSTOMIZATION_APPLICATION_ID,
CUSTOMIZATION_CODE,
REGION_APPLICATION_ID,
REGION_CODE,
NAME,
DESCRIPTION,
LANGUAGE,
SOURCE_LANG,
CREATED_BY,
CREATION_DATE,
LAST_UPDATED_BY,
LAST_UPDATE_DATE,
LAST_UPDATE_LOGIN
) select /*+ parallel(v) parallel(t) use_nl(t)  */ v.* from
(select /*+ no_merge ordered parallel(b) */
B.CUSTOMIZATION_APPLICATION_ID,
B.CUSTOMIZATION_CODE,
B.REGION_APPLICATION_ID,
B.REGION_CODE,
B.NAME,
B.DESCRIPTION,
L.LANGUAGE_CODE,
B.SOURCE_LANG,
B.CREATED_BY,
B.CREATION_DATE,
B.LAST_UPDATED_BY,
B.LAST_UPDATE_DATE,
B.LAST_UPDATE_LOGIN
from AK_CUSTOMIZATIONS_TL B,
FND_LANGUAGES L
where L.INSTALLED_FLAG in ('I', 'B')
and   B.LANGUAGE = userenv('LANG')
) v, AK_CUSTOMIZATIONS_TL T
where T.CUSTOMIZATION_APPLICATION_ID(+) = v.CUSTOMIZATION_APPLICATION_ID
and   T.CUSTOMIZATION_CODE(+)           = v.CUSTOMIZATION_CODE
and   T.REGION_APPLICATION_ID(+)        = v.REGION_APPLICATION_ID
and   T.REGION_CODE(+)                  = v.REGION_CODE
and   T.LANGUAGE(+)                     = v.LANGUAGE_CODE
and T.CUSTOMIZATION_APPLICATION_ID is NULL
and T.CUSTOMIZATION_CODE is NULL
and T.REGION_APPLICATION_ID is NULL
and T.REGION_CODE is NULL;

end ADD_LANGUAGE;

end AK_CUSTOMIZATIONS_PKG;

/
