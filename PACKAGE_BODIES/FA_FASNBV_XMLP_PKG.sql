--------------------------------------------------------
--  DDL for Package Body FA_FASNBV_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."FA_FASNBV_XMLP_PKG" AS
/* $Header: FASNBVB.pls 120.0.12010000.1 2008/07/28 13:17:07 appldev ship $ */
  FUNCTION BOOKFORMULA RETURN VARCHAR2 IS
  BEGIN
    DECLARE
      L_BOOK VARCHAR2(15);
      L_BOOK_CLASS VARCHAR2(15);
      L_ACCOUNTING_FLEX_STRUCTURE NUMBER(15);
      L_CURRENCY_CODE VARCHAR2(15);
      L_DISTRIBUTION_SOURCE_BOOK VARCHAR2(15);
      L_PRECISION NUMBER(15);
    BEGIN
      SELECT
        BC.BOOK_TYPE_CODE,
        BC.BOOK_CLASS,
        BC.ACCOUNTING_FLEX_STRUCTURE,
        BC.DISTRIBUTION_SOURCE_BOOK,
        SOB.CURRENCY_CODE,
        CUR.PRECISION
      INTO L_BOOK,L_BOOK_CLASS,L_ACCOUNTING_FLEX_STRUCTURE,L_DISTRIBUTION_SOURCE_BOOK,L_CURRENCY_CODE,L_PRECISION
      FROM
        FA_BOOK_CONTROLS BC,
        GL_SETS_OF_BOOKS SOB,
        FND_CURRENCIES CUR
      WHERE BC.BOOK_TYPE_CODE = P_BOOK
        AND SOB.SET_OF_BOOKS_ID = BC.SET_OF_BOOKS_ID
        AND SOB.CURRENCY_CODE = CUR.CURRENCY_CODE;
      BOOK_CLASS := L_BOOK_CLASS;
      ACCOUNTING_FLEX_STRUCTURE := L_ACCOUNTING_FLEX_STRUCTURE;
      DISTRIBUTION_SOURCE_BOOK := L_DISTRIBUTION_SOURCE_BOOK;
      CURRENCY_CODE := L_CURRENCY_CODE;
      PRECISION := L_PRECISION;
      RETURN (L_BOOK);
    END;
    RETURN NULL;
  END BOOKFORMULA;

  FUNCTION PERIOD1FORMULA RETURN VARCHAR2 IS
  BEGIN
    DECLARE
      L_PERIOD_NAME VARCHAR2(15);
      L_PERIOD_POD VARCHAR2(21);
      L_PERIOD_PCD VARCHAR2(21);
      L_PERIOD_PC NUMBER(15);
      L_PERIOD_FY NUMBER(15);
    BEGIN
      SELECT
        PERIOD_NAME,
        PERIOD_COUNTER,
        TO_CHAR(PERIOD_OPEN_DATE
               ,'DD-MM-YYYY HH24:MI:SS'),
        TO_CHAR(NVL(PERIOD_CLOSE_DATE
                   ,SYSDATE)
               ,'DD-MM-YYYY HH24:MI:SS'),
        FISCAL_YEAR
      INTO L_PERIOD_NAME,L_PERIOD_PC,L_PERIOD_POD,L_PERIOD_PCD,L_PERIOD_FY
      FROM
        FA_DEPRN_PERIODS
      WHERE BOOK_TYPE_CODE = P_BOOK
        AND PERIOD_NAME = P_PERIOD1;
      PERIOD1_PC := L_PERIOD_PC;
      PERIOD1_POD := L_PERIOD_POD;
      PERIOD1_PCD := L_PERIOD_PCD;
      PERIOD1_FY := L_PERIOD_FY;
      RETURN (L_PERIOD_NAME);
    END;
    RETURN NULL;
  END PERIOD1FORMULA;

  FUNCTION REPORT_NAMEFORMULA(COMPANY_NAME IN VARCHAR2) RETURN VARCHAR2 IS
  BEGIN
    DECLARE
      L_REPORT_NAME VARCHAR2(80);
      L_CONC_PROGRAM_ID NUMBER;
    BEGIN
      RP_COMPANY_NAME := COMPANY_NAME;
      SELECT
        CR.CONCURRENT_PROGRAM_ID
      INTO L_CONC_PROGRAM_ID
      FROM
        FND_CONCURRENT_REQUESTS CR
      WHERE CR.PROGRAM_APPLICATION_ID = 140
        AND CR.REQUEST_ID = P_CONC_REQUEST_ID;
      SELECT
        CP.USER_CONCURRENT_PROGRAM_NAME
      INTO L_REPORT_NAME
      FROM
        FND_CONCURRENT_PROGRAMS_VL CP
      WHERE CP.CONCURRENT_PROGRAM_ID = L_CONC_PROGRAM_ID
        AND CP.APPLICATION_ID = 140;
	l_report_name := substr(l_report_name,1,instr(l_report_name,' (XML)'));
      RP_REPORT_NAME := L_REPORT_NAME;

      RETURN (L_REPORT_NAME);

    EXCEPTION
      WHEN OTHERS THEN
        RP_REPORT_NAME := ':Diminishing Value Report:';
        RETURN (RP_REPORT_NAME);
    END;
    RETURN NULL;
  END REPORT_NAMEFORMULA;

  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  BEGIN
    P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
    RETURN (TRUE);
  END BEFOREREPORT;

  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END AFTERREPORT;

  FUNCTION RP_PERIOD_RANGEFORMULA RETURN VARCHAR2 IS
  BEGIN
    RETURN ('Period ' || P_PERIOD1);
  END RP_PERIOD_RANGEFORMULA;

  FUNCTION OPEN_PCFORMULA RETURN NUMBER IS
  BEGIN
    DECLARE
      L_OPEN_PC NUMBER(15);
    BEGIN
      SELECT
        DP.PERIOD_COUNTER
      INTO L_OPEN_PC
      FROM
        FA_DEPRN_PERIODS DP
      WHERE DP.BOOK_TYPE_CODE = P_BOOK
        AND DP.PERIOD_COUNTER = (
        SELECT
          MAX(DPZ.PERIOD_COUNTER)
        FROM
          FA_DEPRN_SUMMARY DSZ,
          FA_DEPRN_PERIODS DPZ,
          FA_BOOKS BK
        WHERE DPZ.BOOK_TYPE_CODE = P_BOOK
          AND DPZ.FISCAL_YEAR < PERIOD1_FY
          AND DSZ.BOOK_TYPE_CODE = P_BOOK
          AND DSZ.PERIOD_COUNTER = DPZ.PERIOD_COUNTER
          AND DSZ.ASSET_ID = BK.ASSET_ID
          AND BK.BOOK_TYPE_CODE = P_BOOK
          AND BK.DATE_INEFFECTIVE is null );
      RETURN (L_OPEN_PC);
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        RETURN (0);
    END;
    RETURN NULL;
  END OPEN_PCFORMULA;

  FUNCTION ACCOUNTING_FLEX_STRUCTURE_P RETURN NUMBER IS
  BEGIN
    RETURN ACCOUNTING_FLEX_STRUCTURE;
  END ACCOUNTING_FLEX_STRUCTURE_P;

  FUNCTION CURRENCY_CODE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CURRENCY_CODE;
  END CURRENCY_CODE_P;

  FUNCTION PRECISION_P RETURN NUMBER IS
  BEGIN
    RETURN PRECISION;
  END PRECISION_P;

  FUNCTION BOOK_CLASS_P RETURN VARCHAR2 IS
  BEGIN
    RETURN BOOK_CLASS;
  END BOOK_CLASS_P;

  FUNCTION DISTRIBUTION_SOURCE_BOOK_P RETURN VARCHAR2 IS
  BEGIN
    RETURN DISTRIBUTION_SOURCE_BOOK;
  END DISTRIBUTION_SOURCE_BOOK_P;

  FUNCTION PERIOD1_PC_P RETURN NUMBER IS
  BEGIN
    RETURN PERIOD1_PC;
  END PERIOD1_PC_P;

  FUNCTION PERIOD1_PCD_P RETURN VARCHAR2 IS
  BEGIN
    RETURN PERIOD1_PCD;
  END PERIOD1_PCD_P;

  FUNCTION PERIOD1_POD_P RETURN VARCHAR2 IS
  BEGIN
    RETURN PERIOD1_POD;
  END PERIOD1_POD_P;

  FUNCTION PERIOD1_FY_P RETURN NUMBER IS
  BEGIN
    RETURN PERIOD1_FY;
  END PERIOD1_FY_P;

  FUNCTION RP_COMPANY_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN RP_COMPANY_NAME;
  END RP_COMPANY_NAME_P;

  FUNCTION RP_REPORT_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN RP_REPORT_NAME;
  END RP_REPORT_NAME_P;

END FA_FASNBV_XMLP_PKG;


/
