--------------------------------------------------------
--  DDL for Package Body PQH_PQHWSEES_XMLP_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PQH_PQHWSEES_XMLP_PKG" AS
/* $Header: PQHWSEESB.pls 120.2 2007/12/21 19:31:40 vjaganat noship $ */
  FUNCTION BEFOREREPORT RETURN BOOLEAN IS
  l_dummy boolean;
  BEGIN
    DECLARE
      CURSOR CSR_ELEMENT_NAME IS
        SELECT
          ELEMENT_NAME
        FROM
          PAY_ELEMENT_TYPES
        WHERE ELEMENT_TYPE_ID = P_ELEMENT_TYPE_ID;
      CURSOR CSR_POSN_TYPE IS
        SELECT
          MEANING
        FROM
          HR_LOOKUPS
        WHERE LOOKUP_TYPE = 'PQH_ENTITY_TYPE'
          AND LOOKUP_CODE = P_ENTITY_TYPE;
      CURSOR CSR_CURRENCY_NAME IS
        SELECT
          NAME
        FROM
          FND_CURRENCIES_ACTIVE_V
        WHERE CURRENCY_CODE <> 'STAT'
          AND CURRENCY_CODE = P_CURRENCY_CODE;
      CURSOR CSR_ENTITY_NAME IS
        SELECT
          MEANING
        FROM
          HR_LOOKUPS
        WHERE LOOKUP_TYPE = 'PQH_BUDGET_ENTITY'
          AND LOOKUP_CODE = P_BUDGETED_ENTITY_CD;
      CURSOR CSR_SESSION_DATE IS
        SELECT
          sysdate
        FROM
          DUAL;
    BEGIN
      l_dummy := BEFOREPFORM;
      P_CONC_REQUEST_ID := FND_GLOBAL.CONC_REQUEST_ID;
      OPEN CSR_SESSION_DATE;
      FETCH CSR_SESSION_DATE
       INTO
         CP_SESSION_DT;
      CLOSE CSR_SESSION_DATE;
      OPEN CSR_ENTITY_NAME;
      FETCH CSR_ENTITY_NAME
       INTO
         CP_ENTITY_NAME;
      CLOSE CSR_ENTITY_NAME;
      OPEN CSR_CURRENCY_NAME;
      FETCH CSR_CURRENCY_NAME
       INTO
         CP_CURRENCY;
      CLOSE CSR_CURRENCY_NAME;
      OPEN CSR_ELEMENT_NAME;
      FETCH CSR_ELEMENT_NAME
       INTO
         CP_ELEMENT_NAME;
      CLOSE CSR_ELEMENT_NAME;
      OPEN CSR_POSN_TYPE;
      FETCH CSR_POSN_TYPE
       INTO
         CP_POSITION_TYPE;
      CLOSE CSR_POSN_TYPE;
      P_REPORT_TITLE := HR_GENERAL.DECODE_LOOKUP('PQH_REPORT_TITLES'
                                                ,'PQHWSEES');
      C_BUSINESS_GROUP_NAME := GET_BUSINESS_GROUP(P_BUSINESS_GROUP_ID);
    END;
    RETURN (TRUE);
  END BEFOREREPORT;

  FUNCTION CF_1FORMULA(BUDGET_UNIT_ID IN NUMBER
                      ,ACTUAL_AMT IN NUMBER
                      ,COMMITTED_AMT IN NUMBER) RETURN NUMBER IS
    CURSOR SHARED_TYPES IS
      SELECT
        SYSTEM_TYPE_CD
      FROM
        PER_SHARED_TYPES
      WHERE SHARED_TYPE_ID = BUDGET_UNIT_ID;
    L_SHARED_TYPE_CD PER_SHARED_TYPES.SYSTEM_TYPE_CD%TYPE;
  BEGIN
    OPEN SHARED_TYPES;
    FETCH SHARED_TYPES
     INTO
       L_SHARED_TYPE_CD;
    CLOSE SHARED_TYPES;
    IF L_SHARED_TYPE_CD = 'MONEY' THEN
      RETURN (NVL(ACTUAL_AMT
                ,0) + NVL(COMMITTED_AMT
                ,0));
    ELSE
      RETURN (NVL(ACTUAL_AMT
                ,0));
    END IF;
  END CF_1FORMULA;

  FUNCTION CF_DEF_EX_AMTFORMULA(BUDGETED_AMT IN NUMBER
                               ,CF_PROJECTED_EXP IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (NVL(BUDGETED_AMT
              ,0) - NVL(CF_PROJECTED_EXP
              ,0));
  END CF_DEF_EX_AMTFORMULA;

  FUNCTION BEFOREPFORM RETURN BOOLEAN IS
  BEGIN
    INSERT INTO FND_SESSIONS
      (SESSION_ID
      ,EFFECTIVE_DATE)
    VALUES   (USERENV('sessionid')
      ,P_EFFECTIVE_DATE);
    RETURN (TRUE);
  END BEFOREPFORM;

  FUNCTION CF_ACT_PERFORMULA(BUDGETED_AMT IN NUMBER
                            ,ACTUAL_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN (NVL(ACTUAL_AMT
                ,0) / BUDGETED_AMT) * 100;
    END IF;
  END CF_ACT_PERFORMULA;

  FUNCTION CF_COM_PERFORMULA(BUDGETED_AMT IN NUMBER
                            ,COMMITTED_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN (NVL(COMMITTED_AMT
                ,0) / BUDGETED_AMT) * 100;
    END IF;
  END CF_COM_PERFORMULA;

  FUNCTION CF_PROJ_PERFORMULA(BUDGETED_AMT IN NUMBER
                             ,CF_PROJECTED_EXP IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN (NVL(CF_PROJECTED_EXP
                ,0) / BUDGETED_AMT) * 100;
    END IF;
  END CF_PROJ_PERFORMULA;

  FUNCTION CF_DEF_EX_PERFORMULA(BUDGETED_AMT IN NUMBER
                               ,CF_DEF_EX_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN (NVL(CF_DEF_EX_AMT
                ,0) / BUDGETED_AMT) * 100;
    END IF;
  END CF_DEF_EX_PERFORMULA;

  FUNCTION CF_ELM_ACTUAL_PERFORMULA(SUM_BUDGETED_AMT IN NUMBER
                                   ,SUM_ACTUAL_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF SUM_BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN ((NVL(SUM_ACTUAL_AMT
                ,0) / SUM_BUDGETED_AMT) * 100);
    END IF;
  END CF_ELM_ACTUAL_PERFORMULA;

  FUNCTION CF_ELM_COMMIT_PERFORMULA(SUM_BUDGETED_AMT IN NUMBER
                                   ,SUM_COMMITTED_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF SUM_BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN ((NVL(SUM_COMMITTED_AMT
                ,0) / SUM_BUDGETED_AMT) * 100);
    END IF;
  END CF_ELM_COMMIT_PERFORMULA;

  FUNCTION CF_ELM_PROJECTED_EXPFORMULA(ELM_BUDGET_UNIT_ID IN NUMBER
                                      ,SUM_ACTUAL_AMT IN NUMBER
                                      ,SUM_COMMITTED_AMT IN NUMBER) RETURN NUMBER IS
    CURSOR SHARED_TYPES IS
      SELECT
        SYSTEM_TYPE_CD
      FROM
        PER_SHARED_TYPES
      WHERE SHARED_TYPE_ID = ELM_BUDGET_UNIT_ID;
    L_SHARED_TYPE_CD PER_SHARED_TYPES.SYSTEM_TYPE_CD%TYPE;
  BEGIN
    OPEN SHARED_TYPES;
    FETCH SHARED_TYPES
     INTO
       L_SHARED_TYPE_CD;
    CLOSE SHARED_TYPES;
    IF L_SHARED_TYPE_CD = 'MONEY' THEN
      RETURN (NVL(SUM_ACTUAL_AMT
                ,0) + NVL(SUM_COMMITTED_AMT
                ,0));
    ELSE
      RETURN (NVL(SUM_ACTUAL_AMT
                ,0));
    END IF;
  END CF_ELM_PROJECTED_EXPFORMULA;

  FUNCTION CF_ELM_PROJ_PERFORMULA(SUM_BUDGETED_AMT IN NUMBER
                                 ,CF_ELM_PROJECTED_EXP IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF SUM_BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN ((NVL(CF_ELM_PROJECTED_EXP
                ,0) / SUM_BUDGETED_AMT) * 100);
    END IF;
  END CF_ELM_PROJ_PERFORMULA;

  FUNCTION CF_ELM_DEF_EX_AMTFORMULA(SUM_BUDGETED_AMT IN NUMBER
                                   ,CF_ELM_PROJECTED_EXP IN NUMBER) RETURN NUMBER IS
  BEGIN
    RETURN (NVL(SUM_BUDGETED_AMT
              ,0) - NVL(CF_ELM_PROJECTED_EXP
              ,0));
  END CF_ELM_DEF_EX_AMTFORMULA;

  FUNCTION CF_ELM_DEF_EX_PERFORMULA(SUM_BUDGETED_AMT IN NUMBER
                                   ,CF_ELM_DEF_EX_AMT IN NUMBER) RETURN NUMBER IS
  BEGIN
    IF SUM_BUDGETED_AMT = 0 THEN
      RETURN 0;
    ELSE
      RETURN ((NVL(CF_ELM_DEF_EX_AMT
                ,0) / SUM_BUDGETED_AMT) * 100);
    END IF;
  END CF_ELM_DEF_EX_PERFORMULA;

  FUNCTION CF_FORMAT_MASK2(ELM_BUDGET_UNIT_ID IN NUMBER) RETURN CHAR IS
    CURSOR CSR_UOM IS
      SELECT
        SYSTEM_TYPE_CD
      FROM
        PER_SHARED_TYPES
      WHERE SHARED_TYPE_ID = ELM_BUDGET_UNIT_ID
        AND LOOKUP_TYPE = 'BUDGET_MEASUREMENT_TYPE';
    L_BUDGET_MEASUREMENT_TYPE PER_SHARED_TYPES.SHARED_TYPE_NAME%TYPE;
    L_FORMAT_MASK VARCHAR2(50);
  BEGIN
    OPEN CSR_UOM;
    FETCH CSR_UOM
     INTO
       L_BUDGET_MEASUREMENT_TYPE;
    CLOSE CSR_UOM;
    IF L_BUDGET_MEASUREMENT_TYPE = 'MONEY' THEN
      L_FORMAT_MASK := FND_CURRENCY.GET_FORMAT_MASK(P_CURRENCY_CODE
                                                   ,22);
    ELSE
      FND_CURRENCY.BUILD_FORMAT_MASK(L_FORMAT_MASK
                                    ,22
                                    ,2
                                    ,NULL
                                    ,NULL
                                    ,NULL
                                    ,NULL);
    END IF;
    RETURN L_FORMAT_MASK;
  END CF_FORMAT_MASK2;

  FUNCTION CF_FORMAT_MASK1(BUDGET_UNIT_ID IN NUMBER) RETURN CHAR IS
    CURSOR CSR_UOM IS
      SELECT
        SYSTEM_TYPE_CD
      FROM
        PER_SHARED_TYPES
      WHERE SHARED_TYPE_ID = BUDGET_UNIT_ID
        AND LOOKUP_TYPE = 'BUDGET_MEASUREMENT_TYPE';
    L_BUDGET_MEASUREMENT_TYPE PER_SHARED_TYPES.SHARED_TYPE_NAME%TYPE;
    L_FORMAT_MASK VARCHAR2(50);
  BEGIN
    OPEN CSR_UOM;
    FETCH CSR_UOM
     INTO
       L_BUDGET_MEASUREMENT_TYPE;
    CLOSE CSR_UOM;
    IF L_BUDGET_MEASUREMENT_TYPE = 'MONEY' THEN
      L_FORMAT_MASK := FND_CURRENCY.GET_FORMAT_MASK(P_CURRENCY_CODE
                                                   ,22);
    ELSE
      FND_CURRENCY.BUILD_FORMAT_MASK(L_FORMAT_MASK
                                    ,22
                                    ,2
                                    ,NULL
                                    ,NULL
                                    ,NULL
                                    ,NULL);
    END IF;
    RETURN L_FORMAT_MASK;
  END CF_FORMAT_MASK1;

  FUNCTION AFTERREPORT RETURN BOOLEAN IS
  BEGIN
    RETURN (TRUE);
  END AFTERREPORT;

  FUNCTION C_REPORT_SUBTITLE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_REPORT_SUBTITLE;
  END C_REPORT_SUBTITLE_P;

  FUNCTION CP_ELEMENT_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_ELEMENT_NAME;
  END CP_ELEMENT_NAME_P;

  FUNCTION CP_POSITION_TYPE_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_POSITION_TYPE;
  END CP_POSITION_TYPE_P;

  FUNCTION CP_CURRENCY_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_CURRENCY;
  END CP_CURRENCY_P;

  FUNCTION C_BUSINESS_GROUP_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN C_BUSINESS_GROUP_NAME;
  END C_BUSINESS_GROUP_NAME_P;

  FUNCTION CP_ENTITY_NAME_P RETURN VARCHAR2 IS
  BEGIN
    RETURN CP_ENTITY_NAME;
  END CP_ENTITY_NAME_P;

  FUNCTION CP_SESSION_DT_P RETURN DATE IS
  BEGIN
    RETURN CP_SESSION_DT;
  END CP_SESSION_DT_P;

  FUNCTION GET_BUSINESS_GROUP(P_BUSINESS_GROUP_ID IN NUMBER) RETURN VARCHAR2 IS
    X0 VARCHAR2(2000);
  BEGIN
    X0 := HR_REPORTS.GET_BUSINESS_GROUP(P_BUSINESS_GROUP_ID);
    RETURN X0;
  END GET_BUSINESS_GROUP;

END PQH_PQHWSEES_XMLP_PKG;

/
