--------------------------------------------------------
--  DDL for Package Body PAY_REVERSE_PAYROLL_PKG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "APPS"."PAY_REVERSE_PAYROLL_PKG" AS
/* $Header: pypra03t.pkb 115.0 99/07/17 06:26:09 porting ship $ */
 P_PAYROLL_ACTION_ID NUMBER;
 L_TIME_PERIOD_ID    NUMBER;
 L_DATE_EARNED       DATE;

 PROCEDURE INSERT_ROW(P_ACTION_TYPE                    VARCHAR2,
		      P_BUSINESS_GROUP_ID              NUMBER,
                      P_CONSOLIDATION_SET_ID           NUMBER,
	              P_PAYROLL_ID		       NUMBER,
		      P_ACTION_POPULATION_STATUS       VARCHAR2,
		      P_ACTION_STATUS                  VARCHAR2,
	              P_EFFECTIVE_DATE                 DATE,
		      P_ASSIGNMENT_ACTION_ID           NUMBER) IS
   CURSOR C1 IS
    SELECT PAY_PAYROLL_ACTIONS_S.NEXTVAL,
	   PTP.TIME_PERIOD_ID,
           PAC.DATE_EARNED
    FROM   PER_TIME_PERIODS PTP,
           PAY_ASSIGNMENT_ACTIONS PAA,
           PAY_PAYROLL_ACTIONS PAC
    WHERE  PTP.PAYROLL_ID = P_PAYROLL_ID
    AND    P_EFFECTIVE_DATE BETWEEN
	   PTP.START_DATE AND PTP.END_DATE
    AND    PAA.ASSIGNMENT_ACTION_ID = P_ASSIGNMENT_ACTION_ID
    AND    PAA.PAYROLL_ACTION_ID = PAC.PAYROLL_ACTION_ID;

BEGIN

   OPEN C1;
    FETCH C1 INTO P_PAYROLL_ACTION_ID, L_TIME_PERIOD_ID, L_DATE_EARNED;
   CLOSE C1;

INSERT INTO PAY_PAYROLL_ACTIONS(PAYROLL_ACTION_ID, ACTION_TYPE,
		                BUSINESS_GROUP_ID, CONSOLIDATION_SET_ID,
				PAYROLL_ID, ACTION_POPULATION_STATUS,
				ACTION_STATUS,EFFECTIVE_DATE, DATE_EARNED,
				TIME_PERIOD_ID,
				OBJECT_VERSION_NUMBER)

			VALUES (P_PAYROLL_ACTION_ID, P_ACTION_TYPE,
			        P_BUSINESS_GROUP_ID, P_CONSOLIDATION_SET_ID,
				P_PAYROLL_ID, P_ACTION_POPULATION_STATUS,
				P_ACTION_STATUS, P_EFFECTIVE_DATE,
				L_DATE_EARNED,
                                L_TIME_PERIOD_ID, 1);


     /* now call database package do the reversal */

    hrassact.reversal(P_PAYROLL_ACTION_ID,P_ASSIGNMENT_ACTION_ID);


 END INSERT_ROW;

END PAY_REVERSE_PAYROLL_PKG;

/
